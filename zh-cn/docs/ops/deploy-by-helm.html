<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="keywords" content="Deploy" />
	<meta name="description" content="Higress Helm部署." />
	<meta name="aes-config" content="pid=xux-opensource&user_type=101&uid=&username=&dim10=higress"/>
	<!-- 网页标签标题 -->
	<title>安装部署</title>
  <link rel="shortcut icon" href="/img/higress_logo_small.jpg"/>
	<link rel="stylesheet" href="/build/documentation.css" />
  <link rel="stylesheet" href="https://g.alicdn.com/mamba/assets/0.0.3/mse-arc-ui.min.css" />
</head>
<body>
	<div id="root"><div class="documentation-page" data-reactroot=""><header class="header-container header-container-normal"><div class="header-body"><a href="/zh-cn/index.html"><img class="logo" src="//img.alicdn.com/imgextra/i1/O1CN01I7WjVs1K33EQjInid_!!6000000001107-2-tps-960-290.png"/></a><div class="search search-normal"><span class="icon-search"></span></div><span class="language-switch language-switch-normal">En</span><div class="header-menu"><img class="header-menu-toggle" src="https://img.alicdn.com/tfs/TB14eEmw7P2gK0jSZPxXXacQpXa-38-32.png"/><ul><li class="menu-item menu-item-normal"><span><a href="/zh-cn/index.html">首页</a></span></li><li class="menu-item menu-item-normal menu-item-normal-active"><span><a href="/zh-cn/docs/overview/what-is-higress.html">文档</a></span></li><li class="menu-item menu-item-normal"><span><a href="/zh-cn/docs/developers/developers_dev.html">开发者</a></span></li><li class="menu-item menu-item-normal"><span><a href="/zh-cn/blog/index.html">博客</a></span></li><li class="menu-item menu-item-normal"><span><a href="/zh-cn/community/index.html">社区</a></span></li><li class="menu-item menu-item-normal"><span><a href="/zh-cn/blog/download.html">下载</a></span></li></ul></div></div></header><div class="bar"><div class="bar-body"><img src="https://img.alicdn.com/tfs/TB1cm8nJwDqK1RjSZSyXXaxEVXa-160-160.png" class="front-img"/><span>文档</span><img src="https://img.alicdn.com/tfs/TB1cm8nJwDqK1RjSZSyXXaxEVXa-160-160.png" class="back-img"/></div></div><section class="content-section"><div class="sidemenu"><div class="sidemenu-toggle"><img src="https://img.alicdn.com/tfs/TB1E6apXHGYBuNjy0FoXXciBFXa-200-200.png"/></div><ul><li class="menu-item menu-item-level-1"><span>概述</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/overview/what-is-higress.html" target="_self">Higress 是什么？</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/overview/roadmap.html" target="_self">Roadmap</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/overview/faq.html" target="_self">FAQ</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/overview/terminology.html" target="_self">术语表</a></li></ul></li><li class="menu-item menu-item-level-1"><span>用户指南</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/user/quickstart.html" target="_self">快速开始</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>最佳实践示例<img style="transform:rotate(-90deg)" class="menu-toggle" src="https://img.alicdn.com/tfs/TB15.Ilw2b2gK0jSZK9XXaEgFXa-26-16.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/wasm-go.html" target="_self">使用 GO 语言开发 WASM 插件</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/dubbo.html" target="_self">实现 Dubbo 服务发现和路由</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>文档陆续增加中...<img style="transform:rotate(-90deg)" class="menu-toggle" src="https://img.alicdn.com/tfs/TB15.Ilw2b2gK0jSZK9XXaEgFXa-26-16.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/nacos-route.html" target="_self">配置 Ingress 转发给注册在 Nacos 的服务</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/spring-cloud.html" target="_self">实现 SpringCloud 服务发现和路由</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/prometheus.html" target="_self">基于 Prometheus 实现入口流量观测</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/kruise-rollout.html" target="_self">通过 OpenKruise Rollout 实现灰度发布</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/opensergo-gray.html" target="_self">对接 OpenSergo 实现全链路灰度</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/sentinel.html" target="_self">基于 Sentinel 实现入口熔断限流</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/waf.html" target="_self">开启 WAF 防护的最佳实践</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>参考手册<img style="transform:rotate(-90deg)" class="menu-toggle" src="https://img.alicdn.com/tfs/TB15.Ilw2b2gK0jSZK9XXaEgFXa-26-16.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/annotation.html" target="_self">Ingress Annotaion 配置说明</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/configurations.html" target="_self">运维参数配置说明</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/mcp-bridge.html" target="_self">Mcp Brdige 配置说明</a></li></ul></li></ul></li><li class="menu-item menu-item-level-1"><span>运维指南</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/ops/deploy-by-helm.html" target="_self">安装部署</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/ops/upgrade.html" target="_self">版本升级</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/ops/log.html" target="_self">日志说明</a></li></ul></li><li class="menu-item menu-item-level-1"><span>开发者指南</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/dev/code.html" target="_self">源码阅读指引</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/dev/architecture.html" target="_self">组件编译说明</a></li></ul></li></ul></div><div class="doc-content markdown-body"><h1>安装部署</h1>
<p><a href="https://helm.sh/">Helm</a> 是一个用于自动化管理和发布 Kubernetes 软件的包管理系统。通过 Helm 可以在您的 Kubernetes 集群上快速部署安装 Higress 网关。</p>
<h2>第一步：安装 Istio</h2>
<p>Higress 网关基于<a href="https://istio.io/">Istio</a> 管理数据平面的 API 配置。可以选择部署 Higress 发行的 Istio 版本，也可以选择 Istio 官方提供的标准版本。
两种模式下的能力对比可以参考<a href="../user/annotation.md">Higress Anntotaion 支持说明</a>。</p>
<h3>选项1. 安装 Higress Istio（推荐）</h3>
<p>安装后，<code>istiod</code> 需要等待 Higress 完成部署完成，才会处于就绪状态。</p>
<pre><code class="language-bash">kubectl create ns istio-system
helm install istio -n istio-system oci://higress-registry.cn-hangzhou.cr.aliyuncs.com/charts/istio
</code></pre>
<h2><strong>注意</strong></h2>
<p>若 Higress 网关没有安装在默认的 <code>higress-system</code> 的命名空间，需要在安装 Higress Istio 时指定通过 <code>--set global.higressNamespace=</code> 指定命名空间，如:</p>
<pre><code class="language-bash">helm install istio -n istio-system --<span class="hljs-built_in">set</span> global.higressNamespace=foo oci://higress-registry.cn-hangzhou.cr.aliyuncs.com/charts/istio
</code></pre>
<hr>
<h3>选项2. 安装标准版 Istio</h3>
<p>请参考 Istio 官网的<a href="https://istio.io/latest/zh/docs/setup/install/">安装文档</a></p>
<p>与 Higress Istio 不同，标准版 Istio 不会从自动从 Higress Controller 获取配置，需要配置<a href="https://istio.io/latest/docs/reference/config/istio.mesh.v1alpha1/#ConfigSource">MeshConfig.ConfigSource</a></p>
<p>以通过 istioctl 部署为例：</p>
<pre><code class="language-yaml"><span class="hljs-comment"># my-config.yaml</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">install.istio.io/v1alpha1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">IstioOperator</span>
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  values:</span>
<span class="hljs-attr">    global:</span>
      <span class="hljs-comment"># 用于 Istio 控制面鉴权，当前 Higress 支持 first-party-jwt</span>
<span class="hljs-attr">      jwtPolicy:</span> <span class="hljs-string">"first-party-jwt"</span>
<span class="hljs-attr">  meshConfig:</span>
<span class="hljs-attr">    configSources:</span>
    <span class="hljs-comment"># 当有多个配置来源时，需要显示指定 k8s 来源</span>
<span class="hljs-attr">    - address:</span> <span class="hljs-string">"k8s://"</span>
    <span class="hljs-comment"># 假设 Higress 安装在 higress-system 命名空间</span>
<span class="hljs-attr">    - address:</span> <span class="hljs-string">"xds://higress-controller.higress-system:15051"</span>
    <span class="hljs-comment"># 若在不同命名空间安装了多个 Higress ，可以继续添加</span>
</code></pre>
<p>执行安装操作：</p>
<pre><code class="language-bash">istioctl install -f my-config.yaml
</code></pre>
<h2>第二步：安装 Higress</h2>
<p>Higress 网关由控制面组件 <code>higress-controller</code> 和数据面组件 <code>higress-gateway</code> 组成。Istio 负责管理<strong>数据平面的 API 配置</strong>，<code>higress-controller</code> 负责管理<strong>控制平面的 API 配置</strong>。</p>
<h3>Helm 安装命令</h3>
<pre><code class="language-bash">kubectl create ns higress-system
helm install higress -n higress-system  oci://higress-registry.cn-hangzhou.cr.aliyuncs.com/charts/higress
</code></pre>
<h3>安装参数</h3>
<ol>
<li>enableStatus</li>
</ol>
<p>为避免从 Nginx Ingress 迁移过程中，覆盖 Ingress 对象的 status 字段，Higress 默认不会将入口 IP 写入 Ingress 的 status。</p>
<p>可以通过 <code>--set enableStatus=true</code> 启用此功能。</p>
<ol start="2">
<li>ingressClass</li>
</ol>
<p>在集群内部署了多个网关时，可以基于 <a href="https://kubernetes.io/zh-cn/docs/concepts/services-networking/ingress/#ingress-class">IngressClass</a> 区分每个网关的职责范围。</p>
<p>可以通过 <code>--set ingressClass=&lt;name&gt;</code> 指定 Higress 监听哪些 Ingress。</p>
<ol start="3">
<li>watchNamespace</li>
</ol>
<p>当基于 K8s 命名空间进行业务系统隔离时，若需要对每个命名空间部署一套独立的网关，可以通过 watchNamespace 限制 Higress 监听此命名空间内的 Ingress。</p>
<p>可以通过 <code>--set watchNamespace=&lt;namespace&gt;</code> 指定。</p>
</div></section><footer class="footer-container"><div class="footer-body"><img src="//img.alicdn.com/imgextra/i2/O1CN01oNTGgE1lfW7oEPIzP_!!6000000004846-2-tps-960-290.png"/><p class="docsite-power">website powered by docsite</p><div class="cols-container"><div class="col col-12"><h3>愿景</h3><p>为用户提供一站式云原生网关解决方案.</p></div><div class="col col-6"><dl><dt>文档</dt><dd><a href="/zh-cn/docs/overview/what-is-higress.html" target="_self">Higress 是什么？</a></dd><dd><a href="/zh-cn/docs/user/quickstart.html" target="_self">快速开始</a></dd><dd><a href="https://github.com/higress-group/higress-group.github.io/issues/new" target="_self">报告文档问题</a></dd><dd><a href="https://github.com/higress-group/higress-group.github.io" target="_self">在Github上编辑此文档</a></dd></dl></div><div class="col col-6"><dl><dt>资源</dt><dd><a href="/zh-cn/blog/index.html" target="_self">博客</a></dd><dd><a href="/zh-cn/community/index.html" target="_self">社区</a></dd></dl></div></div><div class="copyright"><span>Copyright © 2022 Higress</span></div></div></footer></div></div>
	<script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
	<script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
	<script src="//g.alicdn.com/alilog/mlog/aplus_v2.js" id="beacon-aplus" exparams="clog=o&aplus&sidx=aplusSidx&ckx=aplusCkx"></script>
     <script src="//g.alicdn.com/aes/??tracker/1.0.34/index.js,tracker-plugin-pv/2.4.5/index.js,tracker-plugin-event/1.2.5/index.js,tracker-plugin-jserror/1.0.13/index.js,tracker-plugin-api/1.1.14/index.js,tracker-plugin-perf/1.1.8/index.js,tracker-plugin-eventTiming/1.0.4/index.js"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YHS75WKFBR"></script>
    <script>
		window.rootPath = '';
    </script>
	<script src="/build/documentation.js"></script>
  <script src="https://g.alicdn.com/mamba/assets/0.0.3/mse-arc-ui.min.js"></script>
	<script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?4debd66ec73a32e236b30b46d219e2e3";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();

    window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-YHS75WKFBR');
    </script>
</body>
</html>
