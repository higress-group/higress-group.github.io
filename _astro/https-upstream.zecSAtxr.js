import{c as d,__tla as E}from"./astro-component.B3fYMMDi.js";import{r,m as y,u as v,__tla as o}from"./constant.B9AWHwfy.js";import{__tla as F}from"./astro/assets-service.DmDXK_Mj.js";let a,l,e,n,i,c,p,u=Promise.all([(()=>{try{return E}catch{}})(),(()=>{try{return o}catch{}})(),(()=>{try{return F}catch{}})()]).then(async()=>{let s;s=`<h2 id="\u524D\u7F6E\u51C6\u5907">\u524D\u7F6E\u51C6\u5907</h2>
<ol>
<li>Higress \u5B89\u88C5\u5728 K8s \u5185\u7684 higress-system \u547D\u540D\u7A7A\u95F4\u4E0B\uFF0C\u76D1\u542C\u7684 HTTP \u7AEF\u53E3\u4E3A 80\u3002 \u4E3A\u4E86\u6D4B\u8BD5\u65B9\u4FBF\uFF0Cgateway \u7AEF\u53E3\u6620\u5C04\u90FD\u672C\u5730 127.0.0.1:80;</li>
<li>\u76EE\u6807\u662F\u4E3A default \u547D\u540D\u7A7A\u95F4\u4E0B\u7684 \u90E8\u7F72 https-httpbin \u670D\u52A1\uFF0C\u670D\u52A1\u76D1\u542C\u7684\u7AEF\u53E3\u4E3A 443\uFF1B</li>
<li>https-httpbin \u670D\u52A1\u5177\u4F53\u5185\u5BB9\u8BF7\u53C2\u8003 <a href="https://github.com/2456868764/httpbin" referrerpolicy="unsafe-url" rel="nofollow" target="_blank">github httpbin</a>;</li>
</ol>
<h2 id="\u51C6\u5907\u8BC1\u4E66">\u51C6\u5907\u8BC1\u4E66</h2>
<ol>
<li>\u751F\u6210 CA\uFF08\u6839\u8BC1\u4E66\uFF09\uFF1A</li>
</ol>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.1vui4.css"><script type="module" src="/_astro/ec.dy9ns.js"><\/script><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#99A0A6"># \u751F\u6210 CA \u79C1\u94A5</span></div></div><div class="ec-line"><div class="code"><span style="--0:#B392F0">openssl</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">genrsa</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">-out</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">ca.key</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">2048</span></div></div><div class="ec-line"><div class="code"><span style="--0:#99A0A6"># \u751F\u6210 CA \u6839\u8BC1\u4E66</span></div></div><div class="ec-line"><div class="code"><span style="--0:#B392F0">openssl</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">req</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">-x509</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">-new</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">-nodes</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">-key</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">ca.key</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">-subj</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">"/CN=MyCA"</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">-days</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">3650</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">-out</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">ca.crt</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="openssl genrsa -out ca.key 2048\x7Fopenssl req -x509 -new -nodes -key ca.key -subj &#x22;/CN=MyCA&#x22; -days 3650 -out ca.crt"><div></div></button></div></figure></div>
<ol start="2">
<li>\u751F\u6210\u670D\u52A1\u7AEF\u8BC1\u4E66</li>
</ol>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#99A0A6"># \u751F\u6210\u670D\u52A1\u7AEF\u79C1\u94A5</span></div></div><div class="ec-line"><div class="code"><span style="--0:#B392F0">openssl</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">genrsa</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">-out</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">server.key</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">2048</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#99A0A6"># \u751F\u6210\u670D\u52A1\u7AEF\u8BC1\u4E66\u7B7E\u540D\u8BF7\u6C42\uFF08CSR\uFF09</span></div></div><div class="ec-line"><div class="code"><span style="--0:#B392F0">openssl</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">req</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">-new</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">-key</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">server.key</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">-subj</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">"/CN=https-httpbin-v1.default.svc.cluster.local"</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">-out</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">server.csr</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#99A0A6"># \u4F7F\u7528 CA \u7B7E\u7F72\u670D\u52A1\u7AEF\u8BC1\u4E66</span></div></div><div class="ec-line"><div class="code"><span style="--0:#B392F0">openssl</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">x509</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">-req</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">-in</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">server.csr</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">-CA</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">ca.crt</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">-CAkey</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">ca.key</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">-CAcreateserial</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">-out</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">server.crt</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">-days</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">3650</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">-sha256</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="openssl genrsa -out server.key 2048\x7Fopenssl req -new -key server.key -subj &#x22;/CN=https-httpbin-v1.default.svc.cluster.local&#x22; -out server.csr\x7Fopenssl x509 -req -in server.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out server.crt -days 3650 -sha256"><div></div></button></div></figure></div>
<ol start="3">
<li>\u751F\u6210 Gateway \u8BC1\u4E66</li>
</ol>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#99A0A6"># \u751F\u6210 Gateway \u79C1\u94A5</span></div></div><div class="ec-line"><div class="code"><span style="--0:#B392F0">openssl</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">genrsa</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">-out</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">gateway.key</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">2048</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#99A0A6"># \u751F\u6210 Gateway \u8BC1\u4E66\u7B7E\u540D\u8BF7\u6C42\uFF08CSR\uFF09</span></div></div><div class="ec-line"><div class="code"><span style="--0:#B392F0">openssl</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">req</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">-new</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">-key</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">gateway.key</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">-subj</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">"/CN=gateway.higress-system.svc.cluster.local"</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">-out</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">gateway.csr</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#99A0A6"># \u4F7F\u7528 CA \u7B7E\u7F72 Gateway \u8BC1\u4E66</span></div></div><div class="ec-line"><div class="code"><span style="--0:#B392F0">openssl</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">x509</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">-req</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">-in</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">gateway.csr</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">-CA</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">ca.crt</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">-CAkey</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">ca.key</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">-CAcreateserial</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">-out</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">gateway.crt</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">-days</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">3650</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">-sha256</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="openssl genrsa -out gateway.key 2048\x7Fopenssl req -new -key gateway.key -subj &#x22;/CN=gateway.higress-system.svc.cluster.local&#x22; -out gateway.csr\x7Fopenssl x509 -req -in gateway.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out gateway.crt -days 3650 -sha256"><div></div></button></div></figure></div>
<ol start="4">
<li>\u5BFC\u5165 CA \u8BC1\u4E66\u3001Gateway\u3001\u670D\u52A1\u7AEF\u8BC1\u4E66\u5230 secret \u4E2D</li>
</ol>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#B392F0">kubectl</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">create</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">secret</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">generic</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">gateway-cert-cacert</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">--from-file=cacert=ca.crt</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">--namespace=default</span></div></div><div class="ec-line"><div class="code"><span style="--0:#B392F0">kubectl</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">create</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">secret</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">tls</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">gateway-cert</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">--key</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">gateway.key</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">--cert</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">gateway.crt</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">--namespace=default</span></div></div><div class="ec-line"><div class="code"><span style="--0:#B392F0">kubectl</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">create</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">secret</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">tls</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">server-cert</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">--key</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">server.key</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">--cert</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">server.crt</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">--namespace=default</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="kubectl create secret generic gateway-cert-cacert --from-file=cacert=ca.crt --namespace=default\x7Fkubectl create secret tls gateway-cert --key gateway.key --cert gateway.crt --namespace=default\x7Fkubectl create secret tls server-cert --key server.key --cert server.crt --namespace=default"><div></div></button></div></figure></div>
<h2 id="\u51C6\u5907\u540E\u7AEF-https-httpbin-\u670D\u52A1">\u51C6\u5907\u540E\u7AEF https-httpbin \u670D\u52A1</h2>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#85E89D">apiVersion</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">v1</span></div></div><div class="ec-line"><div class="code"><span style="--0:#85E89D">kind</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">Service</span></div></div><div class="ec-line"><div class="code"><span style="--0:#85E89D">metadata</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">name</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">https-httpbin-v1</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">namespace</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">default</span></div></div><div class="ec-line"><div class="code"><span style="--0:#85E89D">spec</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">selector</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#85E89D">app</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">https-httpbin-v1</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">ports</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8">    </span></span><span style="--0:#E1E4E8">- </span><span style="--0:#85E89D">protocol</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">TCP</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#85E89D">port</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">443</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#85E89D">targetPort</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">443</span></div></div><div class="ec-line"><div class="code"><span style="--0:#B392F0">---</span></div></div><div class="ec-line"><div class="code"><span style="--0:#85E89D">apiVersion</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">apps/v1</span></div></div><div class="ec-line"><div class="code"><span style="--0:#85E89D">kind</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">Deployment</span></div></div><div class="ec-line"><div class="code"><span style="--0:#85E89D">metadata</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">name</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">https-httpbin-v1</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">namespace</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">default</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">labels</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#85E89D">app</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">https-httpbin-v1</span></div></div><div class="ec-line"><div class="code"><span style="--0:#85E89D">spec</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">replicas</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">1</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">selector</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#85E89D">matchLabels</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#85E89D">app</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">https-httpbin-v1</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">template</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#85E89D">metadata</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#85E89D">labels</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#85E89D">app</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">https-httpbin-v1</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#85E89D">spec</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#85E89D">containers</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8">        </span></span><span style="--0:#E1E4E8">- </span><span style="--0:#85E89D">name</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">https-httpbin-v1</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#85E89D">image</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">registry.cn-hangzhou.aliyuncs.com/2456868764/httpbin:v1.0.2</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#85E89D">imagePullPolicy</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">Always</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#85E89D">ports</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8">            </span></span><span style="--0:#E1E4E8">- </span><span style="--0:#85E89D">containerPort</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">443</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#85E89D">command</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8">            </span></span><span style="--0:#E1E4E8">- </span><span style="--0:#9ECBFF">/app/httpbin</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8">            </span></span><span style="--0:#E1E4E8">- </span><span style="--0:#9ECBFF">--https-enable=true</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8">            </span></span><span style="--0:#E1E4E8">- </span><span style="--0:#9ECBFF">--https-port=443</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8">            </span></span><span style="--0:#E1E4E8">- </span><span style="--0:#9ECBFF">--mtls=true</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8">            </span></span><span style="--0:#E1E4E8">- </span><span style="--0:#9ECBFF">--cert=/etc/cert/tls.crt</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8">            </span></span><span style="--0:#E1E4E8">- </span><span style="--0:#9ECBFF">--key=/etc/cert/tls.key</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8">            </span></span><span style="--0:#E1E4E8">- </span><span style="--0:#9ECBFF">--cacert=/etc/cacert/cacert</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#85E89D">env</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8">            </span></span><span style="--0:#E1E4E8">- </span><span style="--0:#85E89D">name</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">POD_NAME</span></div></div><div class="ec-line"><div class="code"><span class="indent">              </span><span style="--0:#85E89D">valueFrom</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#85E89D">fieldRef</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span class="indent">                  </span><span style="--0:#85E89D">fieldPath</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">metadata.name</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8">            </span></span><span style="--0:#E1E4E8">- </span><span style="--0:#85E89D">name</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">NAMESPACE</span></div></div><div class="ec-line"><div class="code"><span class="indent">              </span><span style="--0:#85E89D">valueFrom</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#85E89D">fieldRef</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span class="indent">                  </span><span style="--0:#85E89D">fieldPath</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">metadata.namespace</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#85E89D">volumeMounts</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8">            </span></span><span style="--0:#E1E4E8">- </span><span style="--0:#85E89D">mountPath</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"/etc/cert"</span></div></div><div class="ec-line"><div class="code"><span class="indent">              </span><span style="--0:#85E89D">name</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">server-cert</span></div></div><div class="ec-line"><div class="code"><span class="indent">              </span><span style="--0:#85E89D">readOnly</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">true</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8">            </span></span><span style="--0:#E1E4E8">- </span><span style="--0:#85E89D">mountPath</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"/etc/cacert"</span></div></div><div class="ec-line"><div class="code"><span class="indent">              </span><span style="--0:#85E89D">name</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">ca-cert</span></div></div><div class="ec-line"><div class="code"><span class="indent">              </span><span style="--0:#85E89D">readOnly</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">true</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#85E89D">resources</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85E89D">requests</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span class="indent">              </span><span style="--0:#85E89D">cpu</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">10m</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#85E89D">volumes</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8">        </span></span><span style="--0:#E1E4E8">- </span><span style="--0:#85E89D">name</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">server-cert</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#85E89D">secret</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85E89D">secretName</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">server-cert</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8">        </span></span><span style="--0:#E1E4E8">- </span><span style="--0:#85E89D">name</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">ca-cert</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#85E89D">secret</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85E89D">secretName</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">gateway-cert-cacert</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="apiVersion: v1\x7Fkind: Service\x7Fmetadata:\x7F  name: https-httpbin-v1\x7F  namespace: default\x7Fspec:\x7F  selector:\x7F    app: https-httpbin-v1\x7F  ports:\x7F    - protocol: TCP\x7F      port: 443\x7F      targetPort: 443\x7F---\x7FapiVersion: apps/v1\x7Fkind: Deployment\x7Fmetadata:\x7F  name: https-httpbin-v1\x7F  namespace: default\x7F  labels:\x7F    app: https-httpbin-v1\x7Fspec:\x7F  replicas: 1\x7F  selector:\x7F    matchLabels:\x7F      app: https-httpbin-v1\x7F  template:\x7F    metadata:\x7F      labels:\x7F        app: https-httpbin-v1\x7F    spec:\x7F      containers:\x7F        - name: https-httpbin-v1\x7F          image: registry.cn-hangzhou.aliyuncs.com/2456868764/httpbin:v1.0.2\x7F          imagePullPolicy: Always\x7F          ports:\x7F            - containerPort: 443\x7F          command:\x7F            - /app/httpbin\x7F            - --https-enable=true\x7F            - --https-port=443\x7F            - --mtls=true\x7F            - --cert=/etc/cert/tls.crt\x7F            - --key=/etc/cert/tls.key\x7F            - --cacert=/etc/cacert/cacert\x7F          env:\x7F            - name: POD_NAME\x7F              valueFrom:\x7F                fieldRef:\x7F                  fieldPath: metadata.name\x7F            - name: NAMESPACE\x7F              valueFrom:\x7F                fieldRef:\x7F                  fieldPath: metadata.namespace\x7F          volumeMounts:\x7F            - mountPath: &#x22;/etc/cert&#x22;\x7F              name: server-cert\x7F              readOnly: true\x7F            - mountPath: &#x22;/etc/cacert&#x22;\x7F              name: ca-cert\x7F              readOnly: true\x7F          resources:\x7F            requests:\x7F              cpu: 10m\x7F      volumes:\x7F        - name: server-cert\x7F          secret:\x7F            secretName: server-cert\x7F        - name: ca-cert\x7F          secret:\x7F            secretName: gateway-cert-cacert"><div></div></button></div></figure></div>
<h2 id="\u914D\u7F6E\u8DEF\u7531">\u914D\u7F6E\u8DEF\u7531</h2>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#85E89D">apiVersion</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">networking.k8s.io/v1</span></div></div><div class="ec-line"><div class="code"><span style="--0:#85E89D">kind</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">Ingress</span></div></div><div class="ec-line"><div class="code"><span style="--0:#85E89D">metadata</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">annotations</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#99A0A6"># backend protocol</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#85E89D">nginx.ingress.kubernetes.io/backend-protocol</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"HTTPS"</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#99A0A6"># gateway to backend mtls</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#85E89D">nginx.ingress.kubernetes.io/proxy-ssl-secret</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"default/gateway-cert"</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#99A0A6"># SNI for backend check</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#85E89D">nginx.ingress.kubernetes.io/proxy-ssl-name</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"https-httpbin-v1.default.svc.cluster.local"</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#85E89D">nginx.ingress.kubernetes.io/proxy-ssl-server-name</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"on"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">name</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">ingress-https-httpbin</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">namespace</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">default</span></div></div><div class="ec-line"><div class="code"><span style="--0:#85E89D">spec</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">ingressClassName</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">higress</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">rules</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8">    </span></span><span style="--0:#E1E4E8">- </span><span style="--0:#85E89D">host</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">foo.com</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#85E89D">http</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#85E89D">paths</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8">          </span></span><span style="--0:#E1E4E8">- </span><span style="--0:#85E89D">path</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">/</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85E89D">pathType</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">Prefix</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85E89D">backend</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span class="indent">              </span><span style="--0:#85E89D">service</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#85E89D">name</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">https-httpbin-v1</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#85E89D">port</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span class="indent">                  </span><span style="--0:#85E89D">number</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">443</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="apiVersion: networking.k8s.io/v1\x7Fkind: Ingress\x7Fmetadata:\x7F  annotations:\x7F    # backend protocol\x7F    nginx.ingress.kubernetes.io/backend-protocol: &#x22;HTTPS&#x22;\x7F    # gateway to backend mtls\x7F    nginx.ingress.kubernetes.io/proxy-ssl-secret: &#x22;default/gateway-cert&#x22;\x7F    # SNI for backend check\x7F    nginx.ingress.kubernetes.io/proxy-ssl-name: &#x22;https-httpbin-v1.default.svc.cluster.local&#x22;\x7F    nginx.ingress.kubernetes.io/proxy-ssl-server-name: &#x22;on&#x22;\x7F  name: ingress-https-httpbin\x7F  namespace: default\x7Fspec:\x7F  ingressClassName: higress\x7F  rules:\x7F    - host: foo.com\x7F      http:\x7F        paths:\x7F          - path: /\x7F            pathType: Prefix\x7F            backend:\x7F              service:\x7F                name: https-httpbin-v1\x7F                port:\x7F                  number: 443"><div></div></button></div></figure></div>
<p>Ingress Annotaion \u914D\u7F6E:</p>
<ul>
<li><code dir="auto">nginx.ingress.kubernetes.io/backend-protocol</code> \u6307\u5B9A\u540E\u7AEF\u670D\u52A1\u4F7F\u7528\u7684\u534F\u8BAE\uFF0C\u9ED8\u8BA4\u4E3AHTTP\uFF0C\u652F\u6301HTTP\u3001HTTP2\u3001HTTPS\u3001GRPC\u548CGRPCS\u3002</li>
<li><code dir="auto">nginx.ingress.kubernetes.io/proxy-ssl-secret</code> \u542F\u7528 mtls \u9700\u8981\u6307\u5B9A gateway \u8BC1\u4E66\uFF0C\u683C\u5F0F\u4E3A <code dir="auto">namespace/secret-name</code>\u3002 \u8FD9\u91CC\u9700\u8981\u6CE8\u610F\u7684\u662F\u9700\u8981\u540C\u65F6\u521B\u5EFA\u4E00\u4E2A CA \u8BC1\u4E66\u7684 secret, \u540D\u79F0\u4E3A proxy-ssl-secret \u7684\u540D\u79F0\u52A0 <code dir="auto">-cacert</code> \u540E\u7F00\uFF0C\u6BD4\u5982\u662F <code dir="auto">gateway-cert-cacert</code>\uFF0C\u5426\u5219\u4F1A\u62A5\u9519\u3002</li>
<li><code dir="auto">nginx.ingress.kubernetes.io/proxy-ssl-name</code> \u540E\u7AEF\u6821\u9A8C SNI \u9700\u8981\u6307\u5B9A\u540E\u7AEF\u670D\u52A1\u4F7F\u7528\u7684\u57DF\u540D\u3002</li>
<li><code dir="auto">nginx.ingress.kubernetes.io/proxy-ssl-server-name</code> \u542F\u7528 SNI\u3002</li>
</ul>
<h1 id="\u6D4B\u8BD5">\u6D4B\u8BD5</h1>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#B392F0">curl</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">-H</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">"host: foo.com"</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">http://127.0.0.1/ping</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#B392F0">"pong"</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="curl -H &#x22;host: foo.com&#x22; http://127.0.0.1/ping\x7F\x7F&#x22;pong&#x22;"><div></div></button></div></figure></div>`,n={title:"\u914D\u7F6E\u8DEF\u7531\u6307\u5411 HTTPS \u670D\u52A1",keywords:["ops","config","route","upstream","https"],description:"\u4ECB\u7ECD\u5982\u4F55\u4E3A\u4F7F\u7528 HTTPS \u534F\u8BAE\u7684\u540E\u7AEF\u670D\u52A1\u914D\u7F6E\u8DEF\u7531",custom_edit_url:"https://github.com/higress-group/higress-group.github.io/blob/main/src/content/docs/latest/zh-cn/ops/how-tos/https-upstream.md"},e="/home/runner/work/higress-group.github.io/higress-group.github.io/src/content/docs/latest/zh-cn/ops/how-tos/https-upstream.md",p=void 0,c=function(){return`\r
# \u914D\u7F6E\u8DEF\u7531\u6307\u5411 HTTPS \u670D\u52A1\r
\r
\r
## \u524D\u7F6E\u51C6\u5907\r
\r
1. Higress \u5B89\u88C5\u5728 K8s \u5185\u7684 higress-system \u547D\u540D\u7A7A\u95F4\u4E0B\uFF0C\u76D1\u542C\u7684 HTTP \u7AEF\u53E3\u4E3A 80\u3002 \u4E3A\u4E86\u6D4B\u8BD5\u65B9\u4FBF\uFF0Cgateway \u7AEF\u53E3\u6620\u5C04\u90FD\u672C\u5730 127.0.0.1:80;\r
2. \u76EE\u6807\u662F\u4E3A default \u547D\u540D\u7A7A\u95F4\u4E0B\u7684 \u90E8\u7F72 https-httpbin \u670D\u52A1\uFF0C\u670D\u52A1\u76D1\u542C\u7684\u7AEF\u53E3\u4E3A 443\uFF1B\r
3. https-httpbin \u670D\u52A1\u5177\u4F53\u5185\u5BB9\u8BF7\u53C2\u8003 [github httpbin](https://github.com/2456868764/httpbin);\r
\r
## \u51C6\u5907\u8BC1\u4E66\r
\r
1. \u751F\u6210 CA\uFF08\u6839\u8BC1\u4E66\uFF09\uFF1A\r
\`\`\`shell\r
# \u751F\u6210 CA \u79C1\u94A5\r
openssl genrsa -out ca.key 2048\r
# \u751F\u6210 CA \u6839\u8BC1\u4E66\r
openssl req -x509 -new -nodes -key ca.key -subj "/CN=MyCA" -days 3650 -out ca.crt\r
\`\`\`\r
\r
2. \u751F\u6210\u670D\u52A1\u7AEF\u8BC1\u4E66\r
\r
\`\`\`shell\r
# \u751F\u6210\u670D\u52A1\u7AEF\u79C1\u94A5\r
openssl genrsa -out server.key 2048\r
\r
# \u751F\u6210\u670D\u52A1\u7AEF\u8BC1\u4E66\u7B7E\u540D\u8BF7\u6C42\uFF08CSR\uFF09\r
openssl req -new -key server.key -subj "/CN=https-httpbin-v1.default.svc.cluster.local" -out server.csr\r
\r
# \u4F7F\u7528 CA \u7B7E\u7F72\u670D\u52A1\u7AEF\u8BC1\u4E66\r
openssl x509 -req -in server.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out server.crt -days 3650 -sha256\r
\`\`\`\r
\r
3. \u751F\u6210 Gateway \u8BC1\u4E66\r
\r
\`\`\`shell\r
# \u751F\u6210 Gateway \u79C1\u94A5\r
openssl genrsa -out gateway.key 2048\r
\r
# \u751F\u6210 Gateway \u8BC1\u4E66\u7B7E\u540D\u8BF7\u6C42\uFF08CSR\uFF09\r
openssl req -new -key gateway.key -subj "/CN=gateway.higress-system.svc.cluster.local" -out gateway.csr\r
\r
# \u4F7F\u7528 CA \u7B7E\u7F72 Gateway \u8BC1\u4E66\r
openssl x509 -req -in gateway.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out gateway.crt -days 3650 -sha256\r
\`\`\`\r
\r
4. \u5BFC\u5165 CA \u8BC1\u4E66\u3001Gateway\u3001\u670D\u52A1\u7AEF\u8BC1\u4E66\u5230 secret \u4E2D\r
\r
\`\`\`shell\r
kubectl create secret generic gateway-cert-cacert --from-file=cacert=ca.crt --namespace=default\r
kubectl create secret tls gateway-cert --key gateway.key --cert gateway.crt --namespace=default\r
kubectl create secret tls server-cert --key server.key --cert server.crt --namespace=default\r
\`\`\`\r
\r
## \u51C6\u5907\u540E\u7AEF https-httpbin \u670D\u52A1\r
\r
\`\`\`yaml\r
apiVersion: v1\r
kind: Service\r
metadata:\r
  name: https-httpbin-v1\r
  namespace: default\r
spec:\r
  selector:\r
    app: https-httpbin-v1\r
  ports:\r
    - protocol: TCP\r
      port: 443\r
      targetPort: 443\r
---\r
apiVersion: apps/v1\r
kind: Deployment\r
metadata:\r
  name: https-httpbin-v1\r
  namespace: default\r
  labels:\r
    app: https-httpbin-v1\r
spec:\r
  replicas: 1\r
  selector:\r
    matchLabels:\r
      app: https-httpbin-v1\r
  template:\r
    metadata:\r
      labels:\r
        app: https-httpbin-v1\r
    spec:\r
      containers:\r
        - name: https-httpbin-v1\r
          image: registry.cn-hangzhou.aliyuncs.com/2456868764/httpbin:v1.0.2\r
          imagePullPolicy: Always\r
          ports:\r
            - containerPort: 443\r
          command:\r
            - /app/httpbin\r
            - --https-enable=true\r
            - --https-port=443\r
            - --mtls=true\r
            - --cert=/etc/cert/tls.crt\r
            - --key=/etc/cert/tls.key\r
            - --cacert=/etc/cacert/cacert\r
          env:\r
            - name: POD_NAME\r
              valueFrom:\r
                fieldRef:\r
                  fieldPath: metadata.name\r
            - name: NAMESPACE\r
              valueFrom:\r
                fieldRef:\r
                  fieldPath: metadata.namespace\r
          volumeMounts:\r
            - mountPath: "/etc/cert"\r
              name: server-cert\r
              readOnly: true\r
            - mountPath: "/etc/cacert"\r
              name: ca-cert\r
              readOnly: true\r
          resources:\r
            requests:\r
              cpu: 10m\r
      volumes:\r
        - name: server-cert\r
          secret:\r
            secretName: server-cert\r
        - name: ca-cert\r
          secret:\r
            secretName: gateway-cert-cacert\r
\`\`\`\r
\r
## \u914D\u7F6E\u8DEF\u7531\r
\r
\`\`\`yaml\r
apiVersion: networking.k8s.io/v1\r
kind: Ingress\r
metadata:\r
  annotations:\r
    # backend protocol\r
    nginx.ingress.kubernetes.io/backend-protocol: "HTTPS"\r
    # gateway to backend mtls\r
    nginx.ingress.kubernetes.io/proxy-ssl-secret: "default/gateway-cert"\r
    # SNI for backend check\r
    nginx.ingress.kubernetes.io/proxy-ssl-name: "https-httpbin-v1.default.svc.cluster.local"\r
    nginx.ingress.kubernetes.io/proxy-ssl-server-name: "on"\r
  name: ingress-https-httpbin\r
  namespace: default\r
spec:\r
  ingressClassName: higress\r
  rules:\r
    - host: foo.com\r
      http:\r
        paths:\r
          - path: /\r
            pathType: Prefix\r
            backend:\r
              service:\r
                name: https-httpbin-v1\r
                port:\r
                  number: 443\r
\`\`\`\r
\r
Ingress Annotaion \u914D\u7F6E:\r
- \`nginx.ingress.kubernetes.io/backend-protocol\` \u6307\u5B9A\u540E\u7AEF\u670D\u52A1\u4F7F\u7528\u7684\u534F\u8BAE\uFF0C\u9ED8\u8BA4\u4E3AHTTP\uFF0C\u652F\u6301HTTP\u3001HTTP2\u3001HTTPS\u3001GRPC\u548CGRPCS\u3002\r
- \`nginx.ingress.kubernetes.io/proxy-ssl-secret\` \u542F\u7528 mtls \u9700\u8981\u6307\u5B9A gateway \u8BC1\u4E66\uFF0C\u683C\u5F0F\u4E3A \`namespace/secret-name\`\u3002 \u8FD9\u91CC\u9700\u8981\u6CE8\u610F\u7684\u662F\u9700\u8981\u540C\u65F6\u521B\u5EFA\u4E00\u4E2A CA \u8BC1\u4E66\u7684 secret, \u540D\u79F0\u4E3A proxy-ssl-secret \u7684\u540D\u79F0\u52A0 \`-cacert\` \u540E\u7F00\uFF0C\u6BD4\u5982\u662F \`gateway-cert-cacert\`\uFF0C\u5426\u5219\u4F1A\u62A5\u9519\u3002\r
- \`nginx.ingress.kubernetes.io/proxy-ssl-name\` \u540E\u7AEF\u6821\u9A8C SNI \u9700\u8981\u6307\u5B9A\u540E\u7AEF\u670D\u52A1\u4F7F\u7528\u7684\u57DF\u540D\u3002\r
- \`nginx.ingress.kubernetes.io/proxy-ssl-server-name\` \u542F\u7528 SNI\u3002\r
\r
\r
# \u6D4B\u8BD5\r
\r
\`\`\`shell\r
curl -H "host: foo.com" http://127.0.0.1/ping\r
\r
"pong"\r
\`\`\`\r
\r
`},l=function(){return s},i=function(){return[{depth:2,slug:"\u524D\u7F6E\u51C6\u5907",text:"\u524D\u7F6E\u51C6\u5907"},{depth:2,slug:"\u51C6\u5907\u8BC1\u4E66",text:"\u51C6\u5907\u8BC1\u4E66"},{depth:2,slug:"\u51C6\u5907\u540E\u7AEF-https-httpbin-\u670D\u52A1",text:"\u51C6\u5907\u540E\u7AEF https-httpbin \u670D\u52A1"},{depth:2,slug:"\u914D\u7F6E\u8DEF\u7531",text:"\u914D\u7F6E\u8DEF\u7531"},{depth:1,slug:"\u6D4B\u8BD5",text:"\u6D4B\u8BD5"}]},a=d((f,h,m)=>{const{layout:g,...t}=n;return t.file=e,t.url=p,r`${y()}${v(s)}`})});export{a as Content,u as __tla,l as compiledContent,a as default,e as file,n as frontmatter,i as getHeadings,c as rawContent,p as url};
