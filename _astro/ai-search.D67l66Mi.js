import{c as r,__tla as o}from"./astro-component.B3fYMMDi.js";import{r as p,m as u,u as v,__tla as y}from"./constant.Cgp6cJPa.js";import{__tla as g}from"./astro/assets-service.DmDXK_Mj.js";let s,c,a,t,l,d,n,h=Promise.all([(()=>{try{return o}catch{}})(),(()=>{try{return y}catch{}})(),(()=>{try{return g}catch{}})()]).then(async()=>{let e;e=`<h2 id="feature-description">Feature Description</h2>
<p>The <code dir="auto">ai-search</code> plugin enhances the accuracy and timeliness of AI model responses by integrating real-time results from search engines (Google/Bing/Arxiv/Elasticsearch etc.). The plugin automatically injects search results into the prompt template and determines whether to add reference sources in the final response based on configuration.</p>
<h2 id="runtime-properties">Runtime Properties</h2>
<p>Plugin execution stage: <code dir="auto">Default stage</code>
Plugin execution priority: <code dir="auto">440</code></p>
<h2 id="configuration-fields">Configuration Fields</h2>




































































<table><thead><tr><th>Name</th><th>Data Type</th><th>Requirement</th><th>Default Value</th><th>Description</th></tr></thead><tbody><tr><td>defaultEnable</td><td>bool</td><td>Optional</td><td>true</td><td>Whether the plugin functionality is enabled by default. When set to false, the plugin will only be activated when the request contains a web_search_options field</td></tr><tr><td>needReference</td><td>bool</td><td>Optional</td><td>false</td><td>Whether to add reference sources in the response</td></tr><tr><td>referenceFormat</td><td>string</td><td>Optional</td><td><code dir="auto">"**References:**\\n%s"</code></td><td>Reference content format, must include %s placeholder</td></tr><tr><td>referenceLocation</td><td>string</td><td>Optional</td><td>\u201Dhead\u201D</td><td>Reference position: \u201Chead\u201D at the beginning of the response, \u201Ctail\u201D at the end of the response</td></tr><tr><td>defaultLang</td><td>string</td><td>Optional</td><td>-</td><td>Default search language code (e.g. zh-CN/en-US)</td></tr><tr><td>promptTemplate</td><td>string</td><td>Optional</td><td>Built-in template</td><td>Prompt template, must include <code dir="auto">{search_results}</code> and <code dir="auto">{question}</code> placeholders</td></tr><tr><td>searchFrom</td><td>array of object</td><td>Required</td><td>-</td><td>Refer to search engine configuration below, at least one engine must be configured</td></tr><tr><td>searchRewrite</td><td>object</td><td>Optional</td><td>-</td><td>Search rewrite configuration, used to optimize search queries using an LLM service</td></tr></tbody></table>
<h2 id="search-rewrite-description">Search Rewrite Description</h2>
<p>The search rewrite feature uses an LLM service to analyze and optimize the user\u2019s original query, which can:</p>
<ol>
<li>Determine whether the user\u2019s question requires a search engine query. If it does not, the search-related logic will not be executed</li>
<li>Convert natural language queries into keyword combinations better suited for search engines</li>
<li>For Arxiv paper searches, automatically identify relevant paper categories and add category constraints</li>
<li>For private knowledge base searches, break down long queries into multiple precise keyword combinations</li>
</ol>
<p>It is strongly recommended to enable this feature when using Arxiv or Elasticsearch engines. For Arxiv searches, it can accurately identify paper domains and optimize English keywords; for private knowledge base searches, it can provide more precise keyword matching, significantly improving search effectiveness.</p>
<h2 id="search-rewrite-configuration">Search Rewrite Configuration</h2>





























































<table><thead><tr><th>Name</th><th>Data Type</th><th>Requirement</th><th>Default Value</th><th>Description</th></tr></thead><tbody><tr><td>llmServiceName</td><td>string</td><td>Required</td><td>-</td><td>LLM service name</td></tr><tr><td>llmServicePort</td><td>number</td><td>Required</td><td>-</td><td>LLM service port</td></tr><tr><td>llmApiKey</td><td>string</td><td>Optional</td><td>-</td><td>LLM service API key</td></tr><tr><td>llmUrl</td><td>string</td><td>Required</td><td>-</td><td>LLM service API URL</td></tr><tr><td>llmModelName</td><td>string</td><td>Required</td><td>-</td><td>LLM model name</td></tr><tr><td>timeoutMillisecond</td><td>number</td><td>Optional</td><td>30000</td><td>API call timeout (milliseconds)</td></tr><tr><td>maxCount</td><td>number</td><td>Optional</td><td>3</td><td>Maximum number of search queries generated by the search rewrite</td></tr></tbody></table>
<h2 id="search-engine-common-configuration">Search Engine Common Configuration</h2>




































































<table><thead><tr><th>Name</th><th>Data Type</th><th>Requirement</th><th>Default Value</th><th>Description</th></tr></thead><tbody><tr><td>type</td><td>string</td><td>Required</td><td>-</td><td>Engine type (google/bing/arxiv/elasticsearch/quark)</td></tr><tr><td>apiKey</td><td>string</td><td>Required</td><td>-</td><td>Search engine API key/Aliyun AccessKey</td></tr><tr><td>serviceName</td><td>string</td><td>Required</td><td>-</td><td>Backend service name</td></tr><tr><td>servicePort</td><td>number</td><td>Required</td><td>-</td><td>Backend service port</td></tr><tr><td>count</td><td>number</td><td>Optional</td><td>10</td><td>Number of results returned per search</td></tr><tr><td>start</td><td>number</td><td>Optional</td><td>0</td><td>Search result offset (start returning from the start+1 result)</td></tr><tr><td>timeoutMillisecond</td><td>number</td><td>Optional</td><td>5000</td><td>API call timeout (milliseconds)</td></tr><tr><td>optionArgs</td><td>map</td><td>Optional</td><td>-</td><td>Search engine specific parameters (key-value format)</td></tr></tbody></table>
<h2 id="google-specific-configuration">Google Specific Configuration</h2>



















<table><thead><tr><th>Name</th><th>Data Type</th><th>Requirement</th><th>Default Value</th><th>Description</th></tr></thead><tbody><tr><td>cx</td><td>string</td><td>Required</td><td>-</td><td>Google Custom Search Engine ID, used to specify search scope</td></tr></tbody></table>
<h2 id="arxiv-specific-configuration">Arxiv Specific Configuration</h2>



















<table><thead><tr><th>Name</th><th>Data Type</th><th>Requirement</th><th>Default Value</th><th>Description</th></tr></thead><tbody><tr><td>arxivCategory</td><td>string</td><td>Optional</td><td>-</td><td>Search paper <a href="https://arxiv.org/category_taxonomy" referrerpolicy="unsafe-url" rel="nofollow" target="_blank">category</a> (e.g. cs.AI, cs.CL etc.)</td></tr></tbody></table>
<h2 id="elasticsearch-specific-configuration">Elasticsearch Specific Configuration</h2>





























































<table><thead><tr><th>Name</th><th>Data Type</th><th>Requirement</th><th>Default Value</th><th>Description</th></tr></thead><tbody><tr><td>index</td><td>string</td><td>Required</td><td>-</td><td>Elasticsearch index name to search</td></tr><tr><td>contentField</td><td>string</td><td>Required</td><td>-</td><td>Content field name to query</td></tr><tr><td>semanticTextField</td><td>string</td><td>Required</td><td>-</td><td>Embedding field name to query</td></tr><tr><td>linkField</td><td>string</td><td>Optional</td><td>-</td><td>Result link field name, needed when <code dir="auto">needReference</code> is configured</td></tr><tr><td>titleField</td><td>string</td><td>Optional</td><td>-</td><td>Result title field name, needed when <code dir="auto">needReference</code> is configured</td></tr><tr><td>username</td><td>string</td><td>Optional</td><td>-</td><td>Elasticsearch username</td></tr><tr><td>password</td><td>string</td><td>Optional</td><td>-</td><td>Elasticsearch password</td></tr></tbody></table>
<p>The <a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.17/rrf.html" referrerpolicy="unsafe-url" rel="nofollow" target="_blank">Reciprocal Rank Fusion (RRF)</a> query used in hybrid search requires Elasticsearch version 8.8 or higher.</p>
<p>Currently, document vectorization relies on Elasticsearch\u2019s embedding model, which requires an Elasticsearch Enterprise license or a 30-day Trial license. To install the built-in embedding model in Elasticsearch, please refer to <a href="https://www.elastic.co/docs/explore-analyze/machine-learning/nlp/ml-nlp-elser#alternative-download-deploy" referrerpolicy="unsafe-url" rel="nofollow" target="_blank">this documentation</a>. If you want to install a third-party embedding model, please refer to <a href="https://www.elastic.co/docs/explore-analyze/machine-learning/nlp/ml-nlp-text-emb-vector-search-example" referrerpolicy="unsafe-url" rel="nofollow" target="_blank">this guide</a>.</p>
<p>For a complete tutorial on integrating the ai-search plugin with Elasticsearch, please refer to: <a href="https://cr7258.github.io/blogs/original/2025/15-rag-higress-es-langchain" referrerpolicy="unsafe-url" rel="nofollow" target="_blank">Building a RAG Application with LangChain + Higress + Elasticsearch</a>.</p>
<h2 id="quark-specific-configuration">Quark Specific Configuration</h2>



















<table><thead><tr><th>Name</th><th>Data Type</th><th>Requirement</th><th>Default Value</th><th>Description</th></tr></thead><tbody><tr><td>contentMode</td><td>string</td><td>Optional</td><td>\u201Dsummary\u201D</td><td>Content mode: \u201Csummary\u201D uses snippet, \u201Cfull\u201D uses full text (markdownText first, then mainText if empty)</td></tr></tbody></table>
<h2 id="configuration-examples">Configuration Examples</h2>
<h3 id="basic-configuration-single-search-engine">Basic Configuration (Single Search Engine)</h3>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.1vui4.css"><script type="module" src="/_astro/ec.dy9ns.js"><\/script><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#85E89D">needReference</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">true</span></div></div><div class="ec-line"><div class="code"><span style="--0:#85E89D">searchFrom</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8">- </span><span style="--0:#85E89D">type</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">google</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">apiKey</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"your-google-api-key"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">cx</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"search-engine-id"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">serviceName</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"google-svc.dns"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">servicePort</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">443</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">count</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">5</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">optionArgs</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#85E89D">fileType</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"pdf"</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="needReference: true\x7FsearchFrom:\x7F- type: google\x7F  apiKey: &#x22;your-google-api-key&#x22;\x7F  cx: &#x22;search-engine-id&#x22;\x7F  serviceName: &#x22;google-svc.dns&#x22;\x7F  servicePort: 443\x7F  count: 5\x7F  optionArgs:\x7F    fileType: &#x22;pdf&#x22;"><div></div></button></div></figure></div>
<h3 id="arxiv-search-configuration">Arxiv Search Configuration</h3>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#85E89D">searchFrom</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8">- </span><span style="--0:#85E89D">type</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">arxiv</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">serviceName</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"arxiv-svc.dns"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">servicePort</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">443</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">arxivCategory</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"cs.AI"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">count</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">10</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="searchFrom:\x7F- type: arxiv\x7F  serviceName: &#x22;arxiv-svc.dns&#x22;\x7F  servicePort: 443\x7F  arxivCategory: &#x22;cs.AI&#x22;\x7F  count: 10"><div></div></button></div></figure></div>
<h3 id="quark-search-configuration">Quark Search Configuration</h3>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#85E89D">searchFrom</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8">- </span><span style="--0:#85E89D">type</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">quark</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">serviceName</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"quark-svc.dns"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">servicePort</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">443</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">apiKey</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"quark api key"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">contentMode</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"full"</span><span style="--0:#E1E4E8">  </span><span style="--0:#99A0A6"># Optional values: "summary"(default) or "full"</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="searchFrom:\x7F- type: quark\x7F  serviceName: &#x22;quark-svc.dns&#x22;\x7F  servicePort: 443\x7F  apiKey: &#x22;quark api key&#x22;\x7F  contentMode: &#x22;full&#x22;  # Optional values: &#x22;summary&#x22;(default) or &#x22;full&#x22;"><div></div></button></div></figure></div>
<h3 id="multiple-search-engines-configuration">Multiple Search Engines Configuration</h3>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#85E89D">defaultLang</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"en-US"</span></div></div><div class="ec-line"><div class="code"><span style="--0:#85E89D">promptTemplate</span><span style="--0:#E1E4E8">: </span><span style="--0:#F97583">|</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#9ECBFF">  </span></span><span style="--0:#9ECBFF"># Search Results:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#9ECBFF">  </span></span><span style="--0:#9ECBFF">{search_results}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#9ECBFF">  </span></span><span style="--0:#9ECBFF"># Please answer this question:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#9ECBFF">  </span></span><span style="--0:#9ECBFF">{question}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#85E89D">searchFrom</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8">- </span><span style="--0:#85E89D">type</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">google</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">apiKey</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"google-key"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">cx</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"github-search-id"</span><span style="--0:#E1E4E8">  </span><span style="--0:#99A0A6"># Search engine ID specifically for GitHub content</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">serviceName</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"google-svc.dns"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">servicePort</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">443</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8">- </span><span style="--0:#85E89D">type</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">google</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">apiKey</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"google-key"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">cx</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"news-search-id"</span><span style="--0:#E1E4E8">    </span><span style="--0:#99A0A6"># Search engine ID specifically for Google News content</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">serviceName</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"google-svc.dns"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">servicePort</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">443</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8">- </span><span style="--0:#85E89D">type</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">bing</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">apiKey</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"bing-key"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">serviceName</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"bing-svc.dns"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">servicePort</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">443</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">optionArgs</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#85E89D">answerCount</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"5"</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="defaultLang: &#x22;en-US&#x22;\x7FpromptTemplate: |\x7F  # Search Results:\x7F  {search_results}\x7F\x7F  # Please answer this question:\x7F  {question}\x7FsearchFrom:\x7F- type: google\x7F  apiKey: &#x22;google-key&#x22;\x7F  cx: &#x22;github-search-id&#x22;  # Search engine ID specifically for GitHub content\x7F  serviceName: &#x22;google-svc.dns&#x22;\x7F  servicePort: 443\x7F- type: google\x7F  apiKey: &#x22;google-key&#x22;\x7F  cx: &#x22;news-search-id&#x22;    # Search engine ID specifically for Google News content\x7F  serviceName: &#x22;google-svc.dns&#x22;\x7F  servicePort: 443\x7F- type: bing\x7F  apiKey: &#x22;bing-key&#x22;\x7F  serviceName: &#x22;bing-svc.dns&#x22;\x7F  servicePort: 443\x7F  optionArgs:\x7F    answerCount: &#x22;5&#x22;"><div></div></button></div></figure></div>
<h3 id="concurrent-query-configuration">Concurrent Query Configuration</h3>
<p>Since search engines limit the number of results per query (e.g. Google limits to 100 results per query), you can get more results by:</p>
<ol>
<li>Setting a smaller count value (e.g. 10)</li>
<li>Specifying result offset with start parameter</li>
<li>Concurrently initiating multiple query requests, with each request\u2019s start value incrementing by count</li>
</ol>
<p>For example, to get 30 results, configure count=10 and concurrently initiate 3 queries with start values 0,10,20 respectively:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#85E89D">searchFrom</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8">- </span><span style="--0:#85E89D">type</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">google</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">apiKey</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"your-google-api-key"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">cx</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"search-engine-id"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">serviceName</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"google-svc.dns"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">servicePort</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">443</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">start</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">0</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">count</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">10</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8">- </span><span style="--0:#85E89D">type</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">google</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">apiKey</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"your-google-api-key"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">cx</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"search-engine-id"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">serviceName</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"google-svc.dns"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">servicePort</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">443</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">start</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">10</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">count</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">10</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8">- </span><span style="--0:#85E89D">type</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">google</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">apiKey</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"your-google-api-key"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">cx</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"search-engine-id"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">serviceName</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"google-svc.dns"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">servicePort</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">443</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">start</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">20</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">count</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">10</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="searchFrom:\x7F- type: google\x7F  apiKey: &#x22;your-google-api-key&#x22;\x7F  cx: &#x22;search-engine-id&#x22;\x7F  serviceName: &#x22;google-svc.dns&#x22;\x7F  servicePort: 443\x7F  start: 0\x7F  count: 10\x7F- type: google\x7F  apiKey: &#x22;your-google-api-key&#x22;\x7F  cx: &#x22;search-engine-id&#x22;\x7F  serviceName: &#x22;google-svc.dns&#x22;\x7F  servicePort: 443\x7F  start: 10\x7F  count: 10\x7F- type: google\x7F  apiKey: &#x22;your-google-api-key&#x22;\x7F  cx: &#x22;search-engine-id&#x22;\x7F  serviceName: &#x22;google-svc.dns&#x22;\x7F  servicePort: 443\x7F  start: 20\x7F  count: 10"><div></div></button></div></figure></div>
<p>Note that excessive concurrency may lead to rate limiting, adjust according to actual situation.</p>
<h3 id="elasticsearch-configuration-for-private-knowledge-base-integration">Elasticsearch Configuration (For Private Knowledge Base Integration)</h3>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#85E89D">searchFrom</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8">- </span><span style="--0:#85E89D">type</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">elasticsearch</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">serviceName</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"es-svc.static"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">index</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"knowledge_base"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">contentField</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"content"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">semanticTextField</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"semantic_text"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#99A0A6"># username: "elastic"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#99A0A6"># password: "password"</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="searchFrom:\x7F- type: elasticsearch\x7F  serviceName: &#x22;es-svc.static&#x22;\x7F  index: &#x22;knowledge_base&#x22;\x7F  contentField: &#x22;content&#x22;\x7F  semanticTextField: &#x22;semantic_text&#x22;\x7F  # username: &#x22;elastic&#x22;\x7F  # password: &#x22;password&#x22;"><div></div></button></div></figure></div>
<h3 id="custom-reference-format">Custom Reference Format</h3>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#85E89D">needReference</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">true</span></div></div><div class="ec-line"><div class="code"><span style="--0:#85E89D">referenceFormat</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"### Data Sources</span><span style="--0:#79B8FF">\\n</span><span style="--0:#9ECBFF">%s"</span></div></div><div class="ec-line"><div class="code"><span style="--0:#85E89D">searchFrom</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8">- </span><span style="--0:#85E89D">type</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">bing</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">apiKey</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"your-bing-key"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">serviceName</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"search-service.dns"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">servicePort</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">8080</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="needReference: true\x7FreferenceFormat: &#x22;### Data Sources\\n%s&#x22;\x7FsearchFrom:\x7F- type: bing\x7F  apiKey: &#x22;your-bing-key&#x22;\x7F  serviceName: &#x22;search-service.dns&#x22;\x7F  servicePort: 8080"><div></div></button></div></figure></div>
<h3 id="custom-reference-location">Custom Reference Location</h3>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#85E89D">needReference</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">true</span></div></div><div class="ec-line"><div class="code"><span style="--0:#85E89D">referenceLocation</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"tail"</span><span style="--0:#E1E4E8">  </span><span style="--0:#99A0A6"># Add references at the end of the response instead of the beginning</span></div></div><div class="ec-line"><div class="code"><span style="--0:#85E89D">searchFrom</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8">- </span><span style="--0:#85E89D">type</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">bing</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">apiKey</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"your-bing-key"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">serviceName</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"search-service.dns"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">servicePort</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">8080</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="needReference: true\x7FreferenceLocation: &#x22;tail&#x22;  # Add references at the end of the response instead of the beginning\x7FsearchFrom:\x7F- type: bing\x7F  apiKey: &#x22;your-bing-key&#x22;\x7F  serviceName: &#x22;search-service.dns&#x22;\x7F  servicePort: 8080"><div></div></button></div></figure></div>
<h3 id="search-rewrite-configuration-1">Search Rewrite Configuration</h3>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#85E89D">searchFrom</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8">- </span><span style="--0:#85E89D">type</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">google</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">apiKey</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"your-google-api-key"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">cx</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"search-engine-id"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">serviceName</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"google-svc.dns"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">servicePort</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">443</span></div></div><div class="ec-line"><div class="code"><span style="--0:#85E89D">searchRewrite</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">llmServiceName</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"llm-svc.dns"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">llmServicePort</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">443</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">llmApiKey</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"your-llm-api-key"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">llmUrl</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"https://api.example.com/v1/chat/completions"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">llmModelName</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"gpt-3.5-turbo"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">timeoutMillisecond</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">15000</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="searchFrom:\x7F- type: google\x7F  apiKey: &#x22;your-google-api-key&#x22;\x7F  cx: &#x22;search-engine-id&#x22;\x7F  serviceName: &#x22;google-svc.dns&#x22;\x7F  servicePort: 443\x7FsearchRewrite:\x7F  llmServiceName: &#x22;llm-svc.dns&#x22;\x7F  llmServicePort: 443\x7F  llmApiKey: &#x22;your-llm-api-key&#x22;\x7F  llmUrl: &#x22;https://api.example.com/v1/chat/completions&#x22;\x7F  llmModelName: &#x22;gpt-3.5-turbo&#x22;\x7F  timeoutMillisecond: 15000"><div></div></button></div></figure></div>
<h3 id="on-demand-plugin-activation-configuration">On-Demand Plugin Activation Configuration</h3>
<p>Configure the plugin to only be enabled when the request contains a <code dir="auto">web_search_options</code> field:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#85E89D">defaultEnable</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">false</span></div></div><div class="ec-line"><div class="code"><span style="--0:#85E89D">searchFrom</span><span style="--0:#E1E4E8">:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8">- </span><span style="--0:#85E89D">type</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">google</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">apiKey</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"your-google-api-key"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">cx</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"search-engine-id"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">serviceName</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"google-svc.dns"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85E89D">servicePort</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">443</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="defaultEnable: false\x7FsearchFrom:\x7F- type: google\x7F  apiKey: &#x22;your-google-api-key&#x22;\x7F  cx: &#x22;search-engine-id&#x22;\x7F  serviceName: &#x22;google-svc.dns&#x22;\x7F  servicePort: 443"><div></div></button></div></figure></div>
<p>When the request contains a <code dir="auto">web_search_options</code> field, even if it\u2019s an empty object (<code dir="auto">"web_search_options": {}</code>), the plugin will be activated.</p>
<h3 id="search-context-size-configuration">Search Context Size Configuration</h3>
<p>You can dynamically adjust the number of search queries by adding a <code dir="auto">search_context_size</code> parameter in the <code dir="auto">web_search_options</code> field of the request:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#E1E4E8">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#79B8FF">"web_search_options"</span><span style="--0:#E1E4E8">: {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#79B8FF">"search_context_size"</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"medium"</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8">  </span></span><span style="--0:#E1E4E8">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="{\x7F  &#x22;web_search_options&#x22;: {\x7F    &#x22;search_context_size&#x22;: &#x22;medium&#x22;\x7F  }\x7F}"><div></div></button></div></figure></div>
<p>The <code dir="auto">search_context_size</code> supports three levels:</p>
<ul>
<li><code dir="auto">low</code>: Generates 1 search query (suitable for simple questions)</li>
<li><code dir="auto">medium</code>: Generates 3 search queries (default)</li>
<li><code dir="auto">high</code>: Generates 5 search queries (suitable for complex questions)</li>
</ul>
<p>This setting overrides the <code dir="auto">maxCount</code> value in the configuration, allowing clients to dynamically adjust search depth based on question complexity.</p>
<h2 id="notes">Notes</h2>
<ol>
<li>The prompt template must include <code dir="auto">{search_results}</code> and <code dir="auto">{question}</code> placeholders, optionally use <code dir="auto">{cur_date}</code> to insert current date (format: January 2, 2006)</li>
<li>The default template includes search results processing instructions and response specifications, you can use the default template unless there are special needs</li>
<li>Multiple search engines query in parallel, total timeout = maximum timeoutMillisecond value among all search engine configurations + processing time</li>
<li>Arxiv search doesn\u2019t require API key, but you can specify paper category (arxivCategory) to narrow search scope</li>
</ol>`,t={title:"AI Search Enhancement",keywords:["higress","ai search"],description:"Higress supports enhancing the accuracy and timeliness of responses from models like DeepSeek-R1 by integrating real-time results from search engines (Google/Bing/Arxiv/Elasticsearch etc.)"},a="/home/runner/work/higress-group.github.io/higress-group.github.io/src/content/docs/latest/en/plugins/ai/api-dev/ai-search.md",n=void 0,d=function(){return`
## Feature Description

The \`ai-search\` plugin enhances the accuracy and timeliness of AI model responses by integrating real-time results from search engines (Google/Bing/Arxiv/Elasticsearch etc.). The plugin automatically injects search results into the prompt template and determines whether to add reference sources in the final response based on configuration.

## Runtime Properties

Plugin execution stage: \`Default stage\`
Plugin execution priority: \`440\`

## Configuration Fields

| Name | Data Type | Requirement | Default Value | Description |
|------|-----------|-------------|---------------|-------------|
| defaultEnable | bool | Optional | true | Whether the plugin functionality is enabled by default. When set to false, the plugin will only be activated when the request contains a web_search_options field |
| needReference | bool | Optional | false | Whether to add reference sources in the response |
| referenceFormat | string | Optional | \`"**References:**\\n%s"\` | Reference content format, must include %s placeholder |
| referenceLocation | string | Optional | "head" | Reference position: "head" at the beginning of the response, "tail" at the end of the response |
| defaultLang | string | Optional | - | Default search language code (e.g. zh-CN/en-US) |
| promptTemplate | string | Optional | Built-in template | Prompt template, must include \`{search_results}\` and \`{question}\` placeholders |
| searchFrom | array of object | Required | - | Refer to search engine configuration below, at least one engine must be configured |
| searchRewrite | object | Optional | - | Search rewrite configuration, used to optimize search queries using an LLM service |

## Search Rewrite Description

The search rewrite feature uses an LLM service to analyze and optimize the user's original query, which can:
1. Determine whether the user's question requires a search engine query. If it does not, the search-related logic will not be executed
2. Convert natural language queries into keyword combinations better suited for search engines
3. For Arxiv paper searches, automatically identify relevant paper categories and add category constraints
4. For private knowledge base searches, break down long queries into multiple precise keyword combinations

It is strongly recommended to enable this feature when using Arxiv or Elasticsearch engines. For Arxiv searches, it can accurately identify paper domains and optimize English keywords; for private knowledge base searches, it can provide more precise keyword matching, significantly improving search effectiveness.

## Search Rewrite Configuration

| Name | Data Type | Requirement | Default Value | Description |
|------|-----------|-------------|---------------|-------------|
| llmServiceName | string | Required | - | LLM service name |
| llmServicePort | number | Required | - | LLM service port |
| llmApiKey | string | Optional | - | LLM service API key |
| llmUrl | string | Required | - | LLM service API URL |
| llmModelName | string | Required | - | LLM model name |
| timeoutMillisecond | number | Optional | 30000 | API call timeout (milliseconds) |
| maxCount | number | Optional | 3 | Maximum number of search queries generated by the search rewrite |

## Search Engine Common Configuration

| Name | Data Type | Requirement | Default Value | Description |
|------|-----------|-------------|---------------|-------------|
| type | string | Required | - | Engine type (google/bing/arxiv/elasticsearch/quark) |
| apiKey | string | Required | - | Search engine API key/Aliyun AccessKey |
| serviceName | string | Required | - | Backend service name |
| servicePort | number | Required | - | Backend service port |
| count | number | Optional | 10 | Number of results returned per search |
| start | number | Optional | 0 | Search result offset (start returning from the start+1 result) |
| timeoutMillisecond | number | Optional | 5000 | API call timeout (milliseconds) |
| optionArgs | map | Optional | - | Search engine specific parameters (key-value format) |

## Google Specific Configuration

| Name | Data Type | Requirement | Default Value | Description |
|------|-----------|-------------|---------------|-------------|
| cx | string | Required | - | Google Custom Search Engine ID, used to specify search scope |

## Arxiv Specific Configuration

| Name | Data Type | Requirement | Default Value | Description |
|------|-----------|-------------|---------------|-------------|
| arxivCategory | string | Optional | - | Search paper [category](https://arxiv.org/category_taxonomy) (e.g. cs.AI, cs.CL etc.) |

## Elasticsearch Specific Configuration

| Name | Data Type | Requirement | Default Value | Description                        |
|------|-----------|-------------|---------------|------------------------------------|
| index | string | Required    | - | Elasticsearch index name to search |
| contentField | string | Required    | - | Content field name to query        |
| semanticTextField | string | Required    | - | Embedding field name to query      |
| linkField | string | Optional    | - | Result link field name, needed when \`needReference\` is configured |
| titleField | string | Optional    | - | Result title field name, needed when \`needReference\` is configured          |
| username | string | Optional          | - | Elasticsearch username             |
| password | string | Optional    | - | Elasticsearch password             |

The [Reciprocal Rank Fusion (RRF)](https://www.elastic.co/guide/en/elasticsearch/reference/8.17/rrf.html) query used in hybrid search requires Elasticsearch version 8.8 or higher.

Currently, document vectorization relies on Elasticsearch's embedding model, which requires an Elasticsearch Enterprise license or a 30-day Trial license. To install the built-in embedding model in Elasticsearch, please refer to [this documentation](https://www.elastic.co/docs/explore-analyze/machine-learning/nlp/ml-nlp-elser#alternative-download-deploy). If you want to install a third-party embedding model, please refer to [this guide](https://www.elastic.co/docs/explore-analyze/machine-learning/nlp/ml-nlp-text-emb-vector-search-example).

For a complete tutorial on integrating the ai-search plugin with Elasticsearch, please refer to: [Building a RAG Application with LangChain + Higress + Elasticsearch](https://cr7258.github.io/blogs/original/2025/15-rag-higress-es-langchain).

## Quark Specific Configuration

| Name | Data Type | Requirement | Default Value | Description |
|------|-----------|-------------|---------------|-------------|
| contentMode | string | Optional | "summary" | Content mode: "summary" uses snippet, "full" uses full text (markdownText first, then mainText if empty) |

## Configuration Examples

### Basic Configuration (Single Search Engine)

\`\`\`yaml
needReference: true
searchFrom:
- type: google
  apiKey: "your-google-api-key"
  cx: "search-engine-id"
  serviceName: "google-svc.dns"
  servicePort: 443
  count: 5
  optionArgs:
    fileType: "pdf"
\`\`\`

### Arxiv Search Configuration

\`\`\`yaml
searchFrom:
- type: arxiv
  serviceName: "arxiv-svc.dns" 
  servicePort: 443
  arxivCategory: "cs.AI"
  count: 10
\`\`\`

### Quark Search Configuration

\`\`\`yaml
searchFrom:
- type: quark
  serviceName: "quark-svc.dns" 
  servicePort: 443
  apiKey: "quark api key"
  contentMode: "full"  # Optional values: "summary"(default) or "full"
\`\`\`

### Multiple Search Engines Configuration

\`\`\`yaml
defaultLang: "en-US"
promptTemplate: |
  # Search Results:
  {search_results}
  
  # Please answer this question: 
  {question}
searchFrom:
- type: google
  apiKey: "google-key"
  cx: "github-search-id"  # Search engine ID specifically for GitHub content
  serviceName: "google-svc.dns"
  servicePort: 443
- type: google
  apiKey: "google-key"
  cx: "news-search-id"    # Search engine ID specifically for Google News content 
  serviceName: "google-svc.dns"
  servicePort: 443
- type: bing
  apiKey: "bing-key"
  serviceName: "bing-svc.dns"
  servicePort: 443
  optionArgs:
    answerCount: "5"
\`\`\`

### Concurrent Query Configuration

Since search engines limit the number of results per query (e.g. Google limits to 100 results per query), you can get more results by:
1. Setting a smaller count value (e.g. 10)
2. Specifying result offset with start parameter
3. Concurrently initiating multiple query requests, with each request's start value incrementing by count

For example, to get 30 results, configure count=10 and concurrently initiate 3 queries with start values 0,10,20 respectively:

\`\`\`yaml
searchFrom:
- type: google
  apiKey: "your-google-api-key"
  cx: "search-engine-id"
  serviceName: "google-svc.dns"
  servicePort: 443
  start: 0
  count: 10
- type: google
  apiKey: "your-google-api-key"
  cx: "search-engine-id"
  serviceName: "google-svc.dns"
  servicePort: 443
  start: 10
  count: 10
- type: google
  apiKey: "your-google-api-key"
  cx: "search-engine-id"
  serviceName: "google-svc.dns"
  servicePort: 443
  start: 20
  count: 10 
\`\`\`

Note that excessive concurrency may lead to rate limiting, adjust according to actual situation.

### Elasticsearch Configuration (For Private Knowledge Base Integration)

\`\`\`yaml
searchFrom:
- type: elasticsearch
  serviceName: "es-svc.static"
  index: "knowledge_base"
  contentField: "content"
  semanticTextField: "semantic_text"
  # username: "elastic"
  # password: "password"
\`\`\`

### Custom Reference Format

\`\`\`yaml
needReference: true
referenceFormat: "### Data Sources\\n%s"
searchFrom: 
- type: bing
  apiKey: "your-bing-key"
  serviceName: "search-service.dns"
  servicePort: 8080
\`\`\`

### Custom Reference Location

\`\`\`yaml
needReference: true
referenceLocation: "tail"  # Add references at the end of the response instead of the beginning
searchFrom:
- type: bing
  apiKey: "your-bing-key"
  serviceName: "search-service.dns"
  servicePort: 8080
\`\`\`

### Search Rewrite Configuration

\`\`\`yaml
searchFrom:
- type: google
  apiKey: "your-google-api-key"
  cx: "search-engine-id"
  serviceName: "google-svc.dns"
  servicePort: 443
searchRewrite:
  llmServiceName: "llm-svc.dns"
  llmServicePort: 443
  llmApiKey: "your-llm-api-key"
  llmUrl: "https://api.example.com/v1/chat/completions"
  llmModelName: "gpt-3.5-turbo"
  timeoutMillisecond: 15000
\`\`\`

### On-Demand Plugin Activation Configuration

Configure the plugin to only be enabled when the request contains a \`web_search_options\` field:

\`\`\`yaml
defaultEnable: false
searchFrom:
- type: google
  apiKey: "your-google-api-key"
  cx: "search-engine-id"
  serviceName: "google-svc.dns"
  servicePort: 443
\`\`\`

When the request contains a \`web_search_options\` field, even if it's an empty object (\`"web_search_options": {}\`), the plugin will be activated.

### Search Context Size Configuration

You can dynamically adjust the number of search queries by adding a \`search_context_size\` parameter in the \`web_search_options\` field of the request:

\`\`\`json
{
  "web_search_options": {
    "search_context_size": "medium"
  }
}
\`\`\`

The \`search_context_size\` supports three levels:
- \`low\`: Generates 1 search query (suitable for simple questions)
- \`medium\`: Generates 3 search queries (default)
- \`high\`: Generates 5 search queries (suitable for complex questions)

This setting overrides the \`maxCount\` value in the configuration, allowing clients to dynamically adjust search depth based on question complexity.

## Notes

1. The prompt template must include \`{search_results}\` and \`{question}\` placeholders, optionally use \`{cur_date}\` to insert current date (format: January 2, 2006)
2. The default template includes search results processing instructions and response specifications, you can use the default template unless there are special needs
3. Multiple search engines query in parallel, total timeout = maximum timeoutMillisecond value among all search engine configurations + processing time
4. Arxiv search doesn't require API key, but you can specify paper category (arxivCategory) to narrow search scope`},c=function(){return e},l=function(){return[{depth:2,slug:"feature-description",text:"Feature Description"},{depth:2,slug:"runtime-properties",text:"Runtime Properties"},{depth:2,slug:"configuration-fields",text:"Configuration Fields"},{depth:2,slug:"search-rewrite-description",text:"Search Rewrite Description"},{depth:2,slug:"search-rewrite-configuration",text:"Search Rewrite Configuration"},{depth:2,slug:"search-engine-common-configuration",text:"Search Engine Common Configuration"},{depth:2,slug:"google-specific-configuration",text:"Google Specific Configuration"},{depth:2,slug:"arxiv-specific-configuration",text:"Arxiv Specific Configuration"},{depth:2,slug:"elasticsearch-specific-configuration",text:"Elasticsearch Specific Configuration"},{depth:2,slug:"quark-specific-configuration",text:"Quark Specific Configuration"},{depth:2,slug:"configuration-examples",text:"Configuration Examples"},{depth:3,slug:"basic-configuration-single-search-engine",text:"Basic Configuration (Single Search Engine)"},{depth:3,slug:"arxiv-search-configuration",text:"Arxiv Search Configuration"},{depth:3,slug:"quark-search-configuration",text:"Quark Search Configuration"},{depth:3,slug:"multiple-search-engines-configuration",text:"Multiple Search Engines Configuration"},{depth:3,slug:"concurrent-query-configuration",text:"Concurrent Query Configuration"},{depth:3,slug:"elasticsearch-configuration-for-private-knowledge-base-integration",text:"Elasticsearch Configuration (For Private Knowledge Base Integration)"},{depth:3,slug:"custom-reference-format",text:"Custom Reference Format"},{depth:3,slug:"custom-reference-location",text:"Custom Reference Location"},{depth:3,slug:"search-rewrite-configuration-1",text:"Search Rewrite Configuration"},{depth:3,slug:"on-demand-plugin-activation-configuration",text:"On-Demand Plugin Activation Configuration"},{depth:3,slug:"search-context-size-configuration",text:"Search Context Size Configuration"},{depth:2,slug:"notes",text:"Notes"}]},s=r((E,f,m)=>{const{layout:x,...i}=t;return i.file=a,i.url=n,p`${u()}${v(e)}`})});export{s as Content,h as __tla,c as compiledContent,s as default,a as file,t as frontmatter,l as getHeadings,d as rawContent,n as url};
