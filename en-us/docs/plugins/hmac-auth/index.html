<!doctype html>
<html lang="en-US" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-plugins/hmac-auth">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">HMAC authentication | Higress</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://higress.io/en-us/img/higress_logo_small.png"><meta data-rh="true" name="twitter:image" content="https://higress.io/en-us/img/higress_logo_small.png"><meta data-rh="true" property="og:url" content="https://higress.io/en-us/docs/plugins/hmac-auth"><meta data-rh="true" name="docusaurus_locale" content="en-us"><meta data-rh="true" name="docsearch:language" content="en-us"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="HMAC authentication | Higress"><meta data-rh="true" name="description" content="HMAC authentication plug-in configuration reference"><meta data-rh="true" property="og:description" content="HMAC authentication plug-in configuration reference"><meta data-rh="true" name="keywords" content="higress,hmac"><link data-rh="true" rel="icon" href="/en-us/img/higress_logo_small.png"><link data-rh="true" rel="canonical" href="https://higress.io/en-us/docs/plugins/hmac-auth"><link data-rh="true" rel="alternate" href="https://higress.io/en-us/docs/plugins/hmac-auth" hreflang="en-US"><link data-rh="true" rel="alternate" href="https://higress.io/zh-cn/docs/plugins/hmac-auth" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://higress.io/docs/plugins/hmac-auth" hreflang="default"><link data-rh="true" rel="alternate" href="https://higress.io/docs/plugins/hmac-auth" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/en-us/blog/rss.xml" title="Higress RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/en-us/blog/atom.xml" title="Higress Atom Feed">




<link rel="stylesheet" href="//g.alicdn.com/mamba/assets/0.0.19/mse-arc-ui.min.css">
<script src="//g.alicdn.com/mamba/assets/0.0.19/mse-arc-ui.min.js"></script>
<script src="//g.alicdn.com/alilog/mlog/aplus_v2.js" id="beacon-aplus" exparams="clog=o&amp;aplus&amp;sidx=aplusSidx&amp;ckx=aplusCkx"></script>
<script src="//g.alicdn.com/aes/??tracker/1.0.34/index.js,tracker-plugin-pv/2.4.5/index.js,tracker-plugin-event/1.2.5/index.js,tracker-plugin-jserror/1.0.13/index.js,tracker-plugin-api/1.1.14/index.js,tracker-plugin-perf/1.1.8/index.js,tracker-plugin-eventTiming/1.0.4/index.js"></script>
<script src="https://www.googletagmanager.com/gtag/js?id=G-YHS75WKFBR" async></script><link rel="stylesheet" href="/en-us/assets/css/styles.43bb74b6.css">
<link rel="preload" href="/en-us/assets/js/runtime~main.ae980f16.js" as="script">
<link rel="preload" href="/en-us/assets/js/main.a601270d.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/en-us/"><div class="navbar__logo"><img src="//img.alicdn.com/imgextra/i1/O1CN01I7WjVs1K33EQjInid_!!6000000001107-2-tps-960-290.png" alt="Higress logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="//img.alicdn.com/imgextra/i1/O1CN01I7WjVs1K33EQjInid_!!6000000001107-2-tps-960-290.png" alt="Higress logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/en-us/">HOME</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/en-us/docs/overview/what-is-higress">DOCS</a><a href="https://www.aliyun.com/product/aliware/mse?spm=higress-website.topbar.0.0.0" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">HIGRESS IN CLOUD</a><a href="https://free.aliyun.com/?searchKey=云原生网关&amp;spm=higress-website.topbar.0.0.0" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">CLOUD FREE TRIAL</a><a href="https://survey.aliyun.com/apps/zhiliao/SmDQwdihe" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">CASE COLLECTION</a><a class="navbar__item navbar__link" href="/en-us/docs/developers/developers_dev">DEVELOPERS</a><a class="navbar__item navbar__link" href="/en-us/blog">BLOG</a><a class="navbar__item navbar__link" href="/en-us/community">COMMUNITY</a><a href="https://github.com/alibaba/higress/releases" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">DOWNLOAD</a><a href="http://demo.higress.io/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">DEMO</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_DSK9"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>En</a><ul class="dropdown__menu"><li><a href="/en-us/docs/plugins/hmac-auth" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en-US">En</a></li><li><a href="/zh-cn/docs/plugins/hmac-auth" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-CN">中</a></li></ul></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Overview</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en-us/docs/overview/what-is-higress">What Is Higress</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en-us/docs/overview/roadmap">Roadmap</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en-us/docs/overview/faq">Higress FAQ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en-us/docs/overview/terminology">Higress Terminology</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active">User Doc</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en-us/docs/user/quickstart">Quick Start</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/en-us/docs/user/configmap">Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/en-us/docs/plugins/intro">Plugins</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/en-us/docs/plugins/intro">Introduction to the use of Wasm plugins</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/en-us/docs/plugins/custom">Custom Plugin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/en-us/docs/plugins/jwt-auth">JWT authentication</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/en-us/docs/plugins/hmac-auth">HMAC authentication</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/en-us/docs/plugins/key-auth">Key Authentication</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/en-us/docs/plugins/basic-auth">Basic Auth</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/en-us/docs/plugins/key-rate-limit">Rate limiting based on Key</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/en-us/docs/plugins/custom-response">Custom response</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/en-us/docs/plugins/bot-detect">Robot Detect</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/en-us/docs/plugins/request-block">request blocking</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/en-us/docs/plugins/waf">waf</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/en-us/docs/user/wasm-go">Parameters Configurations Guide</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Ops</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en-us/docs/ops/deploy-by-helm">Deploy Higress By Helm</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en-us/docs/ops/upgrade">Upgrade</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en-us/docs/ops/log">Log</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Developer Guide</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en-us/docs/dev/code">Code Reading Instructions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en-us/docs/dev/architecture">Higress Architecture Description</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/en-us/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">User Doc</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Plugins</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">HMAC authentication</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>HMAC authentication</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="function-description">Function Description<a href="#function-description" class="hash-link" aria-label="Direct link to Function Description" title="Direct link to Function Description">​</a></h2><p>The <code>hmac-auth</code> plugin implements the generation of tamper-proof signatures for HTTP requests based on HMAC algorithm, and uses the signature for identity authentication and authorization.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuration-fields">Configuration Fields<a href="#configuration-fields" class="hash-link" aria-label="Direct link to Configuration Fields" title="Direct link to Configuration Fields">​</a></h2><table><thead><tr><th>Name</th><th>Data Type</th><th>Required</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>consumers</code></td><td>array of object</td><td>Required</td><td>-</td><td>Configures the caller of the service to authenticate the request.</td></tr><tr><td><code>date_offset</code></td><td>number</td><td>Optional</td><td>-</td><td>Configures the maximum allowed time deviation of the client, in seconds. It is used to parse the client&#x27;s UTC time from <code>the Date</code> header of the request, and can be used to prevent replay attacks. If not configured, no validation is performed.</td></tr><tr><td><code>_rules_</code></td><td>array of object</td><td>Optional</td><td>-</td><td>Configures the access control list for specific routes or domains, used for authorization of requests.</td></tr></tbody></table><p>The configuration fields for each item in <code>consumers</code> are as follows :</p><table><thead><tr><th>Name</th><th>Data Type</th><th>Required</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>key</code></td><td>string</td><td>Required</td><td>-</td><td>Configures the key extracted from the <code>x-ca-key</code> header of the request.</td></tr><tr><td><code>secret</code></td><td>string</td><td>Required</td><td>-</td><td>Configures the secret used to generate the signature.</td></tr><tr><td><code>name</code></td><td>string</td><td>Required</td><td>-</td><td>Configures the name of the consumer.</td></tr></tbody></table><p>The configuration fields for each item in <code>_rules_</code> are as follows:</p><table><thead><tr><th>Name</th><th>Data Type</th><th>Required</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>_match_route_</code></td><td>array of string</td><td>Optional, either <code>_match_route_</code> or <code>_match_domain_</code> must be provided</td><td>-</td><td>Configures the name of the route to match.</td></tr><tr><td><code>_match_domain_</code></td><td>array of string</td><td>Optional, either <code>_match_route_</code> or <code>_match_domain_</code> must be provided</td><td>-</td><td>Configures the name of the domain to match.</td></tr><tr><td><code>allow</code></td><td>array of string</td><td>Required</td><td>-</td><td>Configures the name of the consumer to allow for requests that match the specified route or domain.</td></tr></tbody></table><p><strong>Note：</strong></p><ul><li>If <code>_rules_</code> is not configured, authentication is enabled for all routes on the current gateway instance by default ；</li><li>For requests that pass authentication and authorization, a <code>X-Mse-Consumer</code> header will be added to the request headers to identify the name of the consumer.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuration-example">Configuration Example<a href="#configuration-example" class="hash-link" aria-label="Direct link to Configuration Example" title="Direct link to Configuration Example">​</a></h2><p>The following configuration enables Hmac Auth authentication and authorization for specific routes or domains on the gateway. Note that the <code>key</code> field should not be duplicated.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="enabling-for-specific-routes-or-domains">Enabling for specific routes or domains<a href="#enabling-for-specific-routes-or-domains" class="hash-link" aria-label="Direct link to Enabling for specific routes or domains" title="Direct link to Enabling for specific routes or domains">​</a></h3><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">consumers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> appKey</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">example</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">secret</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> appSecret</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">example</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> consumer</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> appKey</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">example</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">secret</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> appSecret</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">example</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> consumer</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Configuring Fine-Grained Rules using _rules_ Field</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">_rules_</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Rule 1: Matching by route name.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">_match_route_</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> route</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> route</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">allow</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> consumer</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Rule 2: Applies based on domain name matching.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">_match_domain_</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;*.example.com&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> test.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">allow</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> consumer</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>allow</code> field under each matching rule specifies the list of callers allowed to access under that matching condition;</p><p>In this example, <code>route-a</code> and <code>route-b</code> specified in <code>_match_route_</code> are the route names filled in when creating the gateway route. When either of these routes is matched, it will allow access to the caller named <code>consumer-1</code>, while denying access to other callers；</p><p>In<code> _match_domain_</code>, <code>*.example.com</code> and <code>test.com</code> are used to match the requested domain name. When a match is found, it will allow access to the caller named <code>consumer-2</code>, while denying access to other callers；</p><p>Upon successful authentication, the <code>X-Mse-Consumer</code> field will be added to the request header with the value set to the caller&#x27;s name, such as <code>consumer-1</code>.。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="enable-at-the-gateway-instance-level">Enable at the Gateway Instance Level<a href="#enable-at-the-gateway-instance-level" class="hash-link" aria-label="Direct link to Enable at the Gateway Instance Level" title="Direct link to Enable at the Gateway Instance Level">​</a></h3><p>The following configuration enables HMAC authentication at the gateway instance level.</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">consumers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> appKey</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">example</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">secret</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> appSecret</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">example</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> consumer</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> appKey</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">example</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">secret</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> appSecret</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">example</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> consumer</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="description-of-signing-mechanism">Description of Signing Mechanism<a href="#description-of-signing-mechanism" class="hash-link" aria-label="Direct link to Description of Signing Mechanism" title="Direct link to Description of Signing Mechanism">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="configuration-preparation">Configuration Preparation<a href="#configuration-preparation" class="hash-link" aria-label="Direct link to Configuration Preparation" title="Direct link to Configuration Preparation">​</a></h3><p>As mentioned in the guide above, configure the credential settings required for generating and validating signatures in the plugin configuration.</p><ul><li>key: Used for setting in the request header <code>x-ca-key</code>.</li><li>secret: Used for generating the request signature.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="client-signature-generation-method">Client Signature Generation Method<a href="#client-signature-generation-method" class="hash-link" aria-label="Direct link to Client Signature Generation Method" title="Direct link to Client Signature Generation Method">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="overview-of-the-process">Overview of the Process<a href="#overview-of-the-process" class="hash-link" aria-label="Direct link to Overview of the Process" title="Direct link to Overview of the Process">​</a></h4><p>The process for generating a signature on the client side consists of three steps:</p><ol><li><p>Extracting key data from the original request to obtain a string to be signed.</p></li><li><p>Using encryption algorithms and the configured <code>secret</code> to encrypt the key data signing string and obtain a signature.</p></li><li><p>Adding all headers related to the signature to the original HTTP request to obtain the final HTTP request.</p></li></ol><p>As shown below :
<img loading="lazy" src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/1745707061/p188113.png" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="process-for-extracting-signing-string">Process for Extracting Signing String<a href="#process-for-extracting-signing-string" class="hash-link" aria-label="Direct link to Process for Extracting Signing String" title="Direct link to Process for Extracting Signing String">​</a></h4><p>To generate a signature, the client needs to extract key data from the HTTP request and combine it into a signing string. The format of the generated signing string is as follows:</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HTTPMethod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Accept</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-MD5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Date</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Headers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PathAndParameters</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The signing string consists of the above 7 fields separated by \n. If Headers is empty, no \n is needed. If other fields are empty, the \n should still be retained. The signature is case-sensitive. Below are the rules for extracting each field:</p><ul><li><p>HTTPMethod: The HTTP method used in the request, in all capital letters, such as POST.</p></li><li><p>Accept: The value of the Accept header in the request, which can be empty. It is recommended to explicitly set the Accept header. When Accept is empty, some HTTP clients will set the default value of <code>*/*</code>, which may cause signature verification to fail.</p></li><li><p>Content-MD5: The value of the Content-MD5 header in the request, which can be empty. It is only calculated when there is a non-form body in the request. The following is a reference calculation method for Content-MD5 values in ：</p></li></ul><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">String content-MD5 = Base64.encodeBase64(MD5(bodyStream.getbytes(&quot;UTF-8&quot;)));</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><p>Content-Type: The value of the Content-Type header in the request, which can be empty.</p></li><li><p>Date: The value of the Date header in the request. When the<code> date_offset</code> configuration is not enabled, it can be empty. Otherwise, it will be used for time offset verification.</p></li><li><p>Headers: Users can select specific headers to participate in the signature. There are the following rules for concatenating the signature string with headers:</p><ul><li>The keys of the headers participating in the signature calculation are sorted in alphabetical order and concatenated as follows:<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HeaderKey1 + &quot;:&quot; + HeaderValue1 + &quot;\n&quot;\+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HeaderKey2 + &quot;:&quot; + HeaderValue2 + &quot;\n&quot;\+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HeaderKeyN + &quot;:&quot; + HeaderValueN + &quot;\n&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li>If the value of a header is empty, it will participate in the signature with the <code>HeaderKey+&quot;:&quot;+&quot;\n&quot;</code> only, and the key and english colon should be retained.</li><li>The set of keys for all headers participating in the signature is separated by a comma and placed in the <code>X-Ca-Signature-Headers header</code>.</li><li>The following headers are not included in the header signature calculation: X-Ca-Signature, X-Ca-Signature-Headers, Accept, Content-MD5, Content-Type, Date.</li></ul></li><li><p>PathAndParameters: This field contains all parameters in the path, query, and form. The specific format is as follows:</p></li></ul><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Path + &quot;?&quot; + Key1 + &quot;=&quot; + Value1 + &quot;&amp;&quot; + Key2 + &quot;=&quot; + Value2 + ... &quot;&amp;&quot; + KeyN + &quot;=&quot; + ValueN</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Notes:</p><ol><li>The keys of the query and form parameter pairs are sorted alphabetically, and the same format as above is used for concatenation.</li><li>If there are no query and form parameters, use the path directly without adding <code>?</code> .</li><li>If the value of a parameter is empty, only the key will be included in the signature. The equal sign should not be included in the signature.</li><li>If there are array parameters in the query or form (parameters with the same key but different values), only the first value should be included in the signature calculation.</li></ol><h4 class="anchor anchorWithStickyNavbar_LWe7" id="example-of-extracting-signing-string">Example of Extracting Signing String<a href="#example-of-extracting-signing-string" class="hash-link" aria-label="Direct link to Example of Extracting Signing String" title="Direct link to Example of Extracting Signing String">​</a></h4><p>The initial HTTP request :</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">POST /http2test/test?param1=test HTTP/1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">host:api.aliyun.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">accept:application/json; charset=utf-8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ca_version:1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">content-type:application/x-www-form-urlencoded; charset=utf-8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x-ca-timestamp:1525872629832</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">date:Wed, 09 May 2018 13:30:29 GMT+00:00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user-agent:ALIYUN-ANDROID-DEMO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x-ca-nonce:c9f15cbf-f4ac-4a6c-b54d-f51abf4b5b44</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">content-length:33</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">username=xiaoming&amp;password=123456789</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The correct generated signature string is :</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">POST</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">application/json; charset=utf-8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">application/x-www-form-urlencoded; charset=utf-8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Wed, 09 May 2018 13:30:29 GMT+00:00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x-ca-key:203753385</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x-ca-nonce:c9f15cbf-f4ac-4a6c-b54d-f51abf4b5b44</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x-ca-signature-method:HmacSHA256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x-ca-timestamp:1525872629832</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/http2test/test?param1=test&amp;password=123456789&amp;username=xiaoming</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="signature-calculation-process">Signature Calculation Process<a href="#signature-calculation-process" class="hash-link" aria-label="Direct link to Signature Calculation Process" title="Direct link to Signature Calculation Process">​</a></h4><p>After extracting the key data from the HTTP request and assembling it into a signature string, the client needs to encrypt and encode the signature string to form the final signature.</p><p>The specific encryption format is as follows, where <code>stringToSign</code> is the extracted signature string, <code>secret</code> is the one filled in the plugin configuration, and <code>sign</code> is the final generated signature:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Mac hmacSha256 = Mac.getInstance(&quot;HmacSHA256&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">byte[] secretBytes = secret.getBytes(&quot;UTF-8&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hmacSha256.init(new SecretKeySpec(secretBytes, 0, secretBytes.length, &quot;HmacSHA256&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">byte[] result = hmacSha256.doFinal(stringToSign.getBytes(&quot;UTF-8&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">String sign = Base64.encodeBase64String(result);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In summary, the <code>stringToSign</code> is decoded using UTF-8 to obtain a Byte array. Then, an encryption algorithm is used to encrypt the Byte array, and finally, the Base64 algorithm is used to encode the encrypted data, resulting in the final signature.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="the-process-of-adding-a-signature">The Process of Adding a Signature<a href="#the-process-of-adding-a-signature" class="hash-link" aria-label="Direct link to The Process of Adding a Signature" title="Direct link to The Process of Adding a Signature">​</a></h4><p>The client needs to include the following four headers in the HTTP request to be transmitted to the API gateway for signature verification:</p><ul><li><p>x-ca-key: The value is the APP Key and is required.</p></li><li><p>x-ca-signature-method: The signature algorithm, the value can be HmacSHA256 or HmacSHA1, optional. The default value is HmacSHA256.</p></li><li><p>x-ca-signature-headers: The collection of keys for all signature headers, separated by commas. Optional.</p></li><li><p>x-ca-signature: The signature and it is required.</p></li></ul><p>Here is an example of a complete HTTP request with a signature :</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">POST /http2test/test?param1=test HTTP/1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">host:api.aliyun.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">accept:application/json; charset=utf-8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ca_version:1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">content-type:application/x-www-form-urlencoded; charset=utf-8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x-ca-timestamp:1525872629832</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">date:Wed, 09 May 2018 13:30:29 GMT+00:00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user-agent:ALIYUN-ANDROID-DEMO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x-ca-nonce:c9f15cbf-f4ac-4a6c-b54d-f51abf4b5b44</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x-ca-key:203753385</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x-ca-signature-method:HmacSHA256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x-ca-signature-headers:x-ca-timestamp,x-ca-key,x-ca-nonce,x-ca-signature-method</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x-ca-signature:xfX+bZxY2yl7EB/qdoDy9v/uscw3Nnj1pgoU+Bm6xdM=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">content-length:33</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">username=xiaoming&amp;password=123456789</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="server-side-signature-verification-method">Server-side Signature Verification Method<a href="#server-side-signature-verification-method" class="hash-link" aria-label="Direct link to Server-side Signature Verification Method" title="Direct link to Server-side Signature Verification Method">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="overview-of-the-process-1">Overview of the Process<a href="#overview-of-the-process-1" class="hash-link" aria-label="Direct link to Overview of the Process" title="Direct link to Overview of the Process">​</a></h4><p>The server-side signature verification of the client&#x27;s request involves four steps :</p><ol><li><p>Extract crucial data from the received request to obtain a string for signing.</p></li><li><p>Retrieve the <code>key</code> from the received request and use it to query its corresponding <code>secret</code>.</p></li><li><p>Encrypt the string for signing using the encryption algorithm and <code>secret</code>.</p></li><li><p>Retrieve the client&#x27;s signature from the received request, and compare the consistency of the server-side signature with the client&#x27;s signature.</p></li></ol><p>As shown below :
<img loading="lazy" src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/1745707061/p188116.png" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="troubleshooting-signature-errors">Troubleshooting Signature Errors<a href="#troubleshooting-signature-errors" class="hash-link" aria-label="Direct link to Troubleshooting Signature Errors" title="Direct link to Troubleshooting Signature Errors">​</a></h3><p>When the gateway signature verification fails, the server-side signing string (StringToSign) will be returned to the client in the HTTP Response Header. The key is X-Ca-Error-Message. Users only need to compare the locally calculated signing string with the server-side signing string returned to locate the problem;</p><p>If the StringToSign on the server side is consistent with that on the client side, please check whether the APP Secret used for signature calculation is correct；</p><p>Because line breaks cannot be represented in HTTP headers, all line breaks in the StringToSign are replaced with #, as shown below:</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">X-Ca-Error-Message:  Server StringToSign:`GET#application/json##application/json##X-Ca-Key:200000#X-Ca-Timestamp:1589458000000#/app/v1/config/keys?keys=TEST`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="related-error-codes">Related Error Codes<a href="#related-error-codes" class="hash-link" aria-label="Direct link to Related Error Codes" title="Direct link to Related Error Codes">​</a></h2><table><thead><tr><th>HTTP Status Code</th><th>Error Message</th><th>Reason</th></tr></thead><tbody><tr><td>401</td><td>Invalid Key</td><td>The x-ca-key request header is not provided or is invalid.</td></tr><tr><td>401</td><td>Empty Signature</td><td>The x-ca-signature request header does not contain a signature.</td></tr><tr><td>400</td><td>Invalid Signature</td><td>The x-ca-signature request header contains a signature that does not match the server-calculated signature.</td></tr><tr><td>400</td><td>Invalid Content-MD5</td><td>The content-md5 request header is incorrect.</td></tr><tr><td>400</td><td>Invalid Date</td><td>The time offset calculated based on the date request header exceeds the configured date_offset.</td></tr><tr><td>413</td><td>Request Body Too Large</td><td>The request body exceeds the size limit of 32 MB.</td></tr><tr><td>413</td><td>Payload Too Large</td><td>The request body exceeds the DownstreamConnectionBufferLimits global configuration.</td></tr><tr><td>403</td><td>Unauthorized Consumer</td><td>The requesting party does not have access permission.</td></tr></tbody></table></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/higress-group/higress-group.github.io/blob/main/i18n/en-us/docusaurus-plugin-content-docs/current/plugins/hmac-auth.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/en-us/docs/plugins/jwt-auth"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">JWT authentication</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/en-us/docs/plugins/key-auth"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Key Authentication</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#function-description" class="table-of-contents__link toc-highlight">Function Description</a></li><li><a href="#configuration-fields" class="table-of-contents__link toc-highlight">Configuration Fields</a></li><li><a href="#configuration-example" class="table-of-contents__link toc-highlight">Configuration Example</a><ul><li><a href="#enabling-for-specific-routes-or-domains" class="table-of-contents__link toc-highlight">Enabling for specific routes or domains</a></li><li><a href="#enable-at-the-gateway-instance-level" class="table-of-contents__link toc-highlight">Enable at the Gateway Instance Level</a></li></ul></li><li><a href="#description-of-signing-mechanism" class="table-of-contents__link toc-highlight">Description of Signing Mechanism</a><ul><li><a href="#configuration-preparation" class="table-of-contents__link toc-highlight">Configuration Preparation</a></li><li><a href="#client-signature-generation-method" class="table-of-contents__link toc-highlight">Client Signature Generation Method</a></li><li><a href="#server-side-signature-verification-method" class="table-of-contents__link toc-highlight">Server-side Signature Verification Method</a></li><li><a href="#troubleshooting-signature-errors" class="table-of-contents__link toc-highlight">Troubleshooting Signature Errors</a></li></ul></li><li><a href="#related-error-codes" class="table-of-contents__link toc-highlight">Related Error Codes</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Vision</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/en-us/">Higress is ...</a></li></ul></div><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/en-us/docs/overview/what-is-higress">What is Higress?</a></li><li class="footer__item"><a class="footer__link-item" href="/en-us/docs/user/quickstart">Quick Start</a></li><li class="footer__item"><a href="https://github.com/higress-group/higress-group.github.io/issues/new" target="_blank" rel="noopener noreferrer" class="footer__link-item">Report a doc issue<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/higress-group/higress-group.github.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Edit This Page on GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/en-us/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/en-us/community">Community</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="//img.alicdn.com/imgextra/i2/O1CN01oNTGgE1lfW7oEPIzP_!!6000000004846-2-tps-960-290.png" class="themedImage_ToTc themedImage--light_HNdA footer__logo" width="120" height="36"><img src="//img.alicdn.com/imgextra/i2/O1CN01oNTGgE1lfW7oEPIzP_!!6000000004846-2-tps-960-290.png" class="themedImage_ToTc themedImage--dark_i4oU footer__logo" width="120" height="36"></div><div class="footer__copyright">Copyright © 2023 Higress<br>浙公网安备 33011002016922号 浙ICP备12022327号-1119</div></div></div></footer></div>
<script src="/en-us/assets/js/runtime~main.ae980f16.js"></script>
<script src="/en-us/assets/js/main.a601270d.js"></script>
</body>
</html>