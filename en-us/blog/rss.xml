<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>Higress Blog</title>
        <link>https://higress.io/en-us/blog</link>
        <description>Higress Blog</description>
        <lastBuildDate>Tue, 16 Jan 2024 08:26:43 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>en-us</language>
        <item>
            <title><![CDATA[2023-kubecon]]></title>
            <link>https://higress.io/en-us/blog/2023-kubecon</link>
            <guid>https://higress.io/en-us/blog/2023-kubecon</guid>
            <pubDate>Tue, 16 Jan 2024 08:26:43 GMT</pubDate>
            <description><![CDATA[Placeholder. DO NOT DELETE.]]></description>
            <content:encoded><![CDATA[<p>Placeholder. DO NOT DELETE.</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[DeployOnWindows]]></title>
            <link>https://higress.io/en-us/blog/DeployOnWindows</link>
            <guid>https://higress.io/en-us/blog/DeployOnWindows</guid>
            <pubDate>Tue, 16 Jan 2024 08:26:43 GMT</pubDate>
            <description><![CDATA[Placeholder. DO NOT DELETE.]]></description>
            <content:encoded><![CDATA[<p>Placeholder. DO NOT DELETE.</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[config-with-file]]></title>
            <link>https://higress.io/en-us/blog/config-with-file</link>
            <guid>https://higress.io/en-us/blog/config-with-file</guid>
            <pubDate>Tue, 16 Jan 2024 08:26:43 GMT</pubDate>
            <description><![CDATA[Placeholder. DO NOT DELETE.]]></description>
            <content:encoded><![CDATA[<p>Placeholder. DO NOT DELETE.</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[configmap]]></title>
            <link>https://higress.io/en-us/blog/configmap</link>
            <guid>https://higress.io/en-us/blog/configmap</guid>
            <pubDate>Tue, 16 Jan 2024 08:26:43 GMT</pubDate>
            <description><![CDATA[Placeholder. DO NOT DELETE.]]></description>
            <content:encoded><![CDATA[<p>Placeholder. DO NOT DELETE.</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[e2e-debug]]></title>
            <link>https://higress.io/en-us/blog/e2e-debug</link>
            <guid>https://higress.io/en-us/blog/e2e-debug</guid>
            <pubDate>Tue, 16 Jan 2024 08:26:43 GMT</pubDate>
            <description><![CDATA[Placeholder. DO NOT DELETE.]]></description>
            <content:encoded><![CDATA[<p>Placeholder. DO NOT DELETE.</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[hring]]></title>
            <link>https://higress.io/en-us/blog/hring</link>
            <guid>https://higress.io/en-us/blog/hring</guid>
            <pubDate>Tue, 16 Jan 2024 08:26:43 GMT</pubDate>
            <description><![CDATA[Placeholder. DO NOT DELETE.]]></description>
            <content:encoded><![CDATA[<p>Placeholder. DO NOT DELETE.</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ospp-2023]]></title>
            <link>https://higress.io/en-us/blog/ospp-2023</link>
            <guid>https://higress.io/en-us/blog/ospp-2023</guid>
            <pubDate>Tue, 16 Jan 2024 08:26:43 GMT</pubDate>
            <description><![CDATA[Placeholder. DO NOT DELETE.]]></description>
            <content:encoded><![CDATA[<p>Placeholder. DO NOT DELETE.</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[plugin-transformer]]></title>
            <link>https://higress.io/en-us/blog/plugin-transformer</link>
            <guid>https://higress.io/en-us/blog/plugin-transformer</guid>
            <pubDate>Tue, 16 Jan 2024 08:26:43 GMT</pubDate>
            <description><![CDATA[Placeholder. DO NOT DELETE.]]></description>
            <content:encoded><![CDATA[<p>Placeholder. DO NOT DELETE.</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[release-070]]></title>
            <link>https://higress.io/en-us/blog/release-070</link>
            <guid>https://higress.io/en-us/blog/release-070</guid>
            <pubDate>Tue, 16 Jan 2024 08:26:43 GMT</pubDate>
            <description><![CDATA[Placeholder. DO NOT DELETE.]]></description>
            <content:encoded><![CDATA[<p>Placeholder. DO NOT DELETE.</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[release-1.3]]></title>
            <link>https://higress.io/en-us/blog/release-1.3</link>
            <guid>https://higress.io/en-us/blog/release-1.3</guid>
            <pubDate>Tue, 16 Jan 2024 08:26:43 GMT</pubDate>
            <description><![CDATA[Placeholder. DO NOT DELETE.]]></description>
            <content:encoded><![CDATA[<p>Placeholder. DO NOT DELETE.</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[release-100]]></title>
            <link>https://higress.io/en-us/blog/release-100</link>
            <guid>https://higress.io/en-us/blog/release-100</guid>
            <pubDate>Tue, 16 Jan 2024 08:26:43 GMT</pubDate>
            <description><![CDATA[Placeholder. DO NOT DELETE.]]></description>
            <content:encoded><![CDATA[<p>Placeholder. DO NOT DELETE.</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[skywalking]]></title>
            <link>https://higress.io/en-us/blog/skywalking</link>
            <guid>https://higress.io/en-us/blog/skywalking</guid>
            <pubDate>Tue, 16 Jan 2024 08:26:43 GMT</pubDate>
            <description><![CDATA[Placeholder. DO NOT DELETE.]]></description>
            <content:encoded><![CDATA[<p>Placeholder. DO NOT DELETE.</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[user-mq]]></title>
            <link>https://higress.io/en-us/blog/user-mq</link>
            <guid>https://higress.io/en-us/blog/user-mq</guid>
            <pubDate>Tue, 16 Jan 2024 08:26:43 GMT</pubDate>
            <description><![CDATA[Placeholder. DO NOT DELETE.]]></description>
            <content:encoded><![CDATA[<p>Placeholder. DO NOT DELETE.</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[user-uu]]></title>
            <link>https://higress.io/en-us/blog/user-uu</link>
            <guid>https://higress.io/en-us/blog/user-uu</guid>
            <pubDate>Tue, 16 Jan 2024 08:26:43 GMT</pubDate>
            <description><![CDATA[Placeholder. DO NOT DELETE.]]></description>
            <content:encoded><![CDATA[<p>Placeholder. DO NOT DELETE.</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[AIGC OpenAPI Cost Reduction via Higress]]></title>
            <link>https://higress.io/en-us/blog/ai_plugin</link>
            <guid>https://higress.io/en-us/blog/ai_plugin</guid>
            <pubDate>Wed, 12 Jul 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[This paper introduces the usage of higress in AIGC application.]]></description>
            <content:encoded><![CDATA[<p>AIGC applications represented by ChatGPT have brought great changes to enterprise production and greatly improved people's production efficiency. Large AI models can help to complete various complex tasks, such as helping developers write, debug and record codes, researchers quickly understand scientific research fields, marketers write product descriptions, etc. More and more enterprises have begun to attach importance to AIGC application development. How to manage the API of large AI models through the gateway has become a concern. </p><p><a href="https://github.com/alibaba/higress/blob/main/README_EN.md" target="_blank" rel="noopener noreferrer">Higress</a> is a next-generation cloud-native gateway based on Alibaba's internal gateway practices. Powered by <a href="https://github.com/istio/istio" target="_blank" rel="noopener noreferrer">Istio</a> and <a href="https://github.com/envoyproxy/envoy" target="_blank" rel="noopener noreferrer">Envoy</a>, Higress realizes the integration of the triple gateway architecture of traffic gateway, microservice gateway, and security gateway, thereby greatly reducing the costs of deployment, operation, and maintenance. Based on the rich capabilities provided by Higress, enterprises can greatly reduce the cost of using large AI models.</p><h1>How does Higress reduce the cost of using AI models?</h1><p>Taking OpenAI as an example, OpenAI's APIs are priced not based on the number of requests or subscription time but based on the usage of each request. For large AI models, tokens are the standard billing strategy for OpenAI API as a measure of the complexity of inference tasks. The cost for tokens varies based on the model. Generally, more complex models give better results at a higher cost.  API Keys are distributed to consumers for authentication and charging. </p><p><img loading="lazy" src="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/103456511/1688523788955-ef30f3fa-9916-48cf-baf7-dcdc9d733a8a.png#clientId=u000cf9ed-697b-4&amp;from=paste&amp;height=303&amp;id=VzJLA&amp;originHeight=1436&amp;originWidth=3392&amp;originalType=binary&amp;ratio=2&amp;rotation=0&amp;showTitle=false&amp;size=3514703&amp;status=done&amp;style=none&amp;taskId=uf85155a3-3c08-4964-a503-f0274c5869f&amp;title=&amp;width=715.9957275390625" alt="image.png" class="img_ev3q"></p><p>It is unrealistic for an organization to apply for an API Key for each member. Scattered API keys will not be conducive to the organization's calculation, management, and payment of API usage, thereby increasing the cost of using large AI models. For organizations, the selection and access rights of AI models, the frequency of use of AI models and access permissions, and the management and protection of data exposed to AI models are all important API management.   </p><p>Based on rich plugin capabilities, Higress provides functions such as authentication, request filtering, traffic control, usage monitoring, and security protection, helping organizations interact with large AI model APIs more securely, reliably, and observably. Based on the <strong>authentication</strong> provided by Higress, organizations can implement multi-tenant authentication and grant different AI model access rights to team members; based on the <strong>traffic control</strong> capability, organizations can set differentiated access rate limits for different models and users, effectively reducing the cost of using AI model; based on the <strong>request interception</strong> capability, organizations can effectively filter access requests containing sensitive information, and protect some internal site resources from being exposed to the outside world, effectively ensuring data security. Based on the index query and log system capabilities provided by <a href="https://www.aliyun.com/product/aliware/mse?spm=higress-website.topbar.0.0.0" target="_blank" rel="noopener noreferrer">Commercial Higress</a>, organizations can <strong>observe</strong> and <strong>analyze</strong> the usage of AI model calls by different users to formulate more reasonable AI model usage strategies.   </p><p><img loading="lazy" src="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/103456511/1689125555906-388e3f46-4070-414e-9f67-293bfc8c49e2.png#clientId=u7d7dc920-d9bf-4&amp;from=paste&amp;height=373&amp;id=u5c1bba9d&amp;originHeight=820&amp;originWidth=2302&amp;originalType=binary&amp;ratio=2.200000047683716&amp;rotation=0&amp;showTitle=false&amp;size=1205356&amp;status=done&amp;style=none&amp;taskId=u6a5fcf97-095d-4300-9831-749a537703c&amp;title=&amp;width=1046.3636136843159" alt="image.png" class="img_ev3q"></p><h1>Manage OpenAI API with Higress</h1><p>We will take Higress connecting to the OpenAI API as an example to introduce how Higress seamlessly connects to the large AI model. The overall solution is shown in Fig.3. We have extended the Higress plugin based on WASM to proxy requests to the OpenAI language model. Based on authentication plugins such as Key Auth, we implement multi-tenant authentication under a unified OpenAI API-Key. Based on the Request-Block plugin, we implement the interception of requests with sensitive information and ensure data protection.</p><p><img loading="lazy" src="https://intranetproxy.alipay.com/skylark/lark/0/2023/jpeg/103456511/1689043915532-1c902ce8-9d12-4b5b-8577-5f9b8711b272.jpeg" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h2><ol><li>Install Higress. Please refer to <a href="https://higress.io/en-us/docs/ops/deploy-by-helm/" target="_blank" rel="noopener noreferrer">Deploy Higress by Helm</a>.</li><li>Prepare the development environment for WASM plugins with Golang. Please refer to <a href="https://higress.io/en-us/docs/user/wasm-go/" target="_blank" rel="noopener noreferrer">Developing a WASM plugin with Golang | Higress</a>.</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ai-proxy-wasm-plugin">AI Proxy WASM Plugin<a href="#ai-proxy-wasm-plugin" class="hash-link" aria-label="Direct link to AI Proxy WASM Plugin" title="Direct link to AI Proxy WASM Plugin">​</a></h2><p>The following will give the AI proxy plugin implementation based on Higress and WASM. Higress supports scalability externally based on WASM. The multi-language ecology and hot-swapping mechanism provided by the WASM facilitate the implementation and deployment of the plugin. Higress also supports requesting external services in the plugin, which provides an efficient solution path for the implementation of the AI proxy plugin.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="code-implementation">Code Implementation<a href="#code-implementation" class="hash-link" aria-label="Direct link to Code Implementation" title="Direct link to Code Implementation">​</a></h3><p>The following code implements the request proxy to OPENAI-API based on HTTP. For details, please refer to the <a href="https://github.com/alibaba/higress/tree/main/plugins/wasm-go/extensions/chatgpt-proxy" target="_blank" rel="noopener noreferrer">AI proxy plugin</a>. The specific implementation steps are as follows:</p><ol><li>Create a new HTTP client, specify the OpenAI API host through the RouteCluster method, and determine the request proxy path.</li></ol><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">parseConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">json gjson</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Result</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> config </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">MyConfig</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> log wrapper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Log</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//The default forwarding path is OpenAI API. </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//Users can adjust through configuration.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    chatgptUri </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"chatgptUri"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">String</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> chatgptHost </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> chatgptUri </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">""</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ChatgptPath </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"/v1/completions"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        chatgptHost </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"api.openai.com"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//Specify the specific request proxy host through RouteCluster.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> wrapper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewClusterClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">wrapper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">RouteCluster</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> chatgptHost</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>Encapsulate the request in the OpenAI-API format, send requests and receive responses through the HTTP Client, and send responses to the user.</li></ol><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//OPENAI API request body template. Please refer to https://platform.openai.com/docs/api-reference/chat</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> bodyTemplate </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">`</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">"model":"%s",</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">"prompt":"%s",</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">"temperature":0.9,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">"max_tokens": 150,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">"top_p": 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">"frequency_penalty": 0.0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">"presence_penalty": 0.6,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">"stop": ["%s", "%s"]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">onHttpRequestHeaders</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx wrapper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">HttpContext</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> config MyConfig</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> log wrapper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Log</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> types</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Action </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//Encapsulate the OPENAI API request body according to the user's request content.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    body </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Sprintf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bodyTemplate</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Model</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prompt</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">HumanId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">AIId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//Post request via HTTP client.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    err </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ChatgptPath</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">"Content-Type"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"application/json"</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">"Authorization"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Bearer "</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ApiKey</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token function" style="color:#d73a49">byte</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">body</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">func</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">statusCode </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> responseHeaders http</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Header</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> responseBody </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">byte</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> headers </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">range</span><span class="token plain"> responseHeaders </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                headers </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">headers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">//Receive the response from the OPENAI API and send it to user</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            proxywasm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">SendHttpResponse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">uint32</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">statusCode</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> headers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> responseBody</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Enable the custom AI-Proxy-Wasm plugin in Higress as follows:</p><p><img loading="lazy" src="https://intranetproxy.alipay.com/skylark/lark/0/2023/jpeg/103456511/1689128762997-2b14f1b5-8120-427a-b503-dab6e286de53.jpeg" class="img_ev3q"></p><p>This example provides the compiled AI-proxy-plugin WASM file and completes the construction and push of the docker image. The recommended configuration is as follows:</p><table><thead><tr><th><strong>Name</strong></th><th><strong>Recommended configuration</strong></th></tr></thead><tbody><tr><td>Image URL</td><td>oci://registry.cn-hangzhou.aliyuncs.com/zwj_test/chatgpt-proxy:1.0.0</td></tr><tr><td>Plugin Execution Phase</td><td>Authz</td></tr><tr><td>Plugin Execution Priority</td><td>1</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="plugin-configuration-instructions">Plugin configuration instructions<a href="#plugin-configuration-instructions" class="hash-link" aria-label="Direct link to Plugin configuration instructions" title="Direct link to Plugin configuration instructions">​</a></h3><p>AI-Proxy-Plugin is easy to configure and supports proxy forwarding at the global/domain name level/routing level. Route-level configuration is recommended: <strong>route config</strong>-<strong>strategy</strong>-<strong>enable plugin</strong>. An example configuration is as follows：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiKey</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"xxxxxxxxxxxxxxxxxx"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">model</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"curie"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">promptParam</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"text"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>According to this configuration, the gateway proxies to the Curie model in OpenAI, and the user enters prompts in the URL through the keyword "text".</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"http://{GatewayIP}/?text=Say,hello"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Response from Curie model in OpenAI:</p><p><img loading="lazy" src="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/103456511/1688630702128-6060fad6-4e47-4223-bc02-d9a240db9263.png#clientId=u743d3343-6ab1-4&amp;from=paste&amp;height=137&amp;id=FIkxG&amp;originHeight=520&amp;originWidth=3170&amp;originalType=binary&amp;ratio=1.100000023841858&amp;rotation=0&amp;showTitle=false&amp;size=1213836&amp;status=done&amp;style=none&amp;taskId=u38ba4744-5835-4092-8291-ddfede62f55&amp;title=&amp;width=833.178955078125" alt="image.png" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="multi-tenant-authentication-based-on-key-auth">Multi-tenant authentication based on Key Auth<a href="#multi-tenant-authentication-based-on-key-auth" class="hash-link" aria-label="Direct link to Multi-tenant authentication based on Key Auth" title="Direct link to Multi-tenant authentication based on Key Auth">​</a></h2><p>Different from the form of issuing AI-API keys for each member, enterprises can utilize internal authorization (such as Key Auth, etc.) and rely on the unified AI-API key for request proxy to achieve unified management of API usage. </p><p>Key Auth implements the authentication based on the Gateway level API Key. Key Auth supports parsing the API Key from the URL parameter or request header of the HTTP requests and verifies whether the API has permission to access. </p><p><img loading="lazy" src="https://intranetproxy.alipay.com/skylark/lark/0/2023/jpeg/103456511/1689140841602-01d8dd1d-7b9f-42a1-a951-d149e922ebac.jpeg" class="img_ev3q"></p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">consumers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">credential</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"xxxxxx"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"consumer1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">credential</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"yyyyyy"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"consumer2"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">global_auth</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">in_header</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">keys</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"apikey"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://intranetproxy.alipay.com/skylark/lark/0/2023/jpeg/103456511/1689130328559-c542f754-04ab-4c89-93b6-f6e511c9f0e2.jpeg" class="img_ev3q"></p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">allow</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">consumer1</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The above configuration defines consumers, and only consumer1 has the access right to the AI model service under the current route.</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl "http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">GatewayIP</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">/</span><span class="token punctuation" style="color:#393A34">?</span><span class="token plain">text=Say</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">hello"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#The request does not provide an API Key, return 401</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl "http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">GatewayIP</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">/</span><span class="token punctuation" style="color:#393A34">?</span><span class="token plain">text=Say</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">hello" </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">H "apikey</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">zzzzzz"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#The API Key provided by the request is not authorized to access, return 401</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl  "http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">GatewayIP</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">/</span><span class="token punctuation" style="color:#393A34">?</span><span class="token plain">text=Say</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">hello" </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">H "apikey</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">yyyyyy"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#The caller matched according to the API Key provided in the request has no access rights, return 403</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl "http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">GatewayIP</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">/</span><span class="token punctuation" style="color:#393A34">?</span><span class="token plain">text=Say</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">hello" </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">H "apikey</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">xxxxxx"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#The caller has access to the AI model service, the request will be proxied to the AI model, and the response from the OpenAI API will be received normally</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In addition to providing gateway-level multi-tenant authentication, Higress provides traffic control and other capabilities. The Key Rate Limit plugin can limit the user's application rate based on the user's membership in the consumption group. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="data-protection-based-on-request-block">Data protection based on Request Block<a href="#data-protection-based-on-request-block" class="hash-link" aria-label="Direct link to Data protection based on Request Block" title="Direct link to Data protection based on Request Block">​</a></h2><p>For AIGC applications, especially LLM services, a good return often requires users to provide enough prompts as model input. Users face the risk of data leakage in the process of providing prompts. Ensuring data security in the process of using the AIGC application is also an important issue for API callers. </p><p>Protecting data security involves stringent control over the API calling channels. One method involves confirming specifically approved models with their published API. Another way is to intercept user requests containing sensitive information. These can be achieved by setting specific request interception at the gateway level. Higress provides request interception based on the request block plugin, which can prevent unauthorized models from accessing user information and prevent user requests containing sensitive information from being exposed to the external network.
<img loading="lazy" src="https://intranetproxy.alipay.com/skylark/lark/0/2023/jpeg/103456511/1689131852975-b35f7a0d-8e4d-4fd0-b805-fa168159f94f.jpeg" class="img_ev3q"></p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">blocked_code</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">404</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">block_urls</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> password</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> pw</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">case_sensitive</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The above configuration defines URL-based shielding fields under the current route, in which requests containing sensitive information such as "password" and "pw" will be blocked。</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl "http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">GatewayIP</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">/</span><span class="token punctuation" style="color:#393A34">?</span><span class="token plain">text=Mypassword=xxxxxx" </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">H "apikey</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">xxxxxx"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl "http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">GatewayIP</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">/</span><span class="token punctuation" style="color:#393A34">?</span><span class="token plain">text=pw=xxxxxx" </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">H "apikey</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">xxxxxx"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#The above request will be forbidden and return 404</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="usage-observation-and-analysis">Usage observation and analysis<a href="#usage-observation-and-analysis" class="hash-link" aria-label="Direct link to Usage observation and analysis" title="Direct link to Usage observation and analysis">​</a></h2><p>For organizations, observing and analyzing the usage of large AI model calls for each user helps to understand their usage and costs. It is also necessary for individual users to understand their own call volume and overhead.  <a href="https://www.aliyun.com/product/aliware/mse?spm=higress-website.topbar.0.0.0" target="_blank" rel="noopener noreferrer">Commercial Higress</a> is deeply integrated with various metrics and log systems and provides an out-of-the-box usage observation and analysis report construction mechanism, which can view the usage of various APIs in real time and filter according to various parameters.</p><p>Taking the observation of each user's usage of the OPENAI-Curie model as an example, the administrator can set the observability parameter in the request header：x-mse-consumer, to distinguish users through <strong>MSE console</strong> - <strong>Cloud native Gateway</strong> - <strong>Gateway instance</strong> - <strong>Parameter Configurator</strong>- <strong>Custom Format</strong>. After adding the observability parameters, enter the <strong>Observation Analysis </strong>-<strong> Log Center</strong> to set the use statistics chart function to complete the observation and analysis of API usage. As shown in the figure below, the amount of calls to the OPENAI-Curie model of user consumer1 and user consumer2 is presented in the form of a pie chart.</p><p><img loading="lazy" src="https://intranetproxy.alipay.com/skylark/lark/0/2023/png/103456511/1689133126041-96a120ea-34b3-488a-8d75-8a296ac41b12.png#clientId=uaea7149c-f4cc-4&amp;from=paste&amp;height=400&amp;id=u56e5ce08&amp;originHeight=879&amp;originWidth=2334&amp;originalType=binary&amp;ratio=2.200000047683716&amp;rotation=0&amp;showTitle=false&amp;size=1418178&amp;status=done&amp;style=none&amp;taskId=u99bdb280-d7e5-4c5c-acc8-dff0c104c03&amp;title=&amp;width=1060.909067914506" alt="image.png" class="img_ev3q"></p><h1>Join the Higress community</h1><p>Join Higress Slack: <a href="https://join.slack.com/t/w1689142780-euk177225/shared_invite/zt-1zbjm9d34-4nptVXPpNvnuKEKZ7V3MIg" target="_blank" rel="noopener noreferrer">https://join.slack.com/t/w1689142780-euk177225/shared_invite/zt-1zbjm9d34-4nptVXPpNvnuKEKZ7V3MIg</a></p><p>To get invited: <a href="https://communityinviter.com/apps/w1689142780-euk177225/higress" target="_blank" rel="noopener noreferrer">https://communityinviter.com/apps/w1689142780-euk177225/higress</a></p><p>If you find Higress helpful, welcome to <a href="https://github.com/alibaba/higress" target="_blank" rel="noopener noreferrer">Higress</a> to star us!</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Higress + Nacos Microservice Gateway Best Practices]]></title>
            <link>https://higress.io/en-us/blog/nacos</link>
            <guid>https://higress.io/en-us/blog/nacos</guid>
            <pubDate>Tue, 10 Jan 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[Higress： the best partner of Nacos]]></description>
            <content:encoded><![CDATA[<p>TBD</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[30 lines of code to write a Wasm Go plugin]]></title>
            <link>https://higress.io/en-us/blog/30-line-wasm</link>
            <guid>https://higress.io/en-us/blog/30-line-wasm</guid>
            <pubDate>Tue, 22 Nov 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[30 lines of code to write a Wasm Go plugin]]></description>
            <content:encoded><![CDATA[<p>TBD</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Welcome to sign up for Higress' first offline meetup]]></title>
            <link>https://higress.io/en-us/blog/first-meetup</link>
            <guid>https://higress.io/en-us/blog/first-meetup</guid>
            <pubDate>Tue, 22 Nov 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[Offline Meetup registration]]></description>
            <content:encoded><![CDATA[<p><img loading="lazy" src="https://img.alicdn.com/imgextra/i4/O1CN013pqDug1iTf1wdYIat_!!6000000004414-2-tps-800-8358.png" class="img_ev3q"></p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Alibaba Open Source Cloud Native Gateway： Higress]]></title>
            <link>https://higress.io/en-us/blog/higress</link>
            <guid>https://higress.io/en-us/blog/higress</guid>
            <pubDate>Fri, 04 Nov 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[This paper introduces the background and development stages of Higress]]></description>
        </item>
    </channel>
</rss>