<!DOCTYPE html><span class="blog-slug-wrapper"> <html lang="zh-cn" data-theme="light"> <head><meta charset="utf-8"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"> <meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>大模型带火 API 后，分享我对 API 安全之认证鉴权的实践_博客-Higress官网</title><link rel="canonical" href="https://higress.cn/blog/higress-gvr7dx_awbbpb_yp80oe1sr5ryy3g0/"/><link rel="alternate" hreflang="zh-CN" href="https://higress.cn/blog/higress-gvr7dx_awbbpb_yp80oe1sr5ryy3g0/"/><link rel="alternate" hreflang="en" href="https://higress.cn/en/blog/higress-gvr7dx_awbbpb_yp80oe1sr5ryy3g0/"/><link rel="sitemap" href="/sitemap-index.xml"/><link rel="shortcut icon" href="/higress_logo.png" type="image/png"/><meta name="aplus-core" content="aplus.js"/><meta property="og:title" content="大模型带火 API 后，分享我对 API 安全之认证鉴权的实践_博客"/><meta property="og:type" content="article"/><meta property="og:url" content="https://higress.cn/blog/higress-gvr7dx_awbbpb_yp80oe1sr5ryy3g0/"/><meta property="og:locale"/><meta property="og:site_name" content="Higress"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="大模型带火 API 后，分享我对 API 安全之认证鉴权的实践_博客"/><meta name="baidu-site-verification" content="codeva-x6yW4DqCn3"/><meta name="msvalidate.01" content="418883CE9AE2CAD01E7FC1A7B9F20801"/><meta name="twitter:description" content="大模型带火 API 后，分享我对 API 安全之认证鉴权的实践"/><meta name="description" content="大模型带火 API 后，分享我对 API 安全之认证鉴权的实践"/><meta property="og:description" content="大模型带火 API 后，分享我对 API 安全之认证鉴权的实践"/><meta property="keywords" content="Higress"/> <!--初始化SDK-->   <!-- Google tag (gtag.js) --> <script async src="https://www.googletagmanager.com/gtag/js?id=G-YHS75WKFBR"></script> <meta name="generator" content="Astro v4.9.1"><meta name="robots" content="index, follow"><meta name="applicable-device" content="pc,mobile"><meta property="og:image" content="https://img.alicdn.com/imgextra/i1/O1CN01Q9UWyF23bY1R0U0KE_!!6000000007274-2-tps-2560-1440.png"><link data-rh="true" rel="icon" href="https://img.alicdn.com/imgextra/i4/O1CN01AViQMJ1J2lY4OPRgv_!!6000000000971-2-tps-376-375.png"><link rel="stylesheet" href="/_astro/_page_.8CUVaieU.css">
<style>.table-of-contents-wrapper ul{padding:0;list-style:none}.table-of-contents-wrapper a{--pad-inline: .5rem;display:block;border-radius:.25rem;padding-block:.25rem;padding-inline:calc(1rem * var(--depth) + var(--pad-inline)) var(--pad-inline);line-height:1.25}.table-of-contents-wrapper a[aria-current=true],.table-of-contents-wrapper a[aria-current=true]:hover,.table-of-contents-wrapper a[aria-current=true]:focus{color:var(--fallback-n,oklch(var(--n)/1))!important;background-color:var(--fallback-s,oklch(var(--s)/1))!important;border-left-style:solid;border-left-width:3px;border-left-color:var(--fallback-n,oklch(var(--n)/1));padding-left:.625rem!important;font-weight:400!important;border-radius:0!important}.table-of-contents-wrapper .isMobile a{--pad-inline: 1rem;display:flex;justify-content:space-between;gap:var(--pad-inline);border-top:1px solid var(--sl-color-gray-6);border-radius:0;padding-block:.5rem;color:var(--sl-color-text);font-size:var(--sl-text-sm);text-decoration:none;outline-offset:var(--sl-outline-offset-inside)}.table-of-contents-wrapper .isMobile:first-child>li:first-child>a{border-top:0}.table-of-contents-wrapper .isMobile a[aria-current=true],.table-of-contents-wrapper .isMobile a[aria-current=true]:hover,.table-of-contents-wrapper .isMobile a[aria-current=true]:focus{color:var(--sl-color-white);background-color:unset}.table-of-contents-wrapper .isMobile a[aria-current=true]:after{content:"";width:1rem;background-color:var(--sl-color-text-accent);-webkit-mask-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAxNCAxNCc+PHBhdGggZD0nTTEwLjkxNCA0LjIwNmEuNTgzLjU4MyAwIDAgMC0uODI4IDBMNS43NCA4LjU1NyAzLjkxNCA2LjcyNmEuNTk2LjU5NiAwIDAgMC0uODI4Ljg1N2wyLjI0IDIuMjRhLjU4My41ODMgMCAwIDAgLjgyOCAwbDQuNzYtNC43NmEuNTgzLjU4MyAwIDAgMCAwLS44NTdaJy8+PC9zdmc+Cg==);mask-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAxNCAxNCc+PHBhdGggZD0nTTEwLjkxNCA0LjIwNmEuNTgzLjU4MyAwIDAgMC0uODI4IDBMNS43NCA4LjU1NyAzLjkxNCA2LjcyNmEuNTk2LjU5NiAwIDAgMC0uODI4Ljg1N2wyLjI0IDIuMjRhLjU4My41ODMgMCAwIDAgLjgyOCAwbDQuNzYtNC43NmEuNTgzLjU4MyAwIDAgMCAwLS44NTdaJy8+PC9zdmc+Cg==);-webkit-mask-repeat:no-repeat;mask-repeat:no-repeat;flex-shrink:0}
</style>
<link rel="stylesheet" href="/_astro/index.BNvWlo8S.css">
<style>.badge-wrapper .sl-badge{display:inline-block;border:1px solid var(--sl-color-border-badge);border-radius:.25rem;font-size:.75rem;padding:.125rem .375rem;line-height:1;color:var(--sl-color-bg-badge);overflow-wrap:anywhere;transform:scale(.83);transform-origin:0 0}.badge-wrapper .outline{outline-style:none!important;--sl-color-bg-badge: var(--fallback-wa,oklch(var(--wa)/1));--sl-color-border-badge: var(--fallback-p,oklch(var(--p)/1))}.badge-wrapper .default{--sl-color-bg-badge: var(--sl-color-accent-low);--sl-color-border-badge: var(--sl-color-accent)}.badge-wrapper .note{--sl-color-bg-badge: var(--sl-color-blue-low);--sl-color-border-badge: var(--sl-color-blue)}.badge-wrapper .danger{--sl-color-bg-badge: var(--sl-color-red-low);--sl-color-border-badge: var(--sl-color-red)}.badge-wrapper .success{--sl-color-bg-badge: var(--sl-color-green-low);--sl-color-border-badge: var(--sl-color-green)}.badge-wrapper .caution{--sl-color-bg-badge: var(--sl-color-orange-low);--sl-color-border-badge: var(--sl-color-orange)}.badge-wrapper .tip{--sl-color-bg-badge: var(--sl-color-purple-low);--sl-color-border-badge: var(--sl-color-purple)}.badge-wrapper [data-theme=light] .default{--sl-color-bg-badge: var(--sl-color-accent-high)}.badge-wrapper [data-theme=light] .note{--sl-color-bg-badge: var(--sl-color-blue-high)}.badge-wrapper [data-theme=light] .danger{--sl-color-bg-badge: var(--sl-color-red-high)}.badge-wrapper [data-theme=light] .success{--sl-color-bg-badge: var(--sl-color-green-high)}.badge-wrapper [data-theme=light] .caution{--sl-color-bg-badge: var(--sl-color-orange-high)}.badge-wrapper [data-theme=light] .tip{--sl-color-bg-badge: var(--sl-color-purple-high)}.sidebar-sublist-wrapper ul{--sl-sidebar-item-padding-inline: .5rem;list-style:none;padding:0}.sidebar-sublist-wrapper li{overflow-wrap:anywhere}.sidebar-sublist-wrapper ul ul li{margin-inline-start:var(--sl-sidebar-item-padding-inline);border-inline-start:1px solid var(--sl-color-hairline-light);padding-inline-start:var(--sl-sidebar-item-padding-inline)}.sidebar-sublist-wrapper .large{font-size:var(--sl-text-lg);font-weight:600;color:var(--sl-color-white)}.sidebar-sublist-wrapper .top-level>li+li{margin-top:.75rem}.sidebar-sublist-wrapper summary{display:flex;align-items:center;justify-content:space-between;padding:.2em var(--sl-sidebar-item-padding-inline);line-height:1.4;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;user-select:none}.sidebar-sublist-wrapper summary::marker,.sidebar-sublist-wrapper summary::-webkit-details-marker{display:none}.sidebar-sublist-wrapper .caret{transition:transform .2s ease-in-out;flex-shrink:0}.sidebar-sublist-wrapper [dir=rtl] .caret{transform:rotate(180deg)}.sidebar-sublist-wrapper [open]>summary .caret{transform:rotate(90deg)}.sidebar-sublist-wrapper a{display:block;border-radius:.25rem;text-decoration:none;color:var(--sl-color-gray-2);padding:.3em var(--sl-sidebar-item-padding-inline);line-height:1.4}.sidebar-sublist-wrapper a:hover,.sidebar-sublist-wrapper a:focus{color:var(--sl-color-white)}.sidebar-sublist-wrapper [aria-current=page],.sidebar-sublist-wrapper [aria-current=page]:hover,.sidebar-sublist-wrapper [aria-current=page]:focus{color:var(--fallback-n,oklch(var(--n)/1));background-color:var(--fallback-er,oklch(var(--er)/1));border-left-style:solid;border-left-width:4px;border-left-color:var(--fallback-n,oklch(var(--n)/1));padding-left:.625rem!important}.sidebar-sublist-wrapper a>*:not(:last-child),.sidebar-sublist-wrapper .group-label>*:not(:last-child){margin-inline-end:.25em}@media (min-width: 50rem){.sidebar-sublist-wrapper .top-level>li+li{margin-top:.5rem}.sidebar-sublist-wrapper .large{font-size:var(--sl-text-base)}.sidebar-sublist-wrapper a{font-size:var(--sl-text-sm)}}
.blog-slug-wrapper .sidebar-content{height:100%;padding:1rem var(--sl-sidebar-pad-x) 0;flex-direction:column;gap:1rem}.blog-slug-wrapper .right-sidebar-panel{flex-direction:column;justify-content:space-between;height:calc(100vh - 3.5rem);width:0px;overflow:hidden}.blog-slug-wrapper .right-sidebar-panel h2{color:var(--sl-color-white);font-size:var(--sl-text-h5);font-weight:600;line-height:var(--sl-line-height-headings);margin-bottom:.5rem}.blog-slug-wrapper .right-sidebar-panel a{display:block;font-size:var(--sl-text-xs);text-decoration:none;color:var(--sl-color-gray-3);overflow-wrap:anywhere}.blog-slug-wrapper .right-sidebar-panel a:hover{color:var(--sl-color-white)}.blog-slug-wrapper #toggle-sidebar{display:none}@media (min-width: 72rem){.blog-slug-wrapper #toggle-sidebar{display:block;position:fixed;top:40%;z-index:2;transform:translate(-35px)}.blog-slug-wrapper #toggle-sidebar a{padding-top:8px}.blog-slug-wrapper .rotate{transform:rotate(0)}.blog-slug-wrapper .collapsed{width:18%;padding:1rem var(--sl-sidebar-pad-x)}.blog-slug-wrapper .blog-fold{width:60%!important}}
</style>
<link rel="stylesheet" href="/_astro/index.B0a9OMnn.css">
<link rel="stylesheet" href="/_astro/_page_.BwWph3Ek.css">
<style>.header-wrapper my-layout{--header-content-width: var(--width);--logo-height: 2rem;--header-height: var(--height);--header-xl-padding: var(--xpadding)}.header-wrapper .header-content{width:var(--header-content-width);padding-left:var(--header-xl-padding);padding-right:var(--header-xl-padding)}.header-wrapper .left-content .logo{vertical-align:sub;height:var(--logo-height)}.header-wrapper .left-content .mobile-navbar{display:none}@media (max-width: 85.125rem){.header-wrapper .header-content{width:100%;padding-left:1.5rem;padding-right:1.5rem}}@media (max-width: 1070px){.header-wrapper .header-content{width:100%;padding-left:1.5rem;padding-right:1.5rem}.header-wrapper .left-content .mobile-navbar{display:block}.header-wrapper .center-content{display:none}.header-wrapper .code-toggle{padding:0!important;background-color:transparent!important}.header-wrapper .code-toggle span{display:none}.header-wrapper .code-toggle svg{width:1.5rem;height:1.5rem}}
.link-icon:where(.astro-ld27styo){transition:width .3s ease}
toggle-content:where(.astro-bxjx6km4){--toggle-ml-width: 7rem;--toggle-xl-width: 7.5rem;--toggle-ml-height: 2rem;--toggle-xl-height: 2.5rem;--toggle-ml-font: .75rem;--toggle-xl-font: .85rem;--toggle-ml-switch-width: 3.5rem;--toggle-xl-switch-width: 3.75rem;--toggle-ml-switch-height: 1.5rem;--toggle-xl-switch-height: 2rem}.switch:where(.astro-bxjx6km4){width:var(--toggle-ml-width)}.switch-inner:where(.astro-bxjx6km4){width:200%;margin-left:-100%}.switch-inner:where(.astro-bxjx6km4):before,.switch-inner:where(.astro-bxjx6km4):after{display:block;float:right;width:50%;height:var(--toggle-ml-height);padding:0;line-height:var(--toggle-ml-height);font-size:var(--toggle-ml-font);box-sizing:border-box}.switch-inner:where(.astro-bxjx6km4):after{content:attr(data-on);padding-left:1.25rem}.switch-inner:where(.astro-bxjx6km4):before{content:attr(data-off);padding-right:1.25rem;text-align:right}.switch-switch:where(.astro-bxjx6km4){height:var(--toggle-ml-switch-height);width:var(--toggle-ml-switch-width);bottom:.25rem;border-radius:2rem;transition:all .3s ease-in 0s;text-align:right}.switch-switch:where(.astro-bxjx6km4):before{display:flex;content:attr(data-off);height:100%;font-size:var(--toggle-ml-font);align-items:center;justify-content:center}.switch-checkbox:where(.astro-bxjx6km4):checked+.switch-label:where(.astro-bxjx6km4) .switch-inner:where(.astro-bxjx6km4){margin-left:0}.switch-checkbox:where(.astro-bxjx6km4):checked+.switch-label:where(.astro-bxjx6km4) .switch-switch:where(.astro-bxjx6km4){right:0}.switch-checkbox:where(.astro-bxjx6km4):checked+.switch-label:where(.astro-bxjx6km4) .switch-switch:where(.astro-bxjx6km4):before{display:flex;content:attr(data-on);height:100%;font-size:var(--toggle-ml-font);align-items:center;justify-content:center}
.link-text:where(.astro-zb5a5pg4) .link-icon:where(.astro-zb5a5pg4){width:0;opacity:0;transition:transform .5s ease,width .3s ease,opacity .3s ease}.link-text:where(.astro-zb5a5pg4):hover .link-icon:where(.astro-zb5a5pg4){transform:translate(3px);opacity:1;width:8px}
</style>
<link rel="stylesheet" href="/_astro/tailwind.D1OAr-9K.css">
<link rel="stylesheet" href="/_astro/style.Czao6FyS.css"><script type="module" src="/_astro/hoisted.BdwF20gE.js"></script>
<script type="module" src="/_astro/page.CIklkdzg.js"></script></head> <body> <!-- <HomeHeader align="home" position={position} lang={Astro.props.lang} {...Astro.props} /> --> <span class="header-wrapper" style="--width: 100%;--height: 3.5rem;--xpadding: 1.5rem;"> <div class="alert-bar w-full  h-12 flex align-center justify-between top-0 bg-cover bg-[url('https://img.alicdn.com/imgextra/i3/O1CN010OMCW91rMde4sifaA_!!6000000005617-0-tps-828-52.jpg')] md:bg-[url('https://img.alicdn.com/imgextra/i4/O1CN01wkq3Nl1O9FCjTbQNk_!!6000000001662-0-tps-2880-96.jpg')]" client:load><div class="md:text-base text-sm m-auto leading-6 "><span class=" text-muted mr-4 md:mr-6 opacity-30 hidden md:inline-block">&lt;/&gt;</span><span class="alert-text hidden md:inline-block bg-gradient-to-r from-link to-success font-medium">下载《AI 应用 & AI Agent 开发新范式》电子书  了解构建 AI Agent 和 MCP Server 的一线实践</span><span class="alert-text bg-gradient-to-r from-link to-success text-muted  md:hidden font-medium">下载《AI 应用 & AI Agent 开发新范式》电子书  了解构建 AI Agent 和 MCP Server 的一线实践</span><a href="https://developer.aliyun.com/ebook/8442" target="_blank" class="mx-auto flex justify-center md:inline text-primary font-medium md:ml-4 no-underline">点此了解</a></div><button class="close-button text-muted bg-transparent border-none cursor-pointer text-lg leading-6 mr-1 md:mr-4">
&times;
</button></div> <my-layout style="position: sticky; height: 3.5rem; --width: 100%;--height: 3.5rem;--xpadding: 1.5rem;" class="w-full backdrop-blur-md top-0 z-[10] bg-neutral flex justify-center"> <!-- 方便控制header宽度 --> <div class="header-content flex items-center justify-between" style="--width: 100%;--height: 3.5rem;--xpadding: 1.5rem;"> <div class="left-content h-full flex flex-1 items-center after:content-[''] after:grow after:invisible" style="--width: 100%;--height: 3.5rem;--xpadding: 1.5rem;"> <a class="no-underline flex" href="/" style="--width: 100%;--height: 3.5rem;--xpadding: 1.5rem;"> <img class="logo" src="https://img.alicdn.com/imgextra/i1/O1CN01aIB6n51zcgTM5vhku_!!6000000006735-2-tps-156-48.png" alt="Higress-logo" style="--width: 100%;--height: 3.5rem;--xpadding: 1.5rem;"> </a> <span class="mobile-navbar-wrapper" style="--top: 3.5rem;"> <div class="mobile-navbar mobile-navbar h-full ml-4" style="--top: 3.5rem;"> <mobile-menu-button style="--top: 3.5rem;"> <button aria-expanded="false" aria-label="mobile-menu-button" style="--top: 3.5rem;"> <svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6304" width="28" height="28" style="--top: 3.5rem;"> <path d="M192.037 287.953h640.124c17.673 0 32-14.327 32-32s-14.327-32-32-32H192.037c-17.673 0-32 14.327-32 32s14.327 32 32 32zM832.161 479.169H438.553c-17.673 0-32 14.327-32 32s14.327 32 32 32h393.608c17.673 0 32-14.327 32-32s-14.327-32-32-32zM832.161 735.802H192.037c-17.673 0-32 14.327-32 32s14.327 32 32 32h640.124c17.673 0 32-14.327 32-32s-14.327-32-32-32zM319.028 351.594l-160 160 160 160z" class="fill-secondary" p-id="6305" style="--top: 3.5rem;"></path> </svg> </button> </mobile-menu-button> <div class="navbar-panel bg-secondary" style="--top: 3.5rem;"> <div class="navbar-content flex" style="--top: 3.5rem;"> <span class="mobile-nav-sublist-wrapper"> <ul class="top-level"> <li> <a href="https://higress.ai/" class="large flex items-center"> <span>AI 网关</span> </a> </li><li> <a href="/docs/latest/overview/what-is-higress/" class="large flex items-center"> <span>文档</span> </a> </li><li> <a href="/plugin/" class="large flex items-center"> <span>插件</span> </a> </li><li> <a href="/cloud/" class="large flex items-center"> <span>企业版 Higress</span> </a> </li><li> <a href="/blog/" class="large flex items-center"> <span>博客</span> </a> </li><li> <details> <summary> <div class="group-label"> <span class="large undefined">社区</span> </div> <svg aria-hidden="true" class="caret astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-color: #818598;--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <span class="mobile-nav-sublist-wrapper"> <ul>  </ul> </span>  </details> </li><li> <a href="/docs/developers/developers_dev/" class="large flex items-center"> <span>开发者</span> </a> </li><li> <a href="http://demo.higress.io/" class="large flex items-center"> <span>控制台样例</span> </a> </li><li> <a href="/faq/wuyi-intro/" class="large flex items-center"> <span>答疑样例</span> </a> </li> </ul> </span>  </div> </div> </div> </span>   </div> <div class="center-content justify-center flex-2 h-full" style="--width: 100%;--height: 3.5rem;--xpadding: 1.5rem;"> <span class="navbar-wrapper"> <navbar-component class="navbar-component h-full"> <div class="pc-navbar pc-navbar h-full"> <span class="toggle-wrapper"> <toggle-component data-trigger="click" class="toggle-component h-full relative"> <div class="toggle-trigger relative cursor-pointer flex items-center h-full item ">  <a href="https://higress.ai/" target="_blank" class="toggle-text flex items-center justify-center no-underline h-full  "> AI 网关  <span class="toggle-text-ailogo text-xs text-center rounded-xl absolute top-[0.5rem] right-[-0.5rem] text-white bg-[red] w-[2rem] h-[1rem] font-medium">
NEW
</span> </a>   </div>  </toggle-component> </span>  <span class="toggle-wrapper"> <toggle-component data-trigger="click" class="toggle-component h-full relative"> <div class="toggle-trigger relative cursor-pointer flex items-center h-full item ">  <a href="/docs/latest/overview/what-is-higress/" target="_self" class="toggle-text flex items-center justify-center no-underline h-full  "> 文档   </a>   </div>  </toggle-component> </span>  <span class="toggle-wrapper"> <toggle-component data-trigger="click" class="toggle-component h-full relative"> <div class="toggle-trigger relative cursor-pointer flex items-center h-full item ">  <a href="/plugin/" target="_self" class="toggle-text flex items-center justify-center no-underline h-full  toggle-text-aiwrapper relative"> 插件 <span class="toggle-text-ailogo text-center rounded-xl absolute top-[0] right-[-1.5rem] text-white bg-[red] w-[2rem] h-[1.25rem] font-bold">
AI
</span>  </a>   </div>  </toggle-component> </span>  <span class="toggle-wrapper"> <toggle-component data-trigger="click" class="toggle-component h-full relative"> <div class="toggle-trigger relative cursor-pointer flex items-center h-full item ">  <a href="/cloud/" target="_self" class="toggle-text flex items-center justify-center no-underline h-full  "> 企业版 Higress   </a>   </div>  </toggle-component> </span>  <span class="toggle-wrapper"> <toggle-component data-trigger="click" class="toggle-component h-full relative"> <div class="toggle-trigger relative cursor-pointer flex items-center h-full item ">  <a href="/blog/" target="_self" class="toggle-text flex items-center justify-center no-underline h-full toggle-text-active "> 博客   </a>   </div>  </toggle-component> </span>  <span class="toggle-wrapper"> <toggle-component data-trigger="hover" class="toggle-component h-full static"> <div class="toggle-trigger relative cursor-pointer flex items-center h-full item ">  <div class="toggle-text flex items-center justify-center h-full toggle-text-active "> 社区 </div>  <svg width="10" height="7" viewBox="0 0 10 7" fill="none" xmlns="http://www.w3.org/2000/svg" data-updown class="ml-2"> <path d="M8.05264 2L5.05264 5.00649L2.05264 2" stroke="#a3a6b3" stroke-width="1.25" stroke-linecap="square"></path> </svg> </div> <div class="toggle-dropdown w-fit inset-x-0 absolute t-3.5rem">   <menu-container class="menu-container dropdown-docs w-screen h-screen flex flex-col justify-start items-center"> <div class="bg-neutral p-10 w-full flex justify-center "> <div class="w-fit"> <div class="flex justify-between mb-[3.5rem]"> <div class="flex"> <!-- 社区label --> <div class="border-l border-warning flex flex-col px-7 min-w-[12rem]"> <span class="text-xs text-warning mb-2">社区</span> <a href="https://github.com/higress-group/higress-group.github.io/issues" target="_blank" class="link-text cursor-pointer no-underline flex items-center w-fit text-neutral text-sm mt-3 astro-zb5a5pg4"> 报告文档问题  <svg version="1.1" width="8" height="8" viewBox="0 0 8 8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="link-icon  ml-2 fill-neutral astro-zb5a5pg4"> <g transform="matrix(-1,0,0,1,16,0)" class="astro-zb5a5pg4"> <path d="M9.27237,2.16302L9.27237,6.99801Q9.27237,7.26839,9.08915,7.45161Q8.905925,7.63483,8.636183,7.6342Q8.365805,7.6342,8.183221,7.45097Q8.000636137,7.26775,8,6.99801L8,0.636183Q8,0.365805,8.183221,0.183221Q8.366441,0.000636364,8.636183,0L14.99801,0Q15.26839,0,15.451609999999999,0.183221Q15.634830000000001,0.366441,15.63419,0.636183Q15.63419,0.906561,15.45097,1.08978Q15.26775,1.273,14.99801,1.27237L10.16302,1.27237L15.825050000000001,6.93439Q16,7.10935,16,7.37972Q16,7.6501,15.825050000000001,7.82505Q15.6501,8,15.379719999999999,8Q15.10935,8,14.93439,7.82505L9.27237,2.16302Z" fill-opacity="1" class="astro-zb5a5pg4"></path> </g> </svg>  </a> <a href="/docs/developers/contributor-guide/guide_dev/" target="_self" class="link-text cursor-pointer no-underline flex items-center w-fit text-neutral text-sm mt-3 astro-zb5a5pg4"> 贡献社区  <svg version="1.1" width="8" height="8" viewBox="0 0 8 8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="link-icon  ml-2 fill-neutral astro-zb5a5pg4"> <g transform="matrix(-1,0,0,1,16,0)" class="astro-zb5a5pg4"> <path d="M9.27237,2.16302L9.27237,6.99801Q9.27237,7.26839,9.08915,7.45161Q8.905925,7.63483,8.636183,7.6342Q8.365805,7.6342,8.183221,7.45097Q8.000636137,7.26775,8,6.99801L8,0.636183Q8,0.365805,8.183221,0.183221Q8.366441,0.000636364,8.636183,0L14.99801,0Q15.26839,0,15.451609999999999,0.183221Q15.634830000000001,0.366441,15.63419,0.636183Q15.63419,0.906561,15.45097,1.08978Q15.26775,1.273,14.99801,1.27237L10.16302,1.27237L15.825050000000001,6.93439Q16,7.10935,16,7.37972Q16,7.6501,15.825050000000001,7.82505Q15.6501,8,15.379719999999999,8Q15.10935,8,14.93439,7.82505L9.27237,2.16302Z" fill-opacity="1" class="astro-zb5a5pg4"></path> </g> </svg>  </a> <a href="https://github.com/alibaba/higress/graphs/contributors" target="_blank" class="link-text cursor-pointer no-underline flex items-center w-fit text-neutral text-sm mt-3 astro-zb5a5pg4"> 贡献者  <svg version="1.1" width="8" height="8" viewBox="0 0 8 8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="link-icon  ml-2 fill-neutral astro-zb5a5pg4"> <g transform="matrix(-1,0,0,1,16,0)" class="astro-zb5a5pg4"> <path d="M9.27237,2.16302L9.27237,6.99801Q9.27237,7.26839,9.08915,7.45161Q8.905925,7.63483,8.636183,7.6342Q8.365805,7.6342,8.183221,7.45097Q8.000636137,7.26775,8,6.99801L8,0.636183Q8,0.365805,8.183221,0.183221Q8.366441,0.000636364,8.636183,0L14.99801,0Q15.26839,0,15.451609999999999,0.183221Q15.634830000000001,0.366441,15.63419,0.636183Q15.63419,0.906561,15.45097,1.08978Q15.26775,1.273,14.99801,1.27237L10.16302,1.27237L15.825050000000001,6.93439Q16,7.10935,16,7.37972Q16,7.6501,15.825050000000001,7.82505Q15.6501,8,15.379719999999999,8Q15.10935,8,14.93439,7.82505L9.27237,2.16302Z" fill-opacity="1" class="astro-zb5a5pg4"></path> </g> </svg>  </a>  </div> <!-- 事件、资源label --> <div class="border-l border-warning flex flex-col px-7 mr-10"> <span class="text-xs text-warning mb-2">资源</span> <a href="/blog/" target="_self" class="link-text cursor-pointer no-underline flex items-center w-fit text-neutral text-sm mt-3 astro-zb5a5pg4"> 博客  <svg version="1.1" width="8" height="8" viewBox="0 0 8 8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="link-icon  ml-2 fill-neutral astro-zb5a5pg4"> <g transform="matrix(-1,0,0,1,16,0)" class="astro-zb5a5pg4"> <path d="M9.27237,2.16302L9.27237,6.99801Q9.27237,7.26839,9.08915,7.45161Q8.905925,7.63483,8.636183,7.6342Q8.365805,7.6342,8.183221,7.45097Q8.000636137,7.26775,8,6.99801L8,0.636183Q8,0.365805,8.183221,0.183221Q8.366441,0.000636364,8.636183,0L14.99801,0Q15.26839,0,15.451609999999999,0.183221Q15.634830000000001,0.366441,15.63419,0.636183Q15.63419,0.906561,15.45097,1.08978Q15.26775,1.273,14.99801,1.27237L10.16302,1.27237L15.825050000000001,6.93439Q16,7.10935,16,7.37972Q16,7.6501,15.825050000000001,7.82505Q15.6501,8,15.379719999999999,8Q15.10935,8,14.93439,7.82505L9.27237,2.16302Z" fill-opacity="1" class="astro-zb5a5pg4"></path> </g> </svg>  </a> <a href="/docs/ebook/wasm14/" target="_self" class="link-text cursor-pointer no-underline flex items-center w-fit text-neutral text-sm mt-3 astro-zb5a5pg4"> 电子书  <svg version="1.1" width="8" height="8" viewBox="0 0 8 8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="link-icon  ml-2 fill-neutral astro-zb5a5pg4"> <g transform="matrix(-1,0,0,1,16,0)" class="astro-zb5a5pg4"> <path d="M9.27237,2.16302L9.27237,6.99801Q9.27237,7.26839,9.08915,7.45161Q8.905925,7.63483,8.636183,7.6342Q8.365805,7.6342,8.183221,7.45097Q8.000636137,7.26775,8,6.99801L8,0.636183Q8,0.365805,8.183221,0.183221Q8.366441,0.000636364,8.636183,0L14.99801,0Q15.26839,0,15.451609999999999,0.183221Q15.634830000000001,0.366441,15.63419,0.636183Q15.63419,0.906561,15.45097,1.08978Q15.26775,1.273,14.99801,1.27237L10.16302,1.27237L15.825050000000001,6.93439Q16,7.10935,16,7.37972Q16,7.6501,15.825050000000001,7.82505Q15.6501,8,15.379719999999999,8Q15.10935,8,14.93439,7.82505L9.27237,2.16302Z" fill-opacity="1" class="astro-zb5a5pg4"></path> </g> </svg>  </a>  </div> </div> <div class="flex" id="blog-card-container"> <div class="relative blog-card w-[16.875] h-[22.5rem] rounded-2xl p-2 flex flex-col ml-4 "> <img src="https://img.alicdn.com/imgextra/i4/O1CN01bGnAVW1pFeLFnlaQL_!!6000000005331-2-tps-508-370.png" alt="Higress case" class="rounded-lg" width="254" height="185" loading="lazy" decoding="async"> <p class="w-[15.875rem] text-lg line-clamp-2 mt-3 text-base-100"> API赋能AI，AI网关零代码解决AI幻觉问题 </p> <span class="not-content"><a class="btn rounded-3xl w-[8.5rem] h-[2.5rem] absolute bottom-2 article-button border-none text-secondary no-underline" target="_self" rel="noopener noreferrer" id="article-button" href="/blog/higress-gvr7dx_awbbpb_im44tpldqyt8c97d/?source=blog_case">阅读文章</a></span> </div><div class="relative blog-card w-[16.875] h-[22.5rem] rounded-2xl p-2 flex flex-col ml-4 "> <img src="https://img.alicdn.com/imgextra/i4/O1CN01zfayJW1Lhe4kliPv9_!!6000000001331-2-tps-508-370.png" alt="Higress case" class="rounded-lg" width="254" height="185" loading="lazy" decoding="async"> <p class="w-[15.875rem] text-lg line-clamp-2 mt-3 text-base-100"> Higress 发布 v1.4，开放 AI 网关能力，增强云原生能力 </p> <span class="not-content"><a class="btn rounded-3xl w-[8.5rem] h-[2.5rem] absolute bottom-2 article-button border-none text-secondary no-underline" target="_self" rel="noopener noreferrer" id="article-button" href="/blog/higress-gvr7dx_awbbpb_picigqfume3k5lf3/?source=blog_article">阅读文章</a></span> </div> </div>  </div> <!-- 联系我们 --> <div class="w-[70rem] contact-us flex items-center justify-between rounded-2xl h-9 pl-10 pr-[8.5rem]"> <span class="text-success text-xs leading-9 tracking-[0.15em]"> 联系我们 </span> <div class="flex items-center cursor-pointer"> <a target="_blank" href="https://github.com/alibaba/higress" class="mr-16 flex items-center no-underline"> <svg viewBox="0 80 1024 800" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3233" width="16" height="16"> <path d="M20.48 503.72608c0 214.4256 137.4208 396.73856 328.94976 463.6672 25.8048 6.5536 21.87264-11.8784 21.87264-24.33024v-85.07392c-148.93056 17.44896-154.86976-81.1008-164.94592-97.52576-20.23424-34.52928-67.91168-43.33568-53.69856-59.76064 33.91488-17.44896 68.48512 4.42368 108.46208 63.61088 28.95872 42.88512 85.44256 35.6352 114.15552 28.4672a138.8544 138.8544 0 0 1 38.0928-66.7648c-154.25536-27.60704-218.60352-121.77408-218.60352-233.79968 0-54.31296 17.94048-104.2432 53.0432-144.54784-22.36416-66.43712 2.08896-123.24864 5.3248-131.6864 63.81568-5.7344 130.00704 45.6704 135.168 49.68448 36.2496-9.78944 77.57824-14.9504 123.82208-14.9504 46.4896 0 88.064 5.3248 124.5184 15.23712 12.288-9.4208 73.80992-53.53472 133.12-48.128 3.15392 8.43776 27.0336 63.93856 6.02112 129.4336 35.59424 40.38656 53.69856 90.76736 53.69856 145.24416 0 112.18944-64.7168 206.4384-219.42272 233.71776a140.0832 140.0832 0 0 1 41.7792 99.9424v123.4944c0.86016 9.87136 0 19.6608 16.50688 19.6608 194.31424-65.49504 334.2336-249.15968 334.2336-465.5104C1002.57792 232.48896 782.66368 12.77952 511.5904 12.77952 240.18944 12.65664 20.48 232.40704 20.48 503.72608z" fill="currentColor" p-id="3234"></path> </svg> <span class="ml-2 mt-1 text-sm text-secondary">GitHub</span> </a> <div class="mr-16 hoverable relative"> <img class="tooltip hidden w-40 absolute bottom-9" src="/img/dingding_3.jpg" alt="Higress Dingding Code"> <span class="text-neutral flex items-center"> <svg class="icon" viewBox="0 50 1024 800" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4747" width="16" height="16"> <path d="M0 0h1024v1024H0z" class="secondary-fill" fill-opacity="0" p-id="4748"></path><path d="M786.978133 481.6896c-153.770667-117.5552-327.133867-273.237333-517.188266-440.183467-14.984533-13.141333-28.2624-7.953067-34.952534 9.5232-42.8032 111.957333-1.297067 211.421867 65.774934 268.731734 67.345067 57.582933 167.492267 110.592 228.829866 138.683733 2.389333 1.092267 0.3072 4.573867-2.116266 3.515733-112.674133-49.152-191.044267-84.650667-297.3696-165.819733-11.434667-8.738133-23.04-5.3248-24.405334 11.707733-8.704 107.042133 60.484267 191.146667 137.728 219.5456 47.786667 17.6128 100.0448 27.3408 148.548267 33.109334 2.525867 0.341333 1.9456 4.027733-0.580267 4.027733-62.498133 0.2048-138.001067-14.609067-203.332266-39.458133-13.789867-5.256533-18.5344 5.632-16.418134 14.267733 11.1616 45.226667 67.652267 114.346667 157.5936 128.887467 16.827733 2.730667 34.747733 3.072 50.722134 2.628266 3.7888-0.136533 4.7104 1.9456 3.4816 4.846934 0 0-61.098667 103.6288-63.761067 108.066133-2.082133 3.447467-0.8192 6.212267 3.515733 6.212267h80.622934c3.754667 0 6.0416 2.389333 4.096 5.5296-1.877333 3.140267-107.656533 176.7424-112.64 185.0368-4.369067 7.202133 0.785067 12.731733 8.942933 6.826666 8.192-5.9392 346.180267-250.88 355.805867-257.911466 4.437333-3.208533 3.413333-7.5776-2.833067-7.5776h-72.2944c-4.744533 0-5.768533-3.140267-2.56-6.314667 3.242667-3.1744 82.090667-80.964267 110.08-110.08 29.184-30.378667 44.100267-86.050133-5.290667-123.8016" class="secondary-fill" p-id="4749"></path> </svg> <span class="ml-2 mt-1 text-sm text-secondary">钉钉</span> </span> </div> </div> </div> </div> </div> <div class="dropdown-overlay w-full flex-1 bg-neutral-900/[.4]"></div> </menu-container>    </div> </toggle-component> </span>  <span class="toggle-wrapper"> <toggle-component data-trigger="click" class="toggle-component h-full relative"> <div class="toggle-trigger relative cursor-pointer flex items-center h-full item ">  <a href="/docs/developers/developers_dev/" target="_self" class="toggle-text flex items-center justify-center no-underline h-full  "> 开发者   </a>   </div>  </toggle-component> </span>  <span class="toggle-wrapper"> <toggle-component data-trigger="click" class="toggle-component h-full relative"> <div class="toggle-trigger relative cursor-pointer flex items-center h-full item ">  <a href="http://demo.higress.io/" target="_blank" class="toggle-text flex items-center justify-center no-underline h-full  "> 控制台样例   </a>   </div>  </toggle-component> </span>  <span class="toggle-wrapper"> <toggle-component data-trigger="click" class="toggle-component h-full relative"> <div class="toggle-trigger relative cursor-pointer flex items-center h-full item item-last-child">  <a href="/faq/wuyi-intro/" target="_self" class="toggle-text flex items-center justify-center no-underline h-full  "> 答疑样例   </a>   </div>  </toggle-component> </span>   </div> </navbar-component> </span>  </div> <div class="right-content flex flex-1 items-center md:gap-4  before:content-[''] before:grow before:invisible" style="--width: 100%;--height: 3.5rem;--xpadding: 1.5rem;"> <div class="astro-bxjx6km4"> <!-- pc --> <toggle-content class="switch float-left relative m-0 rounded-[2rem] max-md:hidden astro-bxjx6km4"> <input disabled data-switch class="switch-checkbox hidden astro-bxjx6km4" id="pc-toggle-switch" type="checkbox"> <!-- container --> <label class="switch-label block overflow-hidden cursor-pointer rounded-[2rem]  
                bg-language
             astro-bxjx6km4" for="pc-toggle-switch"> <!-- static --> <span class="switch-inner block 
                    text-language-button
                 astro-bxjx6km4" data-on="中文" data-off="EN"></span> <!-- active --> <span class="switch-switch absolute float-right mx-1 
                    text-language-button-active
                    bg-language-button
                 astro-bxjx6km4" data-on="EN" data-off="中文"></span> </label> </toggle-content> <!-- mobile --> <div data-switch class="w-[3.5rem] h-[1.5rem] leading-[1.5rem] text-xs text-center rounded-2xl bg-gray-12 max-md:inline-block md:hidden border astro-bxjx6km4" id="pc-toggle-switch"> 中文 </div> </div>   <sl-doc-search data-translations="{&#34;translations&#34;:{&#34;button&#34;:{},&#34;modal&#34;:{&#34;searchBox&#34;:{},&#34;startScreen&#34;:{},&#34;errorScreen&#34;:{},&#34;footer&#34;:{},&#34;noResultsScreen&#34;:{}}}}"> <button type="button" class="DocSearch DocSearch-Button"> <span class="DocSearch-Button-Container"> <svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"> <path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path> </svg> <span class="DocSearch-Button-Placeholder"></span> </span> <span class="DocSearch-Button-Keys"></span> </button> </sl-doc-search>   </div> </div> </my-layout> </span>      <div class="w-full"> <div class="w-[20%] sidebar-content fixed overflow-auto h-full hidden 2xl:inline-block xl:inline-block lg:inline-block md:inline-block"> <blog-theme> <span class="sidebar-sublist-wrapper"> <ul class="top-level"> <li> <details open> <summary> <div class="group-label"> <span class="large">技术文章</span>  </div> <svg aria-hidden="true" class="caret astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <span class="sidebar-sublist-wrapper"> <ul> <li> <a href="/blog/higress-gvr7dx_awbbpb_zs1iqivea02x8fl9/" class="flex items-center"> <span>Lobechat使用WolframAlpha MCP工具减少LLM幻觉</span>   </a> </li><li> <a href="/blog/higress-gvr7dx_awbbpb_igk8hdx9xt83ptqg/" class="flex items-center"> <span>API 即 MCP｜Higress 发布 MCP Marketplace，加速存量 API 跨入 MCP 时代</span>   </a> </li><li> <a href="/blog/higress-gvr7dx_awbbpb_zburfn8cw9ydu150/" class="flex items-center"> <span>MCP 架构下，提示词工程和标准化数据结构越加重要</span>   </a> </li><li> <a href="/blog/higress-gvr7dx_awbbpb_mpavtgoff5h3odvq/" class="flex items-center"> <span>实用工具来了，存量 OpenAPI 批量转化为 MCP Server</span>   </a> </li><li> <a href="/blog/higress-gvr7dx_awbbpb_zixhqugf2dp99bz8/" class="flex items-center"> <span>万字长文告诉你企业如何基于MCP实现AI应用架构新范式转型</span>   </a> </li><li> <a href="/blog/higress-gvr7dx_awbbpb_xq8kol5ncmllabkk/" class="flex items-center"> <span>Higress 开源 Remote MCP Server 托管方案，并将上线 MCP 市场</span>   </a> </li><li> <a href="/blog/higress-gvr7dx_awbbpb_adgy9xp3ktqf278s/" class="flex items-center"> <span>IngressNightmare：Ingress Nginx 再曝5个安全漏洞，可接管你的 K8s 集群</span>   </a> </li><li> <a href="/blog/higress-gvr7dx_awbbpb_bangn9vn6pwzo5ar/" class="flex items-center"> <span>Java版Manus实现来了，Spring AI Alibaba发布开源OpenManus实现</span>   </a> </li><li> <a href="/blog/higress-gvr7dx_awbbpb_bh9o6nnuri31ygvx/" class="flex items-center"> <span>大模型上下文协议 MCP 带来了哪些货币化机会</span>   </a> </li><li> <a href="/blog/higress-gvr7dx_awbbpb_xscgcfbshtcv14hz/" class="flex items-center"> <span>Higress.ai 站点全新发布，轻松解锁 AI 新能力，开启全球服务！</span>   </a> </li><li> <a href="/blog/higress-gvr7dx_awbbpb_kv7s0g9dy0g7p25z/" class="flex items-center"> <span>AI 网关代理LLMs最佳实践</span>   </a> </li><li> <a href="/blog/higress-gvr7dx_awbbpb_hwuzgkuzpuru076d/" class="flex items-center"> <span>大模型 Token 的消耗可能是一笔糊涂账</span>   </a> </li><li> <a href="/blog/higress-gvr7dx_awbbpb_yp80oe1sr5ryy3g0/" aria-current="page" class="flex items-center"> <span>大模型带火 API 后，分享我对 API 安全之认证鉴权的实践</span>   </a> </li><li> <a href="/blog/higress-gvr7dx_awbbpb_kbgwaftgw8315v0l/" class="flex items-center"> <span>大模型无缝切换，QwQ-32B 和 DeepSeek-R1  全都要</span>   </a> </li><li> <a href="/blog/higress-gvr7dx_awbbpb_kr6gxodg2m79af28/" class="flex items-center"> <span>教程：使用开源Higress实现DeepSeek联网搜索</span>   </a> </li><li> <a href="/blog/higress-gvr7dx_awbbpb_hlsz3id8cec7z1m3/" class="flex items-center"> <span>AI 网关需要具备的10大基本能力</span>   </a> </li><li> <a href="/blog/higress-gvr7dx_awbbpb_sphafiske3o0xnqx/" class="flex items-center"> <span>玩转 DeepSeek：和 ChatGPT 对弈中国象棋</span>   </a> </li><li> <a href="/blog/higress-gvr7dx_awbbpb_ad4xkcyo1xtafkqg/" class="flex items-center"> <span>浏览量超10w的热图，描述 RAG 的主流架构</span>   </a> </li><li> <a href="/blog/higress-gvr7dx_awbbpb_vl5iak7vsi3s1kpx/" class="flex items-center"> <span>大模型推理服务全景图</span>   </a> </li><li> <a href="/blog/higress-gvr7dx_awbbpb_glmivtz04x6p3k91/" class="flex items-center"> <span>为何最近谈论 SSE 和 WebSocket 的人越来越多了？</span>   </a> </li><li> <a href="/blog/higress-gvr7dx_awbbpb_qragv9vlxcxly5y1/" class="flex items-center"> <span>警惕！2万星开源AI工具遭挖矿木马入侵，这些隐患你必须知道！</span>   </a> </li><li> <a href="/blog/higress-gvr7dx_awbbpb_fca2piud7gdu32ho/" class="flex items-center"> <span>Envoy HTTP2 404 如何解决</span>   </a> </li><li> <a href="/blog/higress-gvr7dx_awbbpb_auo7gh99bhwwahxm/" class="flex items-center"> <span>活动回顾丨云原生开源开发者沙龙，AI 应用工程化专场</span>   </a> </li><li> <a href="/blog/higress-gvr7dx_awbbpb_ss3ok5o9er9it0nb/" class="flex items-center"> <span>应用网关的演进历程和分类</span>   </a> </li><li> <a href="/blog/higress-gvr7dx_awbbpb_ghwthc4xkdshgqgp/" class="flex items-center"> <span>上新｜统一多层网关架构系列视频课程</span>   </a> </li><li> <a href="/blog/higress-gvr7dx_awbbpb_veqvz22q07nx7m2z/" class="flex items-center"> <span>AI 时代，网关的发展趋势和实践</span>   </a> </li><li> <a href="/blog/higress-gvr7dx_awbbpb_dxp91huk34ts4nik/" class="flex items-center"> <span>多层网关统一成趋势，如何构建全能型网关</span>   </a> </li><li> <a href="/blog/higress-gvr7dx_awbbpb_bo9gbceraxmft62n/" class="flex items-center"> <span>Wasm 实现 Higress 扩展，性能是 Spring Cloud Gateway 的 3 倍！</span>   </a> </li><li> <a href="/blog/higress-gvr7dx_awbbpb_rggp2v9saa6gehsg/" class="flex items-center"> <span>Higress全新Wasm运行时，性能大幅提升</span>   </a> </li><li> <a href="/blog/higress-gvr7dx_awbbpb_sgavomwlumko3kl7/" class="flex items-center"> <span>Higress 开源后，我们整理了开发者最关心的 15 个问题</span>   </a> </li><li> <a href="/blog/higress-gvr7dx_awbbpb_xdxim253zzta4bun/" class="flex items-center"> <span>Higress + Nacos 微服务网关最佳实践</span>   </a> </li><li> <a href="/blog/higress-gvr7dx_awbbpb_uddq0l7v5a5vadc6/" class="flex items-center"> <span>如何使用 Higress 快速构建 AI 应用？</span>   </a> </li><li> <a href="/blog/higress-gvr7dx_awbbpb_picigqfume3k5lf3/" class="flex items-center"> <span>Higress 发布 v1.4，开放 AI 网关能力，增强云原生能力</span>   </a> </li><li> <a href="/blog/pilot-debug/" class="flex items-center"> <span>教程：如何在本地开发和调试 Higress Pilot</span>   </a> </li><li> <a href="/blog/console-dev/" class="flex items-center"> <span>教程：如何在本地开发和调试 Higress 控制台</span>   </a> </li><li> <a href="/blog/admin-sdk-intro/" class="flex items-center"> <span>如何使用 Higress Admin SDK 进行配置管理</span>   </a> </li><li> <a href="/blog/higress-code/" class="flex items-center"> <span>higress-core源码分析</span>   </a> </li><li> <a href="/blog/higress-gvr7dx_awbbpb_tp0pgbnsg4bef0x1-copy/" class="flex items-center"> <span>迅速get云原生网关，阿里云商业版Ingress</span>   </a> </li><li> <a href="/blog/e2e-debug/" class="flex items-center"> <span>教程：如何在本地进行higress调试和端到端测试</span>   </a> </li><li> <a href="/blog/release-13/" class="flex items-center"> <span>Higress 开源一周年：新版本，新标准，新工具，新征程</span>   </a> </li><li> <a href="/blog/plugin-transformer/" class="flex items-center"> <span>通过 Higress Wasm 插件 3 倍性能实现 Spring-cloud-gateway 功能</span>   </a> </li><li> <a href="/blog/config-with-file/" class="flex items-center"> <span>基于文件配置实现 Higress 极简独立部署</span>   </a> </li><li> <a href="/blog/higress-gvr7dx_awbbpb_un7afz9yhq61u2fk/" class="flex items-center"> <span>下一代云原生网关Higress：基于Wasm开发JWT认证插件</span>   </a> </li><li> <a href="/blog/configmap/" class="flex items-center"> <span>Higress 全局配置控制面原理分析</span>   </a> </li><li> <a href="/blog/ai_plugin/" class="flex items-center"> <span>Higress助力AI大模型企业级应用落地</span>   </a> </li><li> <a href="/blog/release-100/" class="flex items-center"> <span>上线控制台，降低使用门槛 ｜ Higress 1.0.0 RC 版本发布</span>   </a> </li><li> <a href="/blog/higress-gvr7dx_awbbpb_gk5nkrhm7uvuulgg/" class="flex items-center"> <span>Higress GitHub star 突破 1k ，来自社区开发者和用户的寄语</span>   </a> </li><li> <a href="/blog/release-070/" class="flex items-center"> <span>Higress 0.7.0 版本发布：GA 进入倒计时</span>   </a> </li><li> <a href="/blog/higress-gvr7dx_awbbpb_uwbg4wym8snz2m0z/" class="flex items-center"> <span>Higress 0.6.0 版本发布：更简单，更易用</span>   </a> </li><li> <a href="/blog/higress-gvr7dx_awbbpb_fi4t7317cvughlzh/" class="flex items-center"> <span>Higress 实战：30 行代码写一个 Wasm Go插件</span>   </a> </li><li> <a href="/blog/higress-gvr7dx_awbbpb_pcctqnntrosrhh0d/" class="flex items-center"> <span>Higress 社区周会记要（2022/11/26）</span>   </a> </li><li> <a href="/blog/higress/" class="flex items-center"> <span>阿里巴巴重磅开源云原生网关</span>   </a> </li> </ul> </span>  </details> </li> </ul> </span>  </blog-theme>  </div> <div class="blog-slug-container w-full 2xl:ml-[20%] xl:ml-[20%] lg:ml-[20%] md:ml-[20%] md:w-[80%] inline-block"> <div id="back-btn" class="pt-4 pl-6"> <span class="not-content"><a class="btn btn btn-secondary rounded-3xl no-underline" target="_self" rel="noopener noreferrer"> <svg aria-hidden="true" class="text-lg align-middle astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 11H9.41l3.3-3.29a1.004 1.004 0 1 0-1.42-1.42l-5 5a1 1 0 0 0-.21.33 1 1 0 0 0 0 .76 1 1 0 0 0 .21.33l5 5a1.002 1.002 0 0 0 1.639-.325 1 1 0 0 0-.219-1.095L9.41 13H17a1 1 0 0 0 0-2Z"/></svg>  <span class="ml-0.5">BACK</span> </a></span> </div> <span class="markdown-detail-wrapper"> <div class="sl-markdown-content"> <div class="hero-image">  </div> <main> <div class="website-prose mx-auto"> <div class="title"> <h1 id="_top">大模型带火 API 后，分享我对 API 安全之认证鉴权的实践</h1> <div></div> <p class="text-left">发布时间 2025-03-11</p> <hr> </div>  <h2 id="前言">前言</h2>
<p><font style="color:rgb(24, 24, 24);">云原生API网关（以下简称-网关）是云原生网关的升级版，除继承了原云原生网关的全部能力，为用户叠加了API管理的能力。API作为企业的重要数字资源，在给企业带来巨大便利的同时也带来了新的安全问题，一旦被攻击可能导致数据泄漏重大安全问题，从而给企业的业务发展带来极大的安全风险。</font></p>
<p><font style="color:rgb(24, 24, 24);">正是在这样的背景下，OpenAPI规范中针对API安全做了明确的定义和引导，以便用户可以安全的管理自己的API。</font></p>
<p><font style="color:rgb(24, 24, 24);">以下为openapi的定义：</font><a href="https://swagger.io/docs/specification/v3_0/about/" referrerpolicy="unsafe-url" rel="nofollow" target="_blank">What is openAPI</a></p>
<p><font style="color:rgb(33, 37, 41);">An OpenAPI file allows you to describe your entire API, including:</font></p>
<ul>
<li><font style="color:rgb(33, 37, 41);">Available endpoints (</font><code dir="auto">&#x3C;font style="color:rgb(33, 37, 41);">/users&#x3C;/font></code><font style="color:rgb(33, 37, 41);">) and operations on each endpoint (</font><code dir="auto">&#x3C;font style="color:rgb(33, 37, 41);">GET /users&#x3C;/font></code><font style="color:rgb(33, 37, 41);">,</font><font style="color:rgb(33, 37, 41);"> </font><code dir="auto">&#x3C;font style="color:rgb(33, 37, 41);">POST /users&#x3C;/font></code><font style="color:rgb(33, 37, 41);">)</font></li>
<li><font style="color:rgb(33, 37, 41);">Operation parameters Input and output for each operation</font></li>
<li><font style="color:rgb(33, 37, 41);">Authentication methods</font></li>
<li><font style="color:rgb(33, 37, 41);">Contact information, license, terms of use, and other information.</font></li>
</ul>
<p><font style="color:rgb(33, 37, 41);">可以看到认证鉴权是保护API必要而又最常用的手段。云原生API网关是完全遵循OpenAPI规范的阿里云新一代API网关，支持丰富的认证鉴权是其核心竞争力之一</font></p>
<h2 id="什么是认证鉴权"><font style="color:rgb(33, 37, 41);">什么是认证鉴权</font></h2>
<p>认证：是指验证用户身份的过程。简单来说，认证的目的是确认用户是谁。在这个过程中，用户通常需要提供某种凭证，例如用户名和密码、指纹、面部识别，或是其他生物特征，甚至是安全令牌（如两步验证中的验证码）。通过这些凭证，系统将用户的身份与已有的身份信息进行比对，从而确认其真实性。</p>
<p>鉴权：是指验证用户是否有权限访问某项资源或执行某项操作。虽然认证确认了用户身份，但它并不能确定该用户可以做什么。这方面的决策依赖于系统的权限管理策略。例如，在一个企业内部系统中，某位员工可能拥有访问某些文件的权限，但另一些敏感文件则可能只对高级管理层开放。鉴权的目的就是在用户经过认证后，根据其角色和权限设置，决定是否允许其访问特定资源或执行特定操作。</p>
<h2 id="认证authentication">认证（Authentication）</h2>
<h3 id="key-认证">Key 认证</h3>
<p>云原生API网关中的Key认证叫Api Key认证在消费者鉴权中统一透出。Key认证是对用户密码认证方式的方式的优化版本，通过静态秘钥的方式，为用户提供了一种简便快捷且安全的认证方式，具有较为鲜明的优缺点：</p>
<h4 id="优点">优点：</h4>
<p>1、简单易用，只需要在请求中传输秘钥即可，验证非常简单、性能高</p>
<p>2、认证过程无需用户参与，对自动化应用非常友好</p>
<p>3、服务器（网关）可以随时生成、汰换（删除）、重置（切换）秘钥，管理方便</p>
<h4 id="缺点">缺点：</h4>
<p>1、安全隐患，秘钥传输过程中很容易泄漏，泄漏后任何人都可以使用秘钥来伪装合法身份，进行未授权的操作；秘钥的分配和管理复杂</p>
<p>2、无法提供用户身份，审计较为困难</p>
<h4 id="api-key认证的基本流程">Api Key认证的基本流程</h4>
<p><a href="https://aliyuque.antfin.com/senming.gsm/zu4skz/mvwulm5oghbkuq8r?inner=GW85R" referrerpolicy="unsafe-url" rel="nofollow" target="_blank">云原生 API 网关- API 安全之认证鉴权</a></p>
<p>云原生API网关的通过消费者授权来支持 Api Key认证，用户在消费者创建流程中，选择API Key身份认证，并且为其设置凭证来源和添加凭证</p>
<p><img src="/img/1745490436249.png" alt="" referrerpolicy="no-referrer"></p>
<p>云原生网关支持三种凭证来源设置方式：来源于固定Header头”Authorization”、来源于自定义Header头、以及来源自定义QueryString</p>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.1vui4.css"><script type="module" src="/_astro/ec.dy9ns.js"></script><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">curl  http://xxx.hello.com/test?apikey=2bda943c-ba2b-11ec-ba07-00163e1250b5</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="curl  http://xxx.hello.com/test?apikey=2bda943c-ba2b-11ec-ba07-00163e1250b5"><div></div></button></div></figure></div>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">curl  http://xxx.hello.com/test -H 'x-api-key: 2bda943c-ba2b-11ec-ba07-00163e1250b5'</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="curl  http://xxx.hello.com/test -H &#x27;x-api-key: 2bda943c-ba2b-11ec-ba07-00163e1250b5&#x27;"><div></div></button></div></figure></div>
<h3 id="jwt-认证">JWT 认证</h3>
<h4 id="什么是jwt">什么是JWT</h4>
<p><font style="color:rgb(51, 51, 51);">JWT（JSON Web Token）是一种用于安全信息传递的开放标准，它允许在通信双方之间以JSON对象的形式传输安全信息，它设计为其中的信息可以被验证和信任。</font></p>
<p><font style="color:rgb(51, 51, 51);">JWT通常由三部分组成：头部（Header）、载荷（Payload）和签名（Signature），其内容构造过程如下：</font></p>
<ol>
<li><strong><font style="color:rgb(51, 51, 51);">头部（Header）</font></strong><font style="color:rgb(51, 51, 51);">:</font></li>
</ol>
<p>通常由两部分组成：令牌的类型（通常是JWT）和所使用的签名算法（如HMAC SHA256，<font style="color:rgb(51, 51, 51);">在下文JWKS中指定</font>）；</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">  </span></span><span style="--0:#e1e4e8">"alg": "HS256",</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">  </span></span><span style="--0:#e1e4e8">"typ": "JWT"</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="{  &#x22;alg&#x22;: &#x22;HS256&#x22;,  &#x22;typ&#x22;: &#x22;JWT&#x22;}"><div></div></button></div></figure></div>
<p><font style="color:rgb(51, 51, 51);">然后将头部进行Base64编码（该编码是可以对称解码的），得到第一部分：</font></p>
<p>eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9</p>
<ol start="2">
<li><strong><font style="color:rgb(51, 51, 51);">载荷（Payload）</font></strong><font style="color:rgb(51, 51, 51);">:</font></li>
</ol>
<p><font style="color:rgb(51, 51, 51);">包含对JWT的声明（Claims），这些声明是关于实体（通常是用户）和其他数据的。定义细节如下：</font></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">iss：令牌颁发者。表示该令牌由谁创建，该声明是一个字符串</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">sub: Subject Identifier，iss提供的终端用户的标识，在iss范围内唯一，最长为255个ASCII个字符，区分大小写</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">aud：Audience(s)，令牌的受众，分大小写的字符串数组</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">exp：Expiration time，令牌的过期时间戳。超过此时间的token会作废， 该声明是一个整数，是1970年1月1日以来的秒数</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">iat: 令牌的颁发时间，该声明是一个整数，是1970年1月1日以来的秒数</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">jti: 令牌的唯一标识，该声明的值在令牌颁发者创建的每一个令牌中都是唯一的，为了防止冲突，它通常是一个密码学随机值。这个值相当于向结构化令牌中加入了一个攻击者无法获得的随机熵组件，有利于防止令牌猜测攻击和重放攻击。</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="iss：令牌颁发者。表示该令牌由谁创建，该声明是一个字符串sub: Subject Identifier，iss提供的终端用户的标识，在iss范围内唯一，最长为255个ASCII个字符，区分大小写aud：Audience(s)，令牌的受众，分大小写的字符串数组exp：Expiration time，令牌的过期时间戳。超过此时间的token会作废， 该声明是一个整数，是1970年1月1日以来的秒数iat: 令牌的颁发时间，该声明是一个整数，是1970年1月1日以来的秒数jti: 令牌的唯一标识，该声明的值在令牌颁发者创建的每一个令牌中都是唯一的，为了防止冲突，它通常是一个密码学随机值。这个值相当于向结构化令牌中加入了一个攻击者无法获得的随机熵组件，有利于防止令牌猜测攻击和重放攻击。"><div></div></button></div></figure></div>
<p><font style="color:rgb(51, 51, 51);">也可以新增用户系统需要使用的自定义字段，比如下面的例子添加了name 用户昵称：</font></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">  </span></span><span style="--0:#e1e4e8">"sub": "1234567890",</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">  </span></span><span style="--0:#e1e4e8">"name": "John Doe"</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="{  &#x22;sub&#x22;: &#x22;1234567890&#x22;,  &#x22;name&#x22;: &#x22;John Doe&#x22;}"><div></div></button></div></figure></div>
<p><font style="color:rgb(51, 51, 51);">然后将其进行Base64编码，得到JWT的第二部分：</font></p>
<p><code dir="auto">JTdCJTBBJTIwJTIwJTIyc3ViJTIyJTNBJTIwJTIyMTIzNDU2Nzg5MCUyMiUyQyUwQSUyMCUyMCUyMm5hbWUlMjIlM0ElMjAlMjJKb2huJTIwRG9lJTIyJTBBJTdE</code></p>
<ol start="3">
<li><strong>签名（Signature）</strong>:</li>
</ol>
<p><font style="color:rgb(51, 51, 51);">为了生成签名部分，需要将编码后的头部、载荷和一个密钥（有些情况下是私钥）按照指定的算法（在下文JWKS中指定）组合在一起进行签名。<br>
</font><font style="color:rgb(51, 51, 51);">这个部分需要Base64编码后的Header和Base64编码后的Payload使用 . 连接组成的字符串，然后通过Header中声明的加密方式进行加密（$secret 表示用户的私钥），然后就构成了jwt的第三部分。</font></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">var encodedString = base64UrlEncode(header) + '.' + base64UrlEncode(payload);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">var signature = HMACSHA256(encodedString, '$secret');</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="var encodedString = base64UrlEncode(header) + &#x27;.&#x27; + base64UrlEncode(payload);var signature = HMACSHA256(encodedString, &#x27;$secret&#x27;);"><div></div></button></div></figure></div>
<p><font style="color:rgb(51, 51, 51);">将这三部分用 . 连接成一个完整的字符串，</font><code dir="auto">&#x3C;font style="color:rgb(51, 51, 51);">eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.&#x3C;/font>JTdCJTBBJTIwJTIwJTIyc3ViJTIyJTNBJTIwJTIyMTIzNDU2Nzg5MCUyMiUyQyUwQSUyMCUyMCUyMm5hbWUlMjIlM0ElMjAlMjJKb2huJTIwRG9lJTIyJTBBJTdE&#x3C;font style="color:rgb(51, 51, 51);">.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ&#x3C;/font></code></p>
<h4 id="什么是jwks">什么是JWKS</h4>
<p>在云原生API网关中，通过一组<font style="color:rgb(51, 51, 51);">JWKS</font>来描述Header信息，<font style="color:rgb(51, 51, 51);">JWKS（JSON Web Key Set）是一种用于表示公钥和私钥集合的格式，通常用于支持 JWT 的身份验证和授权场景。</font></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">    </span></span><span style="--0:#e1e4e8">"keys": [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">        </span></span><span style="--0:#e1e4e8">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">            </span></span><span style="--0:#e1e4e8">"kty": "oct",</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">            </span></span><span style="--0:#e1e4e8">"k": "GFmQpiJq42SxAWyIN5vnlUzrVDhcdBjKZ8uw0ag3XO1",</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">            </span></span><span style="--0:#e1e4e8">"alg": "HS256"</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">        </span></span><span style="--0:#e1e4e8">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">    </span></span><span style="--0:#e1e4e8">]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="{    &#x22;keys&#x22;: [        {            &#x22;kty&#x22;: &#x22;oct&#x22;,            &#x22;k&#x22;: &#x22;GFmQpiJq42SxAWyIN5vnlUzrVDhcdBjKZ8uw0ag3XO1&#x22;,            &#x22;alg&#x22;: &#x22;HS256&#x22;        }    ]}"><div></div></button></div></figure></div>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">    </span></span><span style="--0:#e1e4e8">"keys": [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">        </span></span><span style="--0:#e1e4e8">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">            </span></span><span style="--0:#e1e4e8">"e": "公钥的指数，例如AQAB",</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">            </span></span><span style="--0:#e1e4e8">"kid": "Key ID",</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">            </span></span><span style="--0:#e1e4e8">"kty": "使用的加密算法的家族，例如RSA，必填，大小写敏感",</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">            </span></span><span style="--0:#e1e4e8">"alg": "使用的具体的加密算法，例如RS256，必填，大小写敏感",</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">            </span></span><span style="--0:#e1e4e8">"use": "密钥的用途，例如sig，用于签名",</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">            </span></span><span style="--0:#e1e4e8">"n": "公钥的模值"</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">        </span></span><span style="--0:#e1e4e8">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">    </span></span><span style="--0:#e1e4e8">]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="{    &#x22;keys&#x22;: [        {            &#x22;e&#x22;: &#x22;公钥的指数，例如AQAB&#x22;,            &#x22;kid&#x22;: &#x22;Key ID&#x22;,            &#x22;kty&#x22;: &#x22;使用的加密算法的家族，例如RSA，必填，大小写敏感&#x22;,            &#x22;alg&#x22;: &#x22;使用的具体的加密算法，例如RS256，必填，大小写敏感&#x22;,            &#x22;use&#x22;: &#x22;密钥的用途，例如sig，用于签名&#x22;,            &#x22;n&#x22;: &#x22;公钥的模值&#x22;        }    ]}"><div></div></button></div></figure></div>
<h4 id="jwt-认证是云原生api网关消费者认证能力中的一种其认证流程如下"><font style="color:rgb(51, 51, 51);">JWT 认证是云原生API网关消费者认证能力中的一种，其认证流程如下：</font></h4>
<p><a href="https://aliyuque.antfin.com/senming.gsm/zu4skz/mvwulm5oghbkuq8r?inner=anS1c" referrerpolicy="unsafe-url" rel="nofollow" target="_blank">云原生 API 网关- API 安全之认证鉴权</a></p>
<ol>
<li><font style="color:rgb(51, 51, 51);">客户端向API网关发起认证请求，请求中一般会携带终端用户的用户名和密码。</font></li>
<li><font style="color:rgb(51, 51, 51);">网关将请求直接转发给后端服务。</font></li>
<li><font style="color:rgb(51, 51, 51);">后端服务读取请求中的验证信息（比如用户名、密码）进行验证，验证通过后使用私钥生成标准的token，返回给网关。</font></li>
<li><font style="color:rgb(51, 51, 51);">网关将携带token的应答返回给客户端，客户端需要将这个token缓存到本地。</font></li>
<li><font style="color:rgb(51, 51, 51);">客户端向API网关发送业务请求，请求中携带token。</font></li>
<li><font style="color:rgb(51, 51, 51);">网关使用用户通过JWT认证配置中JWKS设定的公钥对请求中的token进行验证，验证通过后，将请求透传给后端服务。</font></li>
<li><font style="color:rgb(51, 51, 51);">后端服务进行业务处理后应答。</font></li>
<li><font style="color:rgb(51, 51, 51);">网关将业务应答返回给客户端。</font></li>
</ol>
<h4 id="注意事项">注意事项：</h4>
<ol>
<li><font style="color:rgb(51, 51, 51);">JWT 通常设置有过期时间，过期时间的设置是一次性的，即客户端需要合理的管理 Token 的失效以免 Token 失效后影响访问，同时 Token 一旦颁发无法撤销，即使用户已经无权限，只要 Token 还在有效期，便依然可以访问，引发安全风险。</font></li>
<li><font style="color:rgb(51, 51, 51);">JWT 默认是不加密，不要将秘密数据写入 JWT。</font></li>
<li>JWT 本身包含了认证信息，一旦泄露，任何人都可以获得该令牌的所有权限。为了减少盗用，JWT 的有效期应该设置得比较短。对于一些比较重要的权限，使用时应该再次对用户进行认证。</li>
<li>为了减少盗用，JWT 不应该使用 HTTP 协议明码传输，要使用HTTPS 协议传输。</li>
</ol>
<h3 id="aksk-认证">AK/SK 认证</h3>
<p><strong><font style="color:rgb(51, 51, 51);">AK(Access Key ID)/SK（Access Secret Key）</font></strong><font style="color:rgb(51, 51, 51);">：是阿里云对一个明确的用户身份的一个抽象，云原生API网关沿用这个设计（注意：这里的云原生 API 网关生成的 AK/SK 与 RAM 的 AK /SK 相互独立，并不能互通使用），用来标识一个网关用户的身份，因为每个用户可能有多种身份类型，每种身份类型可以有多个凭证，类似多个账号，一组AK/SK可以简单对应到一组用户账密。</font></p>
<p><font style="color:rgb(51, 51, 51);">API提供者给有权限的用户分配AK/SK，API消费者请求时带上AK，服务端就可以识别调用者的信息，并进行更细粒度的权限管理。</font></p>
<p><strong><font style="color:rgb(51, 51, 51);">HMAC：</font></strong><font style="color:rgb(51, 51, 51);">HMAC（Hash-based Message Authentication Code）是一种基于哈希函数的消息认证码，用于验证信息的完整性和身份验证。HMAC结合了哈希函数和密钥的优点，提供了数据的完整性和安全认证的保证。</font></p>
<p><font style="color:rgb(51, 51, 51);">在基于HMAC 的AK/SK 认证过程中，HMAC的主要作用是确保消息的完整性和身份验证。其具体作用如下：</font></p>
<ol>
<li><strong>身份验证</strong>：通过使用共享密钥，只有持有该密钥的用户才能生成正确的HMAC，从而可以确认消息的发送者的身份。</li>
<li><strong>数据完整性</strong>：任何对消息内容的修改都会导致HMAC值的变化，因此接收方可以通过计算接收到的消息的HMAC值来验证消息在传输过程中是否被篡改。</li>
<li><strong>防止重放攻击</strong>：在某些情况下，HMAC还可以帮助防止重放攻击。通过在消息中加入时间戳或随机数，接收方可以确保消息的唯一性和新鲜性。</li>
</ol>
<h4 id="akskhmac认证是云原生api网关消费者认证能力中的一种其认证流程包括客户端生成签名和服务端验证前面两个步骤"><font style="color:rgb(51, 51, 51);">AK/SK（HMAC）认证是云原生API网关消费者认证能力中的一种，其认证流程包括客户端生成签名和服务端验证前面两个步骤</font></h4>
<h5 id="客户端生成签名流程"><font style="color:rgb(51, 51, 51);">客户端生成签名流程：</font></h5>
<p><a href="https://aliyuque.antfin.com/senming.gsm/zu4skz/mvwulm5oghbkuq8r?inner=x7N1B" referrerpolicy="unsafe-url" rel="nofollow" target="_blank">云原生 API 网关- API 安全之认证鉴权</a></p>
<ol>
<li><font style="color:rgb(51, 51, 51);">提取签名串：客户端从HTTP请求中提取出关键数据，组成一个签名串，如云原生API网关的签名串内容主要由以下7部分组成：</font></li>
</ol>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">HTTPMethod</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">Accept</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">Content-MD5</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">Content-Type</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">Date</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">Headers</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">PathAndParameters</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="HTTPMethodAcceptContent-MD5Content-TypeDateHeadersPathAndParameters"><div></div></button></div></figure></div>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">POST /http2test/test?param1=test HTTP/1.1</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">host:api.aliyun.com</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">accept:application/json; charset=utf-8</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">ca_version:1</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">content-type:application/x-www-form-urlencoded; charset=utf-8</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">x-ca-timestamp:1525872629832</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">date:Wed, 09 May 2018 13:30:29 GMT+00:00</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">user-agent:ALIYUN-ANDROID-DEMO</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">x-ca-nonce:c9f15cbf-f4ac-4a6c-b54d-f51abf4b5b44</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">content-length:33</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">username=xiaoming&#x26;password=123456789</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="POST /http2test/test?param1=test HTTP/1.1host:api.aliyun.comaccept:application/json; charset=utf-8ca_version:1content-type:application/x-www-form-urlencoded; charset=utf-8x-ca-timestamp:1525872629832date:Wed, 09 May 2018 13:30:29 GMT+00:00user-agent:ALIYUN-ANDROID-DEMOx-ca-nonce:c9f15cbf-f4ac-4a6c-b54d-f51abf4b5b44content-length:33username=xiaoming&#x26;password=123456789"><div></div></button></div></figure></div>
<p>提取原签名串并追加AK/SK认证的 AK和签名算法，形成最终签名串，header之间用\n 换行符分隔</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">POST</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">application/json; charset=utf-8</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">application/x-www-form-urlencoded; charset=utf-8</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">Wed, 09 May 2018 13:30:29 GMT+00:00</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">/http2test/test?param1=test&#x26;password=123456789&#x26;username=xiaoming</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">x-ca-nonce:c9f15cbf-f4ac-4a6c-b54d-f51abf4b5b44</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">x-ca-timestamp:1525872629832</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">##添加AK/SK认证Headers</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">x-ca-key:203753385，AK/SK身份配置中的AK</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">x-ca-signature-method:HmacSHA256</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="POSTapplication/json; charset=utf-8application/x-www-form-urlencoded; charset=utf-8Wed, 09 May 2018 13:30:29 GMT+00:00/http2test/test?param1=test&#x26;password=123456789&#x26;username=xiaomingx-ca-nonce:c9f15cbf-f4ac-4a6c-b54d-f51abf4b5b44x-ca-timestamp:1525872629832##添加AK/SK认证Headersx-ca-key:203753385，AK/SK身份配置中的AKx-ca-signature-method:HmacSHA256"><div></div></button></div></figure></div>
<ol start="2">
<li><font style="color:rgb(51, 51, 51);">加密签名：对第1步提取的签名串使用HmacSha256算法进行加密和Base64编码处理得到签名内容，如</font></li>
</ol>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#E1E4E8">Mac hmacSha256 </span><span style="--0:#F97583">=</span><span style="--0:#E1E4E8"> Mac.</span><span style="--0:#B392F0">getInstance</span><span style="--0:#E1E4E8">(</span><span style="--0:#9ECBFF">"HmacSHA256"</span><span style="--0:#E1E4E8">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F97583">byte</span><span style="--0:#E1E4E8">[] secretBytes </span><span style="--0:#F97583">=</span><span style="--0:#E1E4E8"> secret.</span><span style="--0:#B392F0">getBytes</span><span style="--0:#E1E4E8">(</span><span style="--0:#9ECBFF">"UTF-8"</span><span style="--0:#E1E4E8">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8">hmacSha256.</span><span style="--0:#B392F0">init</span><span style="--0:#E1E4E8">(</span><span style="--0:#F97583">new</span><span style="--0:#E1E4E8"> </span><span style="--0:#B392F0">SecretKeySpec</span><span style="--0:#E1E4E8">(secretBytes, </span><span style="--0:#79B8FF">0</span><span style="--0:#E1E4E8">, secretBytes.length, </span><span style="--0:#9ECBFF">"HmacSHA256"</span><span style="--0:#E1E4E8">));</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F97583">byte</span><span style="--0:#E1E4E8">[] result </span><span style="--0:#F97583">=</span><span style="--0:#E1E4E8"> hmacSha256.</span><span style="--0:#B392F0">doFinal</span><span style="--0:#E1E4E8">(stringToSign.</span><span style="--0:#B392F0">getBytes</span><span style="--0:#E1E4E8">(</span><span style="--0:#9ECBFF">"UTF-8"</span><span style="--0:#E1E4E8">));</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8">String sign </span><span style="--0:#F97583">=</span><span style="--0:#E1E4E8"> Base64.</span><span style="--0:#B392F0">encodeBase64String</span><span style="--0:#E1E4E8">(result);</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="Mac hmacSha256 = Mac.getInstance(&#x22;HmacSHA256&#x22;);byte[] secretBytes = secret.getBytes(&#x22;UTF-8&#x22;);hmacSha256.init(new SecretKeySpec(secretBytes, 0, secretBytes.length, &#x22;HmacSHA256&#x22;));byte[] result = hmacSha256.doFinal(stringToSign.getBytes(&#x22;UTF-8&#x22;));String sign = Base64.encodeBase64String(result);"><div></div></button></div></figure></div>
<ol start="3">
<li><font style="color:rgb(51, 51, 51);">添加签名：将第2步生成的签名和参与前面参与加签的header作为header一并添加到http请求中</font></li>
</ol>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">x-ca-signature-headers：参与签名的header的key的集合，英文逗号分隔</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">x-ca-signature：签名，必选。</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="x-ca-signature-headers：参与签名的header的key的集合，英文逗号分隔x-ca-signature：签名，必选。"><div></div></button></div></figure></div>
<p>得到待发送给网关的携带签名的HTTP请求</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">POST /http2test/test?param1=test HTTP/1.1</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">host:api.aliyun.com</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">accept:application/json; charset=utf-8</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">ca_version:1</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">content-type:application/x-www-form-urlencoded; charset=utf-8</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">x-ca-timestamp:1525872629832</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">date:Wed, 09 May 2018 13:30:29 GMT+00:00</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">user-agent:ALIYUN-ANDROID-DEMO</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">x-ca-nonce:c9f15cbf-f4ac-4a6c-b54d-f51abf4b5b44</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">content-length:33</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">username=xiaoming&#x26;password=123456789</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">##添加AK/SK认证Headers</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">x-ca-key:203753385</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">x-ca-signature-method:HmacSHA256</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">##添加AK/SK认证Headers签名相关的headers</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">x-ca-signature-headers:x-ca-timestamp,x-ca-key,x-ca-nonce,x-ca-signature-method</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">x-ca-signature:xfX+bZxY2yl7EB/qdoDy9v/uscw3Nnj1pgoU+Bm6xdM=</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="POST /http2test/test?param1=test HTTP/1.1host:api.aliyun.comaccept:application/json; charset=utf-8ca_version:1content-type:application/x-www-form-urlencoded; charset=utf-8x-ca-timestamp:1525872629832date:Wed, 09 May 2018 13:30:29 GMT+00:00user-agent:ALIYUN-ANDROID-DEMOx-ca-nonce:c9f15cbf-f4ac-4a6c-b54d-f51abf4b5b44content-length:33username=xiaoming&#x26;password=123456789##添加AK/SK认证Headersx-ca-key:203753385x-ca-signature-method:HmacSHA256##添加AK/SK认证Headers签名相关的headersx-ca-signature-headers:x-ca-timestamp,x-ca-key,x-ca-nonce,x-ca-signature-methodx-ca-signature:xfX+bZxY2yl7EB/qdoDy9v/uscw3Nnj1pgoU+Bm6xdM="><div></div></button></div></figure></div>
<h5 id="网关验证签名流程图"><font style="color:rgb(51, 51, 51);">网关验证签名流程图：</font></h5>
<p><a href="https://aliyuque.antfin.com/senming.gsm/zu4skz/mvwulm5oghbkuq8r?inner=VUh5K" referrerpolicy="unsafe-url" rel="nofollow" target="_blank">云原生 API 网关- API 安全之认证鉴权</a></p>
<ol>
<li><font style="color:rgb(24, 24, 24);">提取签名串：从接收到的请求中提取关键数据，得到一个用来签名的字符串。</font></li>
</ol>
<p>收到的HTTP请求</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">POST /http2test/test?param1=test HTTP/1.1</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">host:api.aliyun.com</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">accept:application/json; charset=utf-8</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">ca_version:1</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">content-type:application/x-www-form-urlencoded; charset=utf-8</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">x-ca-timestamp:1525872629832</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">date:Wed, 09 May 2018 13:30:29 GMT+00:00</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">user-agent:ALIYUN-ANDROID-DEMO</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">x-ca-nonce:c9f15cbf-f4ac-4a6c-b54d-f51abf4b5b44</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">content-length:33</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">username=xiaoming&#x26;password=123456789</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">##AK/SK（HMAC）认证新增的header</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">x-ca-key:203753385</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">x-ca-signature-method:HmacSHA256</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">##签名新增的header</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">x-ca-signature-headers:x-ca-timestamp,x-ca-key,x-ca-nonce,x-ca-signature-method</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">x-ca-signature:xfX+bZxY2yl7EB/qdoDy9v/uscw3Nnj1pgoU+Bm6xdM=</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="POST /http2test/test?param1=test HTTP/1.1host:api.aliyun.comaccept:application/json; charset=utf-8ca_version:1content-type:application/x-www-form-urlencoded; charset=utf-8x-ca-timestamp:1525872629832date:Wed, 09 May 2018 13:30:29 GMT+00:00user-agent:ALIYUN-ANDROID-DEMOx-ca-nonce:c9f15cbf-f4ac-4a6c-b54d-f51abf4b5b44content-length:33username=xiaoming&#x26;password=123456789##AK/SK（HMAC）认证新增的headerx-ca-key:203753385x-ca-signature-method:HmacSHA256##签名新增的headerx-ca-signature-headers:x-ca-timestamp,x-ca-key,x-ca-nonce,x-ca-signature-methodx-ca-signature:xfX+bZxY2yl7EB/qdoDy9v/uscw3Nnj1pgoU+Bm6xdM="><div></div></button></div></figure></div>
<ol start="2">
<li><font style="color:rgb(24, 24, 24);">提取AK：从接收到的请求中读取AK ，通过AK 查询到对应的SK</font></li>
<li><font style="color:rgb(24, 24, 24);">提取签名串并计算签名：使用加密算法和SK对关键数据签名串进行加密处理，得到签名。</font></li>
</ol>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">POST /http2test/test?param1=test HTTP/1.1</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">host:api.aliyun.com</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">accept:application/json; charset=utf-8</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">ca_version:1</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">content-type:application/x-www-form-urlencoded; charset=utf-8</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">x-ca-timestamp:1525872629832</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">date:Wed, 09 May 2018 13:30:29 GMT+00:00</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">user-agent:ALIYUN-ANDROID-DEMO</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">x-ca-nonce:c9f15cbf-f4ac-4a6c-b54d-f51abf4b5b44</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">content-length:33</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">username=xiaoming&#x26;password=123456789</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">##AK/SK（HMAC）认证新增的header</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">x-ca-key:203753385</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">x-ca-signature-method:HmacSHA256</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="POST /http2test/test?param1=test HTTP/1.1host:api.aliyun.comaccept:application/json; charset=utf-8ca_version:1content-type:application/x-www-form-urlencoded; charset=utf-8x-ca-timestamp:1525872629832date:Wed, 09 May 2018 13:30:29 GMT+00:00user-agent:ALIYUN-ANDROID-DEMOx-ca-nonce:c9f15cbf-f4ac-4a6c-b54d-f51abf4b5b44content-length:33username=xiaoming&#x26;password=123456789##AK/SK（HMAC）认证新增的headerx-ca-key:203753385x-ca-signature-method:HmacSHA256"><div></div></button></div></figure></div>
<ol start="4">
<li><font style="color:rgb(24, 24, 24);">签名验证：从接收到的请求中读取客户端签名，服务端使用第3不获取的私钥进行签名验证，对比服务器端签名和客户端签名的一致性，从而判断客户是否认证通过</font></li>
</ol>
<h3 id="oauth2认证">OAuth2认证</h3>
<h4 id="什么是oauth-20"><font style="color:rgb(51, 51, 51);">什么是OAuth 2.0</font></h4>
<p><font style="color:rgb(51, 51, 51);">OAuth 2.0 是一种用于授权的协议，广泛用于互联网应用以实现安全的授权机制。OAuth 2.0定义以下几种角色：</font></p>
<ul>
<li><strong><font style="color:rgb(51, 51, 51);">资源拥有者（Resource Owner）</font></strong><font style="color:rgb(51, 51, 51);">：通常是用户，拥有数据访问权限，以下简称为用户</font></li>
<li><strong><font style="color:rgb(51, 51, 51);">客户端（Client）</font></strong><font style="color:rgb(51, 51, 51);">：请求访问资源的应用程序。</font></li>
<li><strong><font style="color:rgb(51, 51, 51);">授权服务器（Authorization Server）</font></strong><font style="color:rgb(51, 51, 51);">：负责验证用户并发放访问令牌的服务器。</font></li>
<li><strong><font style="color:rgb(51, 51, 51);">资源服务器（Resource Server）</font></strong><font style="color:rgb(51, 51, 51);">：存储用户数据的服务器。</font></li>
</ul>
<h4 id="oauth-20协议的流程主要包含以下几个步骤"><font style="color:rgb(51, 51, 51);">OAuth 2.0协议的流程主要包含以下几个步骤：</font></h4>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">1、客户端请求用户授权，此时通常会跳转第三方登录页</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">2、资源拥有者用户同意授权</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">3、客户端使用已获得授权，请求授权服务器发放Access Token</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">4、授权服务器返回Access Token</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">5、客户端使用Access Token，请求资源服务器</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">6、资源服务器验证Access Token，并返回受保护的资源</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="1、客户端请求用户授权，此时通常会跳转第三方登录页2、资源拥有者用户同意授权3、客户端使用已获得授权，请求授权服务器发放Access Token4、授权服务器返回Access Token5、客户端使用Access Token，请求资源服务器6、资源服务器验证Access Token，并返回受保护的资源"><div></div></button></div></figure></div>
<h4 id="抽象流程图">抽象流程图</h4>
<p><img src="/img/1745490439442.png" alt="" referrerpolicy="no-referrer"></p>
<h4 id="oauth-20协议定义了4种授权模式">OAuth 2.0协议定义了4种授权模式：</h4>
<ul>
<li>授权码模式（authorization code）</li>
<li>简化模式（implicit）</li>
<li>密码模式（resource owner password credentials）</li>
<li>客户端模式（client credentials）</li>
</ul>
<h5 id="授权码模式">授权码模式：</h5>
<p>其中授权码模式是最为广泛使用的授权模式，它适用于用户授予第三方客户端访问自身资源的场景，其核心流程如下：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">用户通过User-Agent（用户代理，通常是浏览器）与Client第三方客户端进行交互，其交互流程主要包含以下三步：</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">A、浏览器访问客户端应用程序</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">B、用户通过浏览器与客户端交互</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">C、客户端通过浏览器透传AuthorizationCode及RedirectUri等参数</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">User-Agent代理用户与授权服务器交互，其交互流程如下：</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">A、User-Agent使用第三方授权，User-Agent携带client定位符与重定向uri地址将用户指向</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">认证服务器的认证页</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">B、用户通过User-Agent授权访问</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">C、授权服务器进行认证鉴权，认证鉴权通过后将授权码附在A步骤重定向Uri地址之后，然后导向重定向Uri</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">D、客户端收到授权码将其附在重定向uri中，请求授权服务器，获取Access Token</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">E、授权服务器和核对重定向uri地址和授权码无误后，发放Access Token和Refresh Token（可选的）</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="用户通过User-Agent（用户代理，通常是浏览器）与Client第三方客户端进行交互，其交互流程主要包含以下三步：A、浏览器访问客户端应用程序B、用户通过浏览器与客户端交互C、客户端通过浏览器透传AuthorizationCode及RedirectUri等参数User-Agent代理用户与授权服务器交互，其交互流程如下：A、User-Agent使用第三方授权，User-Agent携带client定位符与重定向uri地址将用户指向认证服务器的认证页B、用户通过User-Agent授权访问C、授权服务器进行认证鉴权，认证鉴权通过后将授权码附在A步骤重定向Uri地址之后，然后导向重定向UriD、客户端收到授权码将其附在重定向uri中，请求授权服务器，获取Access TokenE、授权服务器和核对重定向uri地址和授权码无误后，发放Access Token和Refresh Token（可选的）"><div></div></button></div></figure></div>
<h5 id="授权码授权流程图">授权码授权流程图：</h5>
<p><img src="/img/1745490442409.png" alt="" referrerpolicy="no-referrer"></p>
<h5 id="客户端模式">客户端模式：</h5>
<p>客户端模式是一种简化的授权模式，它是客户端以”Client”的名义请求资源服务器，而不是以”用户”名义，它适用于受信的客户端访问</p>
<p><img src="/img/1745490445244.png" alt="" referrerpolicy="no-referrer"></p>
<h3 id="oidc-认证">OIDC 认证</h3>
<p><font style="color:rgb(51, 51, 51);">OIDC是OpenID Connect的简称。OIDC（OpenID Connect）是在OAuth 2.0之上构建的身份认证层，为应用程序提供用户身份验证的能力。</font></p>
<h4 id="为什么要有oidc"><font style="color:rgb(51, 51, 51);">为什么要有OIDC</font></h4>
<ol>
<li><strong>身份验证和授权的分离</strong>：OAuth 2.0主要关注授权Authorization，而OIDC扩展了认证的抽象，任意完成身份认证的 Provider实现，都能成为 Identity Provider，并作为OpenID Provider在 OIDC协议中承担认证的职责</li>
<li><strong>用户信息获取</strong>：OIDC在扩展认证的基础提供了标准化的API来获取用户的基本信息，使得开发者能够轻松集成用户的个人信息。</li>
</ol>
<p>总结一下：OAuth 2.0设计之初是为了解决授权的问题，而OIDC 在OAuth 2.0的基础上扩展了关于认证的定义并且添加一组获取用户信息的API，且OIDC 完全兼容OAuth 2.0协议。</p>
<h4 id="oidc-基于oauth-20协议实现的角色及关键资源定义">OIDC 基于OAuth 2.0协议实现的角色及关键资源定义</h4>


















































<table><thead><tr><th>OIDC</th><th>OAuth 2.0</th><th>身份描述</th></tr></thead><tbody><tr><td>EU End User</td><td>Resource Owner</td><td>用户、资源拥有者</td></tr><tr><td>RP Relying Party</td><td>Client</td><td>客户端（前端、移动端）</td></tr><tr><td>OpenID Provider</td><td>Authorization Server</td><td>认证服务</td></tr><tr><td>Resource Server</td><td>Resource Server</td><td>资源服务器，提供资源请求的服务器</td></tr><tr><td>ID Token</td><td>-</td><td>身份令牌（JWT），用于标识用户通过认证的身份，可以用获取用户信息</td></tr><tr><td>Access Token</td><td>Access Token</td><td>访问令牌（JWT），用于标识用户通过授权，Client 携带Access Token访问</td></tr><tr><td>Refresh Token</td><td>Refresh Token</td><td>刷新令牌，用于Access Token过期之后 的轮换</td></tr><tr><td>User-Agent</td><td>User-Agent</td><td>用户代理，通常是用户与互联交互的界面，比如浏览器</td></tr></tbody></table>
<h4 id="oidc-认证-1">OIDC 认证</h4>
<p><font style="color:rgb(24, 24, 24);">通过云原生API网关的OIDC认证功能，可以实现在网关统一认证鉴权，并支持域名级别的黑白名单方便用户灵活的管理认证授权的粒度，其核心流程如下：</font></p>
<h5 id="oidc-认证详细流程">OIDC 认证详细流程</h5>
<p><a href="https://aliyuque.antfin.com/senming.gsm/zu4skz/mvwulm5oghbkuq8r?inner=rtmQr" referrerpolicy="unsafe-url" rel="nofollow" target="_blank">云原生 API 网关- API 安全之认证鉴权</a></p>
<ol>
<li><font style="color:rgb(31, 35, 40);">访问用户受保护的资源（需要认证授权访问的API）</font></li>
</ol>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">curl --url "foo.bar.com/headers"</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="curl --url &#x22;foo.bar.com/headers&#x22;"><div></div></button></div></figure></div>
<ol start="2">
<li><font style="color:rgb(31, 35, 40);">云原生API网关将请求重定向到身份提供商（IDP）登录页同时携带 client_id、response_type、scope 等OIDC 认证的参数，response_type设置为code，即使用OAuth 2.0授权码模式获取token，同时设置csrf cookie， 防御csrf攻击（</font><font style="color:rgb(51, 51, 51);">Cross-Site Request Forgery -跨站请求伪造</font><font style="color:rgb(31, 35, 40);">) </font></li>
</ol>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">curl --url "https://dev-o43xb1mz7ya7ach4.us.auth0.com/authorize"\</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">  </span></span><span style="--0:#e1e4e8">--url-query "approval_prompt=force" \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">  </span></span><span style="--0:#e1e4e8">--url-query "client_id=YagFqRD9tfNIaac5BamjhsSatjrAnsnZ" \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">  </span></span><span style="--0:#e1e4e8">--url-query "redirect_uri=http%3A%2F%2Ffoo.bar.com%2Foauth2%2Fcallback" \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">  </span></span><span style="--0:#e1e4e8">--url-query "response_type=code" \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">  </span></span><span style="--0:#e1e4e8">--url-query "scope=openid+email+offline_access" \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">  </span></span><span style="--0:#e1e4e8">--url-query "state=nT06xdCqn4IqemzBRV5hmO73U_hCjskrH_VupPqdcdw%3A%2Ffoo" \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">  </span></span><span style="--0:#e1e4e8">--header "Set-Cookie: _oauth2_proxy_csrf=LPruATEDgcdmelr8zScD_ObhsbP4zSzvcgmPlcNDcJpFJ0OvhxP2hFotsU-kZnYxd5KsIjzeIXGTOjf8TKcbTHbDIt-aQoZORXI_0id3qeY0Jt78223DPeJ1xBqa8VO0UiEOUFOR53FGxirJOdKFxaAvxDFb1Ok=|1718962455|V1QGWyjQ4hMNOQ4Jtf17HeQJdVqHdt5d65uraFduMIU=; Path=/; Expires=Fri, 21 Jun 2024 08:06:20 GMT; HttpOnly"</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="curl --url &#x22;https://dev-o43xb1mz7ya7ach4.us.auth0.com/authorize&#x22;\  --url-query &#x22;approval_prompt=force&#x22; \  --url-query &#x22;client_id=YagFqRD9tfNIaac5BamjhsSatjrAnsnZ&#x22; \  --url-query &#x22;redirect_uri=http%3A%2F%2Ffoo.bar.com%2Foauth2%2Fcallback&#x22; \  --url-query &#x22;response_type=code&#x22; \  --url-query &#x22;scope=openid+email+offline_access&#x22; \  --url-query &#x22;state=nT06xdCqn4IqemzBRV5hmO73U_hCjskrH_VupPqdcdw%3A%2Ffoo&#x22; \  --header &#x22;Set-Cookie: _oauth2_proxy_csrf=LPruATEDgcdmelr8zScD_ObhsbP4zSzvcgmPlcNDcJpFJ0OvhxP2hFotsU-kZnYxd5KsIjzeIXGTOjf8TKcbTHbDIt-aQoZORXI_0id3qeY0Jt78223DPeJ1xBqa8VO0UiEOUFOR53FGxirJOdKFxaAvxDFb1Ok=|1718962455|V1QGWyjQ4hMNOQ4Jtf17HeQJdVqHdt5d65uraFduMIU=; Path=/; Expires=Fri, 21 Jun 2024 08:06:20 GMT; HttpOnly&#x22;"><div></div></button></div></figure></div>
<ol start="3">
<li><font style="color:rgb(31, 35, 40);">重定向到身份提供商（IDP）登录页（在云原生网关为用户配置的认证服务提供的登录页）</font></li>
</ol>
<p><img src="/img/1745490448021.png" alt="" referrerpolicy="no-referrer"></p>
<ol start="4">
<li><font style="color:rgb(31, 35, 40);">用户输入用户名密码登录完成，完成认证授权</font></li>
<li><font style="color:rgb(31, 35, 40);">携带授权码重定向到云原生API网关并携带了state参数用于验证csrf cookie ，授权码用于交换token</font></li>
</ol>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">curl --url "http://foo.bar.com/oauth2/callback" \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">  </span></span><span style="--0:#e1e4e8">--url-query "state=nT06xdCqn4IqemzBRV5hmO73U_hCjskrH_VupPqdcdw%3A%2Ffoo" \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">  </span></span><span style="--0:#e1e4e8">--url-query "code=0bdopoS2c2lx95u7iO0OH9kY1TvaEdJHo4lB6CT2_qVFm"</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="curl --url &#x22;http://foo.bar.com/oauth2/callback&#x22; \  --url-query &#x22;state=nT06xdCqn4IqemzBRV5hmO73U_hCjskrH_VupPqdcdw%3A%2Ffoo&#x22; \  --url-query &#x22;code=0bdopoS2c2lx95u7iO0OH9kY1TvaEdJHo4lB6CT2_qVFm&#x22;"><div></div></button></div></figure></div>
<ol start="6">
<li><font style="color:rgb(31, 35, 40);">校验 csrf cookie 中加密存储的 state 值与 url 参数中的 state 值必须相同</font></li>
<li><font style="color:rgb(31, 35, 40);">利用授权码，请求身份提供商（IDP）交换id_token 和 access_token、refresh_token</font></li>
</ol>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">curl -X POST \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">  </span></span><span style="--0:#e1e4e8">--url "https://dev-o43xb1mz7ya7ach4.us.auth0.com/oauth/token" \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">  </span></span><span style="--0:#e1e4e8">--data "grant_type=authorization_code" \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">  </span></span><span style="--0:#e1e4e8">--data "client_id=YagFqRD9tfNIaac5BamjhsSatjrAnsnZ" \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">  </span></span><span style="--0:#e1e4e8">--data "client_secret=ekqv5XoZuMFtYms1NszEqRx03qct6BPvGeJUeptNG4y09PrY16BKT9IWezTrrhJJ" \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">  </span></span><span style="--0:#e1e4e8">--data "redirect_uri=http%3A%2F%2Ffoo.bar.com%2Foauth2%2Fcallback" \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">  </span></span><span style="--0:#e1e4e8">--data "code=0bdopoS2c2lx95u7iO0OH9kY1TvaEdJHo4lB6CT2_qVFm" \</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="curl -X POST \  --url &#x22;https://dev-o43xb1mz7ya7ach4.us.auth0.com/oauth/token&#x22; \  --data &#x22;grant_type=authorization_code&#x22; \  --data &#x22;client_id=YagFqRD9tfNIaac5BamjhsSatjrAnsnZ&#x22; \  --data &#x22;client_secret=ekqv5XoZuMFtYms1NszEqRx03qct6BPvGeJUeptNG4y09PrY16BKT9IWezTrrhJJ&#x22; \  --data &#x22;redirect_uri=http%3A%2F%2Ffoo.bar.com%2Foauth2%2Fcallback&#x22; \  --data &#x22;code=0bdopoS2c2lx95u7iO0OH9kY1TvaEdJHo4lB6CT2_qVFm&#x22; \"><div></div></button></div></figure></div>
<p><font style="color:rgb(31, 35, 40);">返回的请求里包含了 id_token, access_token，refresh_token 用于后续刷新 token</font></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">    </span></span><span style="--0:#e1e4e8">"access_token": "eyJhbGciOiJkaXIiLCJlbmMiOiJBMjU2R0NNIiwiaXNzIjoiaHR0cHM6Ly9kZXYtbzQzeGIxbXo3eWE3YWNoNC51cy5hdXRoMC5jb20vIn0..WP_WRVM-y3fM1sN4.fAQqtKoKZNG9Wj0OhtrMgtsjTJ2J72M2klDRd9SvUKGbiYsZNPmIl_qJUf81D3VIjD59o9xrOOJIzXTgsfFVA2x15g-jBlNh68N7dyhXu9237Tbplweu1jA25IZDSnjitQ3pbf7xJVIfPnWcrzl6uT8G1EP-omFcl6AQprV2FoKFMCGFCgeafuttppKe1a8mpJDj7AFLPs-344tT9mvCWmI4DuoLFh0PiqMMJBByoijRSxcSdXLPxZng84j8JVF7H6mFa-dj-icP-KLy6yvzEaRKz_uwBzQCzgYK434LIpqw_PRuN3ClEsenwRgIsNdVjvKcoAysfoZhmRy9BQaE0I7qTohSBFNX6A.mgGGeeWgugfXcUcsX4T5dQ",</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">    </span></span><span style="--0:#e1e4e8">"refresh_token": "GrZ1f2JvzjAZQzSXmyr1ScWbv8aMFBvzAXHBUSiILcDEG",</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">    </span></span><span style="--0:#e1e4e8">"id_token": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6Imc1Z1ExSF9ZbTY0WUlvVkQwSVpXTCJ9.eyJlbWFpbCI6IjE2MDExNTYyNjhAcXEuY29tIiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJpc3MiOiJodHRwczovL2Rldi1vNDN4YjFtejd5YTdhY2g0LnVzLmF1dGgwLmNvbS8iLCJhdWQiOiJZYWdGcVJEOXRmTklhYWM1QmFtamhzU2F0anJBbnNuWiIsImlhdCI6MTcxOTE5ODYzOCwiZXhwIjoxNzE5MjM0NjM4LCJzdWIiOiJhdXRoMHw2NjVkNzFlNzRjMTMxMTc3YmU2NmU2MDciLCJzaWQiOiJjdDJVOF9ZUS16VDdFOGkwRTNNeUstejc5ZGlWUWhhVSJ9.gfzXKJ0FeqzYqOUDLQHWcUG19IOLqkpLN09xTmIat0umrlGV5VNSumgWH3XJmmwnhdb8AThH3Jf-7kbRJzu4rM-BbGbFTRBTzNHeUajFOFrIgld5VENQ_M_sXHkTp0psWKSr9vF24kmilCfSbvC5lBKjt878ljZ7-xteWuaUYOMUdcJb4DSv0-zjX01sonJxYamTlhji3M4TAW7VwhwqyZt8dBhVSNaRw1wUKj-M1JrBDLyx65sroZtSqVA0udIrqMHEbWYb2de7JjzlqG003HRMzwOm7OXgEd5ZVFqgmBLosgixOU5DJ4A26nlqK92Sp6VqDMRvA-3ym8W_m-wJ_A",</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">    </span></span><span style="--0:#e1e4e8">"scope": "openid email offline_access",</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">    </span></span><span style="--0:#e1e4e8">"expires_in": 86400,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">    </span></span><span style="--0:#e1e4e8">"token_type": "Bearer"</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="{    &#x22;access_token&#x22;: &#x22;eyJhbGciOiJkaXIiLCJlbmMiOiJBMjU2R0NNIiwiaXNzIjoiaHR0cHM6Ly9kZXYtbzQzeGIxbXo3eWE3YWNoNC51cy5hdXRoMC5jb20vIn0..WP_WRVM-y3fM1sN4.fAQqtKoKZNG9Wj0OhtrMgtsjTJ2J72M2klDRd9SvUKGbiYsZNPmIl_qJUf81D3VIjD59o9xrOOJIzXTgsfFVA2x15g-jBlNh68N7dyhXu9237Tbplweu1jA25IZDSnjitQ3pbf7xJVIfPnWcrzl6uT8G1EP-omFcl6AQprV2FoKFMCGFCgeafuttppKe1a8mpJDj7AFLPs-344tT9mvCWmI4DuoLFh0PiqMMJBByoijRSxcSdXLPxZng84j8JVF7H6mFa-dj-icP-KLy6yvzEaRKz_uwBzQCzgYK434LIpqw_PRuN3ClEsenwRgIsNdVjvKcoAysfoZhmRy9BQaE0I7qTohSBFNX6A.mgGGeeWgugfXcUcsX4T5dQ&#x22;,    &#x22;refresh_token&#x22;: &#x22;GrZ1f2JvzjAZQzSXmyr1ScWbv8aMFBvzAXHBUSiILcDEG&#x22;,    &#x22;id_token&#x22;: &#x22;eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6Imc1Z1ExSF9ZbTY0WUlvVkQwSVpXTCJ9.eyJlbWFpbCI6IjE2MDExNTYyNjhAcXEuY29tIiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJpc3MiOiJodHRwczovL2Rldi1vNDN4YjFtejd5YTdhY2g0LnVzLmF1dGgwLmNvbS8iLCJhdWQiOiJZYWdGcVJEOXRmTklhYWM1QmFtamhzU2F0anJBbnNuWiIsImlhdCI6MTcxOTE5ODYzOCwiZXhwIjoxNzE5MjM0NjM4LCJzdWIiOiJhdXRoMHw2NjVkNzFlNzRjMTMxMTc3YmU2NmU2MDciLCJzaWQiOiJjdDJVOF9ZUS16VDdFOGkwRTNNeUstejc5ZGlWUWhhVSJ9.gfzXKJ0FeqzYqOUDLQHWcUG19IOLqkpLN09xTmIat0umrlGV5VNSumgWH3XJmmwnhdb8AThH3Jf-7kbRJzu4rM-BbGbFTRBTzNHeUajFOFrIgld5VENQ_M_sXHkTp0psWKSr9vF24kmilCfSbvC5lBKjt878ljZ7-xteWuaUYOMUdcJb4DSv0-zjX01sonJxYamTlhji3M4TAW7VwhwqyZt8dBhVSNaRw1wUKj-M1JrBDLyx65sroZtSqVA0udIrqMHEbWYb2de7JjzlqG003HRMzwOm7OXgEd5ZVFqgmBLosgixOU5DJ4A26nlqK92Sp6VqDMRvA-3ym8W_m-wJ_A&#x22;,    &#x22;scope&#x22;: &#x22;openid email offline_access&#x22;,    &#x22;expires_in&#x22;: 86400,    &#x22;token_type&#x22;: &#x22;Bearer&#x22;}"><div></div></button></div></figure></div>
<ol start="8">
<li><font style="color:rgb(31, 35, 40);">网关将获得的 id_token, access_token, refresh_token加密存储在cookie _oauth2_proxy中</font></li>
<li><font style="color:rgb(31, 35, 40);">重定向到用户访问的后端服务并设置 cookie，用于后续用户登录状态的验证，同时清除csrf防护中设置的cookie _oauth2_proxy_csrf</font></li>
</ol>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">"Set-Cookie": [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">    </span></span><span style="--0:#e1e4e8">"_oauth2_proxy_csrf=; Path=/; Expires=Mon, 24 Jun 2024 02:17:39 GMT; HttpOnly",</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">    </span></span><span style="--0:#e1e4e8">"_oauth2_proxy=8zM_Pcfpp_gesKFe4SMg08o5Iv0A8WAOQOmG1-vZBbQ56UggYVC0Cu-gFMEoxJZU5q1O5vqRlVBizlLetgVjRCksGVbttwl8tQ7h5YiyIubbbtvF1T4JzLh3QfzUUrwbB-VznOkh8qLbjAhddocecjBt4rMiDyceKXqMr4eO5TUEMx4vHtJYnTYalMeTYhGXk5MNSyrdZX9NnQnkdrCjiOQM13ggwob2nYwhGWaAlgzFSWkgkdtBy2Cl_YMWZ8_gKk9rDX289-JrJyGpr5k9O9RzRhZoY2iE3Mcr8-Q37RTji1Ga22QO-XkAcSaGqY1Qo7jLdmgZTYKC5JvtdLc4rj3vcbveYxU7R3Pt2vEribQjKTh4Sqb0aA03p4cxXyZN4SUfBW1NAOm4JLPUhKJy8frqC9_E0nVqPvpvnacaoQs8WkX2zp75xHoMa3SD6KZhQ5JUiPEiNkOaUsyafLvht6lLkNDhgzW3BP2czoe0DCDBLnsot0jH-qQpMZYkaGr-ZnRKI1OPl1vHls3mao5juOAW1VB2A9aughgc8SJ55IFZpMfFMdHdTDdMqPODkItX2PK44GX-pHeLxkOqrzp3GHtMInpL5QIQlTuux3erm3CG-ntlUE7JBtN2T9LEb8XfIFu58X9_vzMun4JQlje2Thi9_taI_z1DSaTtvNNb54wJfSPwYCCl4OsH-BacVmPQhH6TTZ6gP2Qsm5TR2o1U2D9fuVkSM-OPCG9l3tILambIQwC3vofMW6X8SIFSmhJUDvN7NbwxowBiZ6Y7GJRZlAk_GKDkpsdrdIvC67QqczZFphRVnm6qi-gPO41APCbcO6fgTwyOhbP3RrZZKWSIqWJYhNE3_Sfkf0565H7sC7Hc8XUUjJvP3WnjKS9x7KwzWa-dsUjV3-Q-VNl-rXTguVNAIirYK-qrMNMZGCRcJqcLnUF0V_J2lVmFyVsSlE3t0sDw2xmbkOwDptXFOjQL5Rb4esUMYdCBWFajBfvUtcZEFtYhD0kb6VcbjXO3NCVW5qKh_l9C9SRCc7TG1vcRAqUQlRXHacTGWfcWsuQkCJ3Mp_oWaDxs1GRDykQYxAn5sTICovThWEU2C6o75grWaNrkj5NU-0eHh3ryvxLmGLBOXZV9OQhtKShWmUgywSWMxOHOuZAqdAPULc8KheuGFjXYp-RnCbFYWePJmwzfQw89kSkj1KUZgMYwKEjSz62z2qc9KLczomv76ortQzvo4Hv9kaW6xVuQj5R5Oq6_WMBOqsmUMzcXpxCIOGjcdcZRBc0Fm09Uy9oV1PRqvAE4PGtfyrCaoqILBix8UIww63B07YGwzQ-hAXDysBK-Vca2x7GmGdXsNXXcTgu00bdsjtHZPDBBWGfL3g_rMAXr2vWyvK4CwNjcaPAmrlF3geHPwbIePT0hskBboX1v1bsuhzsai7rGM4r53pnb1ZEoTQDa1B-HyokFgo14XiwME0zE1ifpNzefjpkz1YY2krJlqfCydNwoKaTit4tD2yHlnxAeFF9iIrxzSKErNUFpmyLa7ge7V33vhEH-6k5oBTLE2Q2BrC6aAkLCcPwU9xv_SzBDQPRY0MEYv3kGF03Swo1crRbGh-aifYX9NiHDsmG6r1vAnx0MAOw2Jzuz2x6SSdfBrzlcoWBlrwiZzd9kAKq75n1Uy9uzZ8SRnkBrEZySHBwEbu196VklkRE0jqwC-e3wWNNuviSOfwkVeX-7QdOoO10yw9VK2sW52lFvIEf4chv_ta7bGfAZOWBjpktG6ZLD81SE6A88zpqG2SysSyNMp9hl-umG-5sFsjCn_c9E8bDvwkUOUVb9bNqhBDsZgR0BNPawiOZjmyfhzmwmWf-zgFzfFSV6BvOwNRi3sCOHTsWcuk9NBQ_YK8CpNkVl3WeIBSDfidimuC_QV9UWKs1GPk35ZRkM4zKtLY2JsBFWKaDy_P80TcOzcMBoP8gIBClXZ-WUqfE8s1yyc4jrq-qL1_wJ24ef1O9FktsbyZiDKXw2vnqsT8-g_hCeG-unrT1ZFscf8oNdqczARHX-K4vKH2k3uIqEx1M=|1719199056|2rsgdUIClHNEpxBLlHOVRYup6e4oKensQfljtmn4B80=; Path=/; Expires=Mon, 01 Jul 2024 03:17:36 GMT; HttpOnly"</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">]</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="&#x22;Set-Cookie&#x22;: [    &#x22;_oauth2_proxy_csrf=; Path=/; Expires=Mon, 24 Jun 2024 02:17:39 GMT; HttpOnly&#x22;,    &#x22;_oauth2_proxy=8zM_Pcfpp_gesKFe4SMg08o5Iv0A8WAOQOmG1-vZBbQ56UggYVC0Cu-gFMEoxJZU5q1O5vqRlVBizlLetgVjRCksGVbttwl8tQ7h5YiyIubbbtvF1T4JzLh3QfzUUrwbB-VznOkh8qLbjAhddocecjBt4rMiDyceKXqMr4eO5TUEMx4vHtJYnTYalMeTYhGXk5MNSyrdZX9NnQnkdrCjiOQM13ggwob2nYwhGWaAlgzFSWkgkdtBy2Cl_YMWZ8_gKk9rDX289-JrJyGpr5k9O9RzRhZoY2iE3Mcr8-Q37RTji1Ga22QO-XkAcSaGqY1Qo7jLdmgZTYKC5JvtdLc4rj3vcbveYxU7R3Pt2vEribQjKTh4Sqb0aA03p4cxXyZN4SUfBW1NAOm4JLPUhKJy8frqC9_E0nVqPvpvnacaoQs8WkX2zp75xHoMa3SD6KZhQ5JUiPEiNkOaUsyafLvht6lLkNDhgzW3BP2czoe0DCDBLnsot0jH-qQpMZYkaGr-ZnRKI1OPl1vHls3mao5juOAW1VB2A9aughgc8SJ55IFZpMfFMdHdTDdMqPODkItX2PK44GX-pHeLxkOqrzp3GHtMInpL5QIQlTuux3erm3CG-ntlUE7JBtN2T9LEb8XfIFu58X9_vzMun4JQlje2Thi9_taI_z1DSaTtvNNb54wJfSPwYCCl4OsH-BacVmPQhH6TTZ6gP2Qsm5TR2o1U2D9fuVkSM-OPCG9l3tILambIQwC3vofMW6X8SIFSmhJUDvN7NbwxowBiZ6Y7GJRZlAk_GKDkpsdrdIvC67QqczZFphRVnm6qi-gPO41APCbcO6fgTwyOhbP3RrZZKWSIqWJYhNE3_Sfkf0565H7sC7Hc8XUUjJvP3WnjKS9x7KwzWa-dsUjV3-Q-VNl-rXTguVNAIirYK-qrMNMZGCRcJqcLnUF0V_J2lVmFyVsSlE3t0sDw2xmbkOwDptXFOjQL5Rb4esUMYdCBWFajBfvUtcZEFtYhD0kb6VcbjXO3NCVW5qKh_l9C9SRCc7TG1vcRAqUQlRXHacTGWfcWsuQkCJ3Mp_oWaDxs1GRDykQYxAn5sTICovThWEU2C6o75grWaNrkj5NU-0eHh3ryvxLmGLBOXZV9OQhtKShWmUgywSWMxOHOuZAqdAPULc8KheuGFjXYp-RnCbFYWePJmwzfQw89kSkj1KUZgMYwKEjSz62z2qc9KLczomv76ortQzvo4Hv9kaW6xVuQj5R5Oq6_WMBOqsmUMzcXpxCIOGjcdcZRBc0Fm09Uy9oV1PRqvAE4PGtfyrCaoqILBix8UIww63B07YGwzQ-hAXDysBK-Vca2x7GmGdXsNXXcTgu00bdsjtHZPDBBWGfL3g_rMAXr2vWyvK4CwNjcaPAmrlF3geHPwbIePT0hskBboX1v1bsuhzsai7rGM4r53pnb1ZEoTQDa1B-HyokFgo14XiwME0zE1ifpNzefjpkz1YY2krJlqfCydNwoKaTit4tD2yHlnxAeFF9iIrxzSKErNUFpmyLa7ge7V33vhEH-6k5oBTLE2Q2BrC6aAkLCcPwU9xv_SzBDQPRY0MEYv3kGF03Swo1crRbGh-aifYX9NiHDsmG6r1vAnx0MAOw2Jzuz2x6SSdfBrzlcoWBlrwiZzd9kAKq75n1Uy9uzZ8SRnkBrEZySHBwEbu196VklkRE0jqwC-e3wWNNuviSOfwkVeX-7QdOoO10yw9VK2sW52lFvIEf4chv_ta7bGfAZOWBjpktG6ZLD81SE6A88zpqG2SysSyNMp9hl-umG-5sFsjCn_c9E8bDvwkUOUVb9bNqhBDsZgR0BNPawiOZjmyfhzmwmWf-zgFzfFSV6BvOwNRi3sCOHTsWcuk9NBQ_YK8CpNkVl3WeIBSDfidimuC_QV9UWKs1GPk35ZRkM4zKtLY2JsBFWKaDy_P80TcOzcMBoP8gIBClXZ-WUqfE8s1yyc4jrq-qL1_wJ24ef1O9FktsbyZiDKXw2vnqsT8-g_hCeG-unrT1ZFscf8oNdqczARHX-K4vKH2k3uIqEx1M=|1719199056|2rsgdUIClHNEpxBLlHOVRYup6e4oKensQfljtmn4B80=; Path=/; Expires=Mon, 01 Jul 2024 03:17:36 GMT; HttpOnly&#x22;]"><div></div></button></div></figure></div>
<ol start="10">
<li><font style="color:rgb(31, 35, 40);">校验是否存在此cookie，并且cookie中存储了用户的 token信息同时查看是否过期</font></li>
<li><font style="color:rgb(31, 35, 40);">使用含有 Authorization 头部存储用户的 access_token 访问相应的 API</font></li>
</ol>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">curl --url "foo.bar.com/headers"</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">  </span></span><span style="--0:#e1e4e8">--header "Authorization: Bearer eyJhbGciOiJkaXIiLCJlbmMiOiJBMjU2R0NNIiwiaXNzIjoiaHR0cHM6Ly9kZXYtbzQzeGIxbXo3eWE3YWNoNC51cy5hdXRoMC5jb20vIn0..WP_WRVM-y3fM1sN4.fAQqtKoKZNG9Wj0OhtrMgtsjTJ2J72M2klDRd9SvUKGbiYsZNPmIl_qJUf81D3VIjD59o9xrOOJIzXTgsfFVA2x15g-jBlNh68N7dyhXu9237Tbplweu1jA25IZDSnjitQ3pbf7xJVIfPnWcrzl6uT8G1EP-omFcl6AQprV2FoKFMCGFCgeafuttppKe1a8mpJDj7AFLPs-344tT9mvCWmI4DuoLFh0PiqMMJBByoijRSxcSdXLPxZng84j8JVF7H6mFa-dj-icP-KLy6yvzEaRKz_uwBzQCzgYK434LIpqw_PRuN3ClEsenwRgIsNdVjvKcoAysfoZhmRy9BQaE0I7qTohSBFNX6A.mgGGeeWgugfXcUcsX4T5dQ"</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="curl --url &#x22;foo.bar.com/headers&#x22;  --header &#x22;Authorization: Bearer eyJhbGciOiJkaXIiLCJlbmMiOiJBMjU2R0NNIiwiaXNzIjoiaHR0cHM6Ly9kZXYtbzQzeGIxbXo3eWE3YWNoNC51cy5hdXRoMC5jb20vIn0..WP_WRVM-y3fM1sN4.fAQqtKoKZNG9Wj0OhtrMgtsjTJ2J72M2klDRd9SvUKGbiYsZNPmIl_qJUf81D3VIjD59o9xrOOJIzXTgsfFVA2x15g-jBlNh68N7dyhXu9237Tbplweu1jA25IZDSnjitQ3pbf7xJVIfPnWcrzl6uT8G1EP-omFcl6AQprV2FoKFMCGFCgeafuttppKe1a8mpJDj7AFLPs-344tT9mvCWmI4DuoLFh0PiqMMJBByoijRSxcSdXLPxZng84j8JVF7H6mFa-dj-icP-KLy6yvzEaRKz_uwBzQCzgYK434LIpqw_PRuN3ClEsenwRgIsNdVjvKcoAysfoZhmRy9BQaE0I7qTohSBFNX6A.mgGGeeWgugfXcUcsX4T5dQ&#x22;"><div></div></button></div></figure></div>
<ol start="12">
<li><font style="color:rgb(31, 35, 40);">后端服务根据 access_token 获取用户授权信息并返回对应的 HTTP 响应</font></li>
</ol>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">    </span></span><span style="--0:#e1e4e8">"email": "******",</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">    </span></span><span style="--0:#e1e4e8">"email_verified": false,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">    </span></span><span style="--0:#e1e4e8">"iss": "https://dev-o43xb1mz7ya7ach4.us.auth0.com/",</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">    </span></span><span style="--0:#e1e4e8">"aud": "YagFqRD9tfNIaac5BamjhsSatjrAnsnZ",</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">    </span></span><span style="--0:#e1e4e8">"iat": 1719198638,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">    </span></span><span style="--0:#e1e4e8">"exp": 1719234638,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">    </span></span><span style="--0:#e1e4e8">"sub": "auth0|665d71e74c131177be66e607",</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">    </span></span><span style="--0:#e1e4e8">"sid": "ct2U8_YQ-zT7E8i0E3MyK-z79diVQhaU"</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="{    &#x22;email&#x22;: &#x22;******&#x22;,    &#x22;email_verified&#x22;: false,    &#x22;iss&#x22;: &#x22;https://dev-o43xb1mz7ya7ach4.us.auth0.com/&#x22;,    &#x22;aud&#x22;: &#x22;YagFqRD9tfNIaac5BamjhsSatjrAnsnZ&#x22;,    &#x22;iat&#x22;: 1719198638,    &#x22;exp&#x22;: 1719234638,    &#x22;sub&#x22;: &#x22;auth0|665d71e74c131177be66e607&#x22;,    &#x22;sid&#x22;: &#x22;ct2U8_YQ-zT7E8i0E3MyK-z79diVQhaU&#x22;}"><div></div></button></div></figure></div>
<h5 id="用户令牌刷新"><font style="color:rgb(31, 35, 40);">用户令牌刷新</font></h5>
<p><a href="https://aliyuque.antfin.com/senming.gsm/zu4skz/mvwulm5oghbkuq8r?inner=MEqLG" referrerpolicy="unsafe-url" rel="nofollow" target="_blank">云原生 API 网关- API 安全之认证鉴权</a></p>
<ol>
<li><font style="color:rgb(31, 35, 40);">访问用户受保护的资源（需要认证授权访问的API）</font></li>
</ol>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">curl --url "foo.bar.com/headers"</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="curl --url &#x22;foo.bar.com/headers&#x22;"><div></div></button></div></figure></div>
<ol start="2">
<li><font style="color:rgb(31, 35, 40);">检查AccessToken 令牌的过期时间，如果过期或者即将过期，请求刷新令牌</font></li>
<li><font style="color:rgb(31, 35, 40);">如果在 cookie 中检测到存在 refresh_token，则可以访问相应的接口以交换新的 id_token，access_token</font></li>
</ol>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8">curl -X POST \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">  </span></span><span style="--0:#e1e4e8">--url "https://dev-o43xb1mz7ya7ach4.us.auth0.com/oauth/token" \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">  </span></span><span style="--0:#e1e4e8">--data "grant_type=refresh_token" \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">  </span></span><span style="--0:#e1e4e8">--data "client_id=YagFqRD9tfNIaac5BamjhsSatjrAnsnZ" \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">  </span></span><span style="--0:#e1e4e8">--data "client_secret=ekqv5XoZuMFtYms1NszEqRx03qct6BPvGeJUeptNG4y09PrY16BKT9IWezTrrhJJ" \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8">  </span></span><span style="--0:#e1e4e8">--data "refresh_token=GrZ1f2JvzjAZQzSXmyr1ScWbv8aMFBvzAXHBUSiILcDEG"</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="curl -X POST \  --url &#x22;https://dev-o43xb1mz7ya7ach4.us.auth0.com/oauth/token&#x22; \  --data &#x22;grant_type=refresh_token&#x22; \  --data &#x22;client_id=YagFqRD9tfNIaac5BamjhsSatjrAnsnZ&#x22; \  --data &#x22;client_secret=ekqv5XoZuMFtYms1NszEqRx03qct6BPvGeJUeptNG4y09PrY16BKT9IWezTrrhJJ&#x22; \  --data &#x22;refresh_token=GrZ1f2JvzjAZQzSXmyr1ScWbv8aMFBvzAXHBUSiILcDEG&#x22;"><div></div></button></div></figure></div>
<ol start="4">
<li><font style="color:rgb(31, 35, 40);">更新会话，并存储新的令牌</font></li>
<li><font style="color:rgb(31, 35, 40);">携带 Authorization标头并使用新的access_token访问对应 API</font></li>
<li><font style="color:rgb(31, 35, 40);">后端服务根据 access_token 获取用户授权信息并返回对应的 HTTP 响应</font></li>
</ol>
<h2 id="云原生网关中的认证鉴权能力">云原生网关中的认证鉴权能力</h2>
<p>云原生API网关支持以下三类认证鉴权的方式，用户可以按照自己的业务场景选择适合的认证类型和方式</p>



































<table><thead><tr><th align="left"><strong><font style="color:rgb(24, 24, 24);">对比项</font></strong></th><th><strong><font style="color:rgb(24, 24, 24);">消费者认证鉴权</font></strong></th><th><strong><font style="color:rgb(24, 24, 24);">全局认证鉴权</font></strong></th><th><strong><font style="color:rgb(24, 24, 24);">插件认证鉴权</font></strong></th></tr></thead><tbody><tr><td align="left"><strong><font style="color:rgb(24, 24, 24);">支持的认证方式</font></strong></td><td>API Key认证、AKSK认证、JWT认证</td><td>JWT认证、OIDC认证、自定义认证</td><td>Baisc认证、Key认证、JWT认证、HMAC认证、自定义外部认证</td></tr><tr><td align="left"><strong><font style="color:rgb(24, 24, 24);">鉴权方式</font></strong></td><td>鉴权方式：可以自行配置到以下粒度的授权，网关按配置的授权粒度严格鉴权<br>1、REST <font style="color:rgb(24, 24, 24);">API</font><br>2、REST <font style="color:rgb(24, 24, 24);">API</font> 接口<br>3、HTTP API/WebSocket API 路由</td><td>鉴权方式：默认网关级别，不可以调整，通过认证即通过鉴权<br>黑白名单：<br>1、支持认证配置黑白名单<br>2、黑白名单支持配置到路由、域名<br><strong><font style="color:rgb(24, 24, 24);">黑名单模式</font></strong><font style="color:rgb(24, 24, 24);">：配置的</font><strong><font style="color:rgb(24, 24, 24);">域名</font></strong><font style="color:rgb(24, 24, 24);">和</font><strong><font style="color:rgb(24, 24, 24);">路由</font></strong><font style="color:rgb(24, 24, 24);">需要进行认证，其余无需认证可直接访问。</font><br><strong><font style="color:rgb(24, 24, 24);">白名单模式</font></strong><font style="color:rgb(24, 24, 24);">：配置的</font><strong><font style="color:rgb(24, 24, 24);">域名</font></strong><font style="color:rgb(24, 24, 24);">和</font><strong><font style="color:rgb(24, 24, 24);">路由</font></strong><font style="color:rgb(24, 24, 24);">不需要认证即可访问，其余需要进行认证。</font><br><font style="color:rgb(24, 24, 24);">自建鉴权服务：</font><br><font style="color:rgb(24, 24, 24);">客户自定义完成认证鉴权</font></td><td>鉴权方式：可以自行配置到以下粒度的授权，网关按配置的授权粒度严格鉴权<br>1、网关实例<br>2、部署到网关的域名<br>3、REST <font style="color:rgb(24, 24, 24);">API</font><br>4、REST <font style="color:rgb(24, 24, 24);">API接口</font><br>5、HTTP API/WebSocket API 路由</td></tr><tr><td align="left"><strong><font style="color:rgb(24, 24, 24);">操作路径</font></strong></td><td><strong>开启认证：</strong><br><font style="color:rgb(24, 24, 24);">1、API列表 ->HTTP API或者/WebScoket API ->路由管理->策略配置->添加并开启消费者认证策略。</font><br><font style="color:rgb(24, 24, 24);">2、API管理 > REST-API </font><br><strong>开启鉴权：</strong><br><font style="color:rgb(24, 24, 24);">1、消费者-> 消费者详情 -> 消费者鉴权-> 添加授权</font><br><font style="color:rgb(24, 24, 24);">2、接口详情 -> 消费者认证->授权给消费者</font></td><td><strong>开启认证鉴权：</strong><br><font style="color:rgb(24, 24, 24);">实例 > 安全管理 > 全局认证鉴权</font></td><td><strong>开启认证鉴权：</strong><br>1、插件->安装插件到网关->插件配置<br>实例->已安装插件->插件配置<br>2、配置不同粒度的在插件规则，并配置授权关系<br>3、启用需要的插件规则</td></tr><tr><td align="left"><strong>优缺点</strong></td><td><strong>优点：</strong><br>1、支持常见的API Key认证、AK/SK认证、JWT认证并随着产品迭代不断扩展（长期发展的方向）<br>2、白屏管理能力，包括凭证管理（重置、汰换、删除），权限管理<br>3、灵活的授权粒度和授权方式<br>4、网关实现认证鉴权，客户不需要自建认证鉴权服务<br></td><td><strong>优点：</strong><br>1、配置简单，认证授权全局统一控制，不需要按服务实现多次<br>2、支持路由和域名级别的黑白名单配置，用户可以按域名和路由放过和拦截请求<br><strong>缺点：</strong><br>1、需要客户自建认证授权服务<br>2、不支持细粒度的授权规则</td><td><strong>优点：</strong><br>1、共享Higress社区插件生态，支持多样性的认证插件配置，并有计划性将社区的优先插件纳入到云原生API网关<br><strong>缺点：</strong><br>1、文本编辑插件规则的方式容易出错而影响线上流量<br>2、插件的种类多而且交互复杂，管理成本高</td></tr></tbody></table>
<h2 id="云原生api网关的其他安全能力"><font style="color:rgb(0, 0, 0);">云原生API网关的其他安全能力</font></h2>
<p><font style="color:rgb(51, 51, 51);">保护API安全，是云原生API网关作为接入层重要的能力，认证鉴权只是云原生API网关诸多安全能力中的一部分；云原生网关还提供下表中的多种安全能力，以便用户进一步维护企业API资产的安全</font></p>





























<table><thead><tr><th>模块</th><th>能力</th></tr></thead><tbody><tr><td>环境</td><td>1、支持基于环境的隔离访问，并匹配相应的环境域名</td></tr><tr><td>域名</td><td>1、支持HTTPS 域名使用指定加密套件</td></tr><tr><td>策略</td><td>1、<font style="color:rgb(51, 51, 51);">支持API级别、接口级别、路由级别的按QPS限流、按并发数限流、以及熔断策略</font><br><font style="color:rgb(51, 51, 51);">2、支持网关级别、域名级别、API级别、接口级别、路由级别的IP黑白名单 访问控制；</font><br>3、<font style="color:rgb(51, 51, 51);">支持API级别、接口级别、路由级别的跨域访问控制 CORS；</font><br>4、支持路由级别、网关级别的 且与Aliyun Web 应用防火墙深度集成的<font style="color:rgb(51, 51, 51);"> WAF防控</font></td></tr><tr><td>插件</td><td>1、支持丰富的认证鉴权插件能力<br>2、支持请求屏蔽插件，可以<font style="color:rgb(51, 51, 51);">基于 URL、请求头等特征屏蔽 HTTP 请求，可以用于防护部分站点资源不对外部暴露</font><br>3、支持机器人拦截插件，可以用于识别并阻止互联网爬虫对站点资源的爬取<br>4、支持WAF 防护插件<br>5、支持跨域资源共享插件<br>6、支持IP限制插件</td></tr><tr><td>服务</td><td>1、支持服务级别的TLS，MTLS</td></tr></tbody></table>  </div> </main> </div> </span> <div class="pb-6"> <div class="pagination-links astro-u2l5gyhi"> <a href="/blog/higress-gvr7dx_awbbpb_hwuzgkuzpuru076d/" rel="prev" class="astro-u2l5gyhi"> <svg aria-hidden="true" class="astro-u2l5gyhi astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.5rem;"><path d="M17 11H9.41l3.3-3.29a1.004 1.004 0 1 0-1.42-1.42l-5 5a1 1 0 0 0-.21.33 1 1 0 0 0 0 .76 1 1 0 0 0 .21.33l5 5a1.002 1.002 0 0 0 1.639-.325 1 1 0 0 0-.219-1.095L9.41 13H17a1 1 0 0 0 0-2Z"/></svg>  <span class="astro-u2l5gyhi"> 上一篇 <br class="astro-u2l5gyhi"> <span class="link-title astro-u2l5gyhi">大模型 Token 的消耗可能是一笔糊涂账</span> </span> </a> <a href="/blog/higress-gvr7dx_awbbpb_kbgwaftgw8315v0l/" rel="next" class="astro-u2l5gyhi"> <svg aria-hidden="true" class="astro-u2l5gyhi astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.5rem;"><path d="M17.92 11.62a1.001 1.001 0 0 0-.21-.33l-5-5a1.003 1.003 0 1 0-1.42 1.42l3.3 3.29H7a1 1 0 0 0 0 2h7.59l-3.3 3.29a1.002 1.002 0 0 0 .325 1.639 1 1 0 0 0 1.095-.219l5-5a1 1 0 0 0 .21-.33 1 1 0 0 0 0-.76Z"/></svg>  <span class="astro-u2l5gyhi"> 下一篇 <br class="astro-u2l5gyhi"> <span class="link-title astro-u2l5gyhi">大模型无缝切换，QwQ-32B 和 DeepSeek-R1  全都要</span> </span> </a> </div>  </div> </div> <div class="right-sidebar-panel fixed h-full hidden 2xl:inline-block xl:inline-block"> <div id="toggle-sidebar"> <span class="not-content"><a class="btn btn btn-secondary px-2 no-underline" id="toggle-btn"> <svg aria-hidden="true" class="right_caret text-lg align-middle rotate-180 astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </a></span> </div> <span class="toc-component-wrapper" style="--depth: 0;"> <markdown-toc data-min-h="1" data-max-h="4" class="isMobile" style="--depth: 0;"> <nav aria-labelledby="starlight__on-this-page" class="starlight__on-this-page" style="--depth: 0;"> <h2 id="starlight__on-this-page" class="heading" style="--depth: 0;"> 本页内容 </h2> <span class="table-of-contents-wrapper" style="--depth: 0;"> <ul style="--depth: 0;"> <li style="--depth: 0;"> <a href="#_top" class="py-1" style="--depth: 0;"> <span style="--depth: 0;">概述</span> </a>  </li><li style="--depth: 0;"> <a href="#前言" class="py-1" style="--depth: 0;"> <span style="--depth: 0;">前言</span> </a>  </li><li style="--depth: 0;"> <a href="#什么是认证鉴权" class="py-1" style="--depth: 0;"> <span style="--depth: 0;">什么是认证鉴权</span> </a>  </li><li style="--depth: 0;"> <a href="#认证authentication" class="py-1" style="--depth: 0;"> <span style="--depth: 0;">认证（Authentication）</span> </a> <span class="table-of-contents-wrapper" style="--depth: 1;"> <ul style="--depth: 1;"> <li style="--depth: 1;"> <a href="#key-认证" class="py-1" style="--depth: 1;"> <span style="--depth: 1;">Key 认证</span> </a> <span class="table-of-contents-wrapper" style="--depth: 2;"> <ul style="--depth: 2;"> <li style="--depth: 2;"> <a href="#优点" class="py-1" style="--depth: 2;"> <span style="--depth: 2;">优点：</span> </a>  </li><li style="--depth: 2;"> <a href="#缺点" class="py-1" style="--depth: 2;"> <span style="--depth: 2;">缺点：</span> </a>  </li><li style="--depth: 2;"> <a href="#api-key认证的基本流程" class="py-1" style="--depth: 2;"> <span style="--depth: 2;">Api Key认证的基本流程</span> </a>  </li> </ul> </span>  </li><li style="--depth: 1;"> <a href="#jwt-认证" class="py-1" style="--depth: 1;"> <span style="--depth: 1;">JWT 认证</span> </a> <span class="table-of-contents-wrapper" style="--depth: 2;"> <ul style="--depth: 2;"> <li style="--depth: 2;"> <a href="#什么是jwt" class="py-1" style="--depth: 2;"> <span style="--depth: 2;">什么是JWT</span> </a>  </li><li style="--depth: 2;"> <a href="#什么是jwks" class="py-1" style="--depth: 2;"> <span style="--depth: 2;">什么是JWKS</span> </a>  </li><li style="--depth: 2;"> <a href="#jwt-认证是云原生api网关消费者认证能力中的一种其认证流程如下" class="py-1" style="--depth: 2;"> <span style="--depth: 2;">JWT 认证是云原生API网关消费者认证能力中的一种，其认证流程如下：</span> </a>  </li><li style="--depth: 2;"> <a href="#注意事项" class="py-1" style="--depth: 2;"> <span style="--depth: 2;">注意事项：</span> </a>  </li> </ul> </span>  </li><li style="--depth: 1;"> <a href="#aksk-认证" class="py-1" style="--depth: 1;"> <span style="--depth: 1;">AK/SK 认证</span> </a> <span class="table-of-contents-wrapper" style="--depth: 2;"> <ul style="--depth: 2;"> <li style="--depth: 2;"> <a href="#akskhmac认证是云原生api网关消费者认证能力中的一种其认证流程包括客户端生成签名和服务端验证前面两个步骤" class="py-1" style="--depth: 2;"> <span style="--depth: 2;">AK/SK（HMAC）认证是云原生API网关消费者认证能力中的一种，其认证流程包括客户端生成签名和服务端验证前面两个步骤</span> </a> <span class="table-of-contents-wrapper" style="--depth: 3;"> <ul style="--depth: 3;"> <li style="--depth: 3;"> <a href="#客户端生成签名流程" class="py-1" style="--depth: 3;"> <span style="--depth: 3;">客户端生成签名流程：</span> </a>  </li><li style="--depth: 3;"> <a href="#网关验证签名流程图" class="py-1" style="--depth: 3;"> <span style="--depth: 3;">网关验证签名流程图：</span> </a>  </li> </ul> </span>  </li> </ul> </span>  </li><li style="--depth: 1;"> <a href="#oauth2认证" class="py-1" style="--depth: 1;"> <span style="--depth: 1;">OAuth2认证</span> </a> <span class="table-of-contents-wrapper" style="--depth: 2;"> <ul style="--depth: 2;"> <li style="--depth: 2;"> <a href="#什么是oauth-20" class="py-1" style="--depth: 2;"> <span style="--depth: 2;">什么是OAuth 2.0</span> </a>  </li><li style="--depth: 2;"> <a href="#oauth-20协议的流程主要包含以下几个步骤" class="py-1" style="--depth: 2;"> <span style="--depth: 2;">OAuth 2.0协议的流程主要包含以下几个步骤：</span> </a>  </li><li style="--depth: 2;"> <a href="#抽象流程图" class="py-1" style="--depth: 2;"> <span style="--depth: 2;">抽象流程图</span> </a>  </li><li style="--depth: 2;"> <a href="#oauth-20协议定义了4种授权模式" class="py-1" style="--depth: 2;"> <span style="--depth: 2;">OAuth 2.0协议定义了4种授权模式：</span> </a> <span class="table-of-contents-wrapper" style="--depth: 3;"> <ul style="--depth: 3;"> <li style="--depth: 3;"> <a href="#授权码模式" class="py-1" style="--depth: 3;"> <span style="--depth: 3;">授权码模式：</span> </a>  </li><li style="--depth: 3;"> <a href="#授权码授权流程图" class="py-1" style="--depth: 3;"> <span style="--depth: 3;">授权码授权流程图：</span> </a>  </li><li style="--depth: 3;"> <a href="#客户端模式" class="py-1" style="--depth: 3;"> <span style="--depth: 3;">客户端模式：</span> </a>  </li> </ul> </span>  </li> </ul> </span>  </li><li style="--depth: 1;"> <a href="#oidc-认证" class="py-1" style="--depth: 1;"> <span style="--depth: 1;">OIDC 认证</span> </a> <span class="table-of-contents-wrapper" style="--depth: 2;"> <ul style="--depth: 2;"> <li style="--depth: 2;"> <a href="#为什么要有oidc" class="py-1" style="--depth: 2;"> <span style="--depth: 2;">为什么要有OIDC</span> </a>  </li><li style="--depth: 2;"> <a href="#oidc-基于oauth-20协议实现的角色及关键资源定义" class="py-1" style="--depth: 2;"> <span style="--depth: 2;">OIDC 基于OAuth 2.0协议实现的角色及关键资源定义</span> </a>  </li><li style="--depth: 2;"> <a href="#oidc-认证-1" class="py-1" style="--depth: 2;"> <span style="--depth: 2;">OIDC 认证</span> </a> <span class="table-of-contents-wrapper" style="--depth: 3;"> <ul style="--depth: 3;"> <li style="--depth: 3;"> <a href="#oidc-认证详细流程" class="py-1" style="--depth: 3;"> <span style="--depth: 3;">OIDC 认证详细流程</span> </a>  </li><li style="--depth: 3;"> <a href="#用户令牌刷新" class="py-1" style="--depth: 3;"> <span style="--depth: 3;">用户令牌刷新</span> </a>  </li> </ul> </span>  </li> </ul> </span>  </li> </ul> </span>  </li><li style="--depth: 0;"> <a href="#云原生网关中的认证鉴权能力" class="py-1" style="--depth: 0;"> <span style="--depth: 0;">云原生网关中的认证鉴权能力</span> </a>  </li><li style="--depth: 0;"> <a href="#云原生api网关的其他安全能力" class="py-1" style="--depth: 0;"> <span style="--depth: 0;">云原生API网关的其他安全能力</span> </a>  </li> </ul> </span>  </nav> </markdown-toc> </span>   </div> </div>   </body> </html> </span>  