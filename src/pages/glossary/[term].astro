---
import SiteLayout from "../../layout/siteLayout.astro";
import { getGlossaryTerms, getGlossaryCategories, getTermById, getRelatedTerms } from "../../utils/glossaryData";

const locale = Astro.currentLocale || 'root';
const GLOSSARY_TERMS = getGlossaryTerms(locale);
const GLOSSARY_CATEGORIES = getGlossaryCategories(locale);

export function getStaticPaths() {
  // ä¸ºæ‰€æœ‰è¯­è¨€ç¯å¢ƒç”Ÿæˆè·¯å¾„
  const locales = ['root', 'en'];
  const paths: Array<{ params: { term: string }, props: { term: any, locale: string } }> = [];
  
  locales.forEach(loc => {
    const terms = getGlossaryTerms(loc);
    terms.forEach(term => {
      paths.push({
        params: { term: term.id },
        props: { term, locale: loc }
      });
    });
  });
  
  return paths;
}

const { term, locale: termLocale } = Astro.props;
const currentLocale = termLocale || locale;
const category = GLOSSARY_CATEGORIES.find(c => c.id === term.category);
const relatedTerms = getRelatedTerms(term.id, currentLocale);

const title = `${term.term} æ˜¯ä»€ä¹ˆï¼Ÿ- Higress æŠ€æœ¯è¯æ±‡è¡¨`;
const description = `${term.term}ï¼ˆ${term.termEn}ï¼‰çš„å®šä¹‰ã€ç¤ºä¾‹å’Œåœ¨ Higress AI ç½‘å…³ä¸­çš„åº”ç”¨ã€‚${term.definition.slice(0, 100)}...`;
const keywords = `${term.term},${term.termEn},${term.term}æ˜¯ä»€ä¹ˆ,${term.term}å®šä¹‰,Higress,AIç½‘å…³`;
---

<SiteLayout title={title} description={description} keywords={keywords}>
  <div class="bg-gradient-to-b from-gray-50 to-white min-h-screen">
    <!-- Breadcrumb -->
    <div class="bg-white border-b border-gray-200">
      <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
        <nav class="flex items-center text-sm text-gray-500">
          <a href="/" class="hover:text-primary transition">é¦–é¡µ</a>
          <svg class="h-4 w-4 mx-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
          <a href="/glossary/" class="hover:text-primary transition">æŠ€æœ¯è¯æ±‡è¡¨</a>
          <svg class="h-4 w-4 mx-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
          <span class="text-gray-900 font-medium">{term.term}</span>
        </nav>
      </div>
    </div>

    <!-- Main Content -->
    <article class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
      <!-- Header -->
      <header class="mb-12">
        <div class="flex items-center gap-3 mb-4">
          {category && (
            <a
              href={`/glossary/#${category.id}`}
              class="inline-flex items-center px-3 py-1 rounded-full bg-primary/10 text-primary text-sm font-medium hover:bg-primary/20 transition"
            >
              <span class="mr-1">{category.icon}</span>
              {category.name}
            </a>
          )}
        </div>
        <h1 class="text-4xl sm:text-5xl font-extrabold text-gray-900 mb-4">
          {term.term}
        </h1>
        <p class="text-xl text-gray-500">
          {term.termEn}
        </p>
      </header>

      <!-- Definition Section -->
      <section class="mb-12">
        <h2 class="text-2xl font-bold text-gray-900 mb-4 flex items-center">
          <span class="w-8 h-8 rounded-lg bg-primary/10 text-primary flex items-center justify-center mr-3 text-lg">ğŸ“–</span>
          å®šä¹‰
        </h2>
        <div class="bg-white rounded-xl border border-gray-200 p-6">
          <p class="text-lg text-gray-700 leading-relaxed">
            {term.definition}
          </p>
        </div>
      </section>

      <!-- Higress Relation Section -->
      <section class="mb-12">
        <h2 class="text-2xl font-bold text-gray-900 mb-4 flex items-center">
          <span class="w-8 h-8 rounded-lg bg-green-100 text-green-600 flex items-center justify-center mr-3 text-lg">ğŸ”—</span>
          åœ¨ Higress ä¸­çš„åº”ç”¨
        </h2>
        <div class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl border border-green-200 p-6">
          <p class="text-lg text-gray-700 leading-relaxed">
            {term.higressRelation}
          </p>
        </div>
      </section>

      <!-- Examples Section -->
      {term.examples && term.examples.length > 0 && (
        <section class="mb-12">
          <h2 class="text-2xl font-bold text-gray-900 mb-4 flex items-center">
            <span class="w-8 h-8 rounded-lg bg-blue-100 text-blue-600 flex items-center justify-center mr-3 text-lg">ğŸ’¡</span>
            ç¤ºä¾‹
          </h2>
          <div class="bg-white rounded-xl border border-gray-200 p-6">
            <ul class="space-y-4">
              {term.examples.map((example, index) => (
                <li class="flex items-start">
                  <span class="flex-shrink-0 w-6 h-6 rounded-full bg-blue-100 text-blue-600 text-sm font-medium flex items-center justify-center mr-3 mt-0.5">
                    {index + 1}
                  </span>
                  <span class="text-gray-700">{example}</span>
                </li>
              ))}
            </ul>
          </div>
        </section>
      )}

      <!-- Config Example Section -->
      {term.configExample && (
        <section class="mb-12">
          <h2 class="text-2xl font-bold text-gray-900 mb-4 flex items-center">
            <span class="w-8 h-8 rounded-lg bg-purple-100 text-purple-600 flex items-center justify-center mr-3 text-lg">âš™ï¸</span>
            é…ç½®ç¤ºä¾‹
          </h2>
          <div class="bg-gray-900 rounded-xl overflow-hidden">
            <div class="flex items-center justify-between px-4 py-2 bg-gray-800">
              <span class="text-gray-400 text-sm">YAML</span>
              <button
                class="copy-btn text-gray-400 hover:text-white text-sm transition"
                data-code={term.configExample}
              >
                å¤åˆ¶ä»£ç 
              </button>
            </div>
            <pre class="p-4 overflow-x-auto"><code class="text-gray-300 text-sm">{term.configExample}</code></pre>
          </div>
        </section>
      )}

      <!-- Related Terms Section -->
      {relatedTerms.length > 0 && (
        <section class="mb-12">
          <h2 class="text-2xl font-bold text-gray-900 mb-4 flex items-center">
            <span class="w-8 h-8 rounded-lg bg-orange-100 text-orange-600 flex items-center justify-center mr-3 text-lg">ğŸ”„</span>
            ç›¸å…³æœ¯è¯­
          </h2>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            {relatedTerms.map(related => (
              <a
                href={`/glossary/${related.id}/`}
                class="group bg-white rounded-xl border border-gray-200 p-4 hover:border-primary/30 hover:shadow-md transition-all"
              >
                <div class="flex items-center justify-between">
                  <div>
                    <h3 class="font-bold text-gray-900 group-hover:text-primary transition">
                      {related.term}
                    </h3>
                    <p class="text-sm text-gray-500">{related.termEn}</p>
                  </div>
                  <svg class="h-5 w-5 text-gray-400 group-hover:text-primary group-hover:translate-x-1 transition-all" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                  </svg>
                </div>
              </a>
            ))}
          </div>
        </section>
      )}

      <!-- FAQ Schema for SEO -->
      <section class="mb-12">
        <h2 class="text-2xl font-bold text-gray-900 mb-4 flex items-center">
          <span class="w-8 h-8 rounded-lg bg-yellow-100 text-yellow-600 flex items-center justify-center mr-3 text-lg">â“</span>
          å¸¸è§é—®é¢˜
        </h2>
        <div class="space-y-4">
          <details class="bg-white rounded-xl border border-gray-200 overflow-hidden group">
            <summary class="px-6 py-4 cursor-pointer flex items-center justify-between hover:bg-gray-50 transition">
              <span class="font-medium text-gray-900">{term.term} æ˜¯ä»€ä¹ˆï¼Ÿ</span>
              <svg class="h-5 w-5 text-gray-400 group-open:rotate-180 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
            </summary>
            <div class="px-6 pb-4 text-gray-600">
              {term.definition}
            </div>
          </details>

          <details class="bg-white rounded-xl border border-gray-200 overflow-hidden group">
            <summary class="px-6 py-4 cursor-pointer flex items-center justify-between hover:bg-gray-50 transition">
              <span class="font-medium text-gray-900">Higress å¦‚ä½•æ”¯æŒ {term.term}ï¼Ÿ</span>
              <svg class="h-5 w-5 text-gray-400 group-open:rotate-180 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
            </summary>
            <div class="px-6 pb-4 text-gray-600">
              {term.higressRelation}
            </div>
          </details>
        </div>
      </section>

      <!-- CTA Section -->
      <section class="bg-gradient-to-r from-primary/5 via-primary/10 to-primary/5 rounded-2xl p-8 text-center">
        <h2 class="text-2xl font-bold text-gray-900 mb-4">
          æ·±å…¥äº†è§£ Higress
        </h2>
        <p class="text-gray-600 mb-6">
          æ¢ç´¢æ›´å¤š Higress çš„åŠŸèƒ½å’Œæœ€ä½³å®è·µ
        </p>
        <div class="flex justify-center gap-4 flex-wrap">
          <a
            href="/docs/overview/what-is-higress/"
            class="px-6 py-2.5 bg-primary text-white font-medium rounded-lg hover:bg-primary/90 transition"
          >
            æŸ¥çœ‹æ–‡æ¡£
          </a>
          <a
            href="/glossary/"
            class="px-6 py-2.5 bg-white text-gray-700 font-medium rounded-lg border border-gray-300 hover:border-primary hover:text-primary transition"
          >
            æµè§ˆæ›´å¤šæœ¯è¯­
          </a>
        </div>
      </section>
    </article>
  </div>
</SiteLayout>

<!-- Structured Data for SEO -->
<script type="application/ld+json" set:html={JSON.stringify({
  "@context": "https://schema.org",
  "@type": "DefinedTerm",
  "name": term.term,
  "description": term.definition,
  "inDefinedTermSet": {
    "@type": "DefinedTermSet",
    "name": "Higress æŠ€æœ¯è¯æ±‡è¡¨",
    "url": "https://higress.ai/glossary/"
  }
})} />

<script type="application/ld+json" set:html={JSON.stringify({
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": `${term.term} æ˜¯ä»€ä¹ˆï¼Ÿ`,
      "acceptedAnswer": {
        "@type": "Answer",
        "text": term.definition
      }
    },
    {
      "@type": "Question",
      "name": `Higress å¦‚ä½•æ”¯æŒ ${term.term}ï¼Ÿ`,
      "acceptedAnswer": {
        "@type": "Answer",
        "text": term.higressRelation
      }
    }
  ]
})} />

<script type="application/ld+json" set:html={JSON.stringify({
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "é¦–é¡µ",
      "item": "https://higress.ai/"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "æœ¯è¯­è¡¨",
      "item": "https://higress.ai/glossary/"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": term.term,
      "item": `https://higress.ai/glossary/${term.id}/`
    }
  ]
})} />

<script>
  document.querySelectorAll('.copy-btn').forEach(btn => {
    btn.addEventListener('click', async () => {
      const code = btn.getAttribute('data-code');
      if (code) {
        await navigator.clipboard.writeText(code);
        const originalText = btn.textContent;
        btn.textContent = 'å·²å¤åˆ¶!';
        setTimeout(() => {
          btn.textContent = originalText;
        }, 2000);
      }
    });
  });
</script>
