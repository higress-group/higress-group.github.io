---
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const docs = await getCollection('docs');
  
  // Debug: 打印所有 slug
  console.log('Total docs:', docs.length);
  console.log('Sample slugs:', docs.slice(0, 5).map(d => d.slug));
  
  // Find all docs under docs/latest/
  const latestDocs = docs.filter(doc => doc.slug.startsWith('docs/latest/'));
  console.log('Matched docs/latest/:', latestDocs.length);

  return latestDocs.map(doc => {
    const slug = doc.slug.replace(/^docs\/latest\//, '');
    console.log(`Creating path: /zh-cn/docs/${slug}/ -> /docs/latest/${slug}/`);
    return {
      params: { slug },
      props: { destination: `/docs/latest/${slug}/` },
    };
  });
}

const { destination } = Astro.props;
---
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="refresh" content={`0;url=${destination}`}>
  <meta name="robots" content="noindex">
  <link rel="canonical" href={destination}>
  <title>Redirecting...</title>
</head>
<body>
  <p>Redirecting to <a href={destination}>{destination}</a></p>
</body>
</html>
