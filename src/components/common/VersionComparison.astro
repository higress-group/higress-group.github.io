---
import { useTranslations } from "@i18n/util";
const t = useTranslations(Astro);
interface Props {
  class?: string;
}

// 统一的文案配置
const textConfig = {
  // 主 Tab 配置
  mainTabs: [
    { id: 'Public', label: t('version.comparison.main.tabs.public') },
    { id: 'Private', label: t('version.comparison.main.tabs.private') },
  ],
  
  // 公共云卡片配置
  publicCloud: {
    // 第一个卡片 - 社区版
    communityCard: {
      title: t('version.comparison.community.title'),
      price: t('version.comparison.community.price'),
      priceDescription: t('version.comparison.community.price.description'),
      description: t('version.comparison.community.description'),
      buttonText: t('version.comparison.community.button'),
      buttonUrl: 'https://free.aliyun.com/?spm=5176.30371578.nav-v2-dropdown-menu-4.d_main_1_0.64de154ao1en4x&scm=20140722.M_10776204._.V_1&searchKey=%E4%BA%91%E5%8E%9F%E7%94%9Fapi'
    },
    
    // 第二个卡片 - 云原生 API 网关
    apiGatewayCard: {
      title: t('version.comparison.api.gateway.title'),
      description: t('version.comparison.api.gateway.description'),
      buttonText: t('version.comparison.api.gateway.button'),
      buttonUrl: 'https://www.aliyun.com/product/apigateway?spm=higress-website.topbar.0.0.0',
      tabLabels: {
        payAsGo: t('version.comparison.api.gateway.tab.pay.as.go'),
        yearly: t('version.comparison.api.gateway.tab.yearly')
      },
      content: {
        payAsGo: t('version.comparison.api.gateway.pay.as.go.price'),
        yearly: {
          price: t('version.comparison.api.gateway.yearly.price'),
          description: t('version.comparison.api.gateway.yearly.discount')
        }
      }
    },
    
    // 第三个卡片 - AI 网关
    aiGatewayCard: {
      title: t('version.comparison.ai.gateway.title'),
      description: t('version.comparison.ai.gateway.description'),
      buttonText: t('version.comparison.ai.gateway.button'),
      buttonUrl: 'https://www.aliyun.com/product/apigateway?spm=higress-website.topbar.0.0.0',
      tabLabels: {
        payAsGo: t('version.comparison.ai.gateway.tab.pay.as.go'),
        yearly: t('version.comparison.ai.gateway.tab.yearly')
      },
      content: {
        payAsGo: t('version.comparison.ai.gateway.pay.as.go.price'),
        yearly: {
          price: t('version.comparison.ai.gateway.yearly.price'),
          description: t('version.comparison.ai.gateway.yearly.discount')
        }
      }
    }
  },
  
  // 专有云配置
  privateCloud: {
    // 第一个卡片 - 社区版（与公共云相同）
    communityCard: {
      title: t('version.comparison.community.title'),
      price: t('version.comparison.community.price'),
      priceDescription: t('version.comparison.community.price.description'),
      description: t('version.comparison.community.description'),
      buttonText: t('version.comparison.community.button'),
      buttonUrl: 'https://free.aliyun.com/?spm=5176.30371578.nav-v2-dropdown-menu-4.d_main_1_0.64de154ao1en4x&scm=20140722.M_10776204._.V_1&searchKey=%E4%BA%91%E5%8E%9F%E7%94%9Fapi'
    },
    
    // 第二个卡片 - 飞天专属版
    exclusiveCard: {
      title: t('version.comparison.exclusive.title'),
      subtitle: t('version.comparison.exclusive.subtitle'),
      description: t('version.comparison.exclusive.description'),
      features: [
        t('version.comparison.exclusive.feature.performance'),
        t('version.comparison.exclusive.feature.sla')
      ],
      buttonText: t('version.comparison.exclusive.button'),
      buttonUrl: 'https://survey.aliyun.com/apps/zhiliao/6Dd_gD6MB'
    }
  }
};

// 引入PricingTabs组件
import PricingTabs from './PricingTabs.astro';
import VersionCard from './VersionCard.astro';
---

<div class="w-full max-w-[85.125rem] mx-auto px-4 sm:px-6 lg:px-0 mb-6">
    <!-- Tab 按钮组 -->
    <div class="custom-tab-group w-[150px] h-[40px] p-1 mb-6 bg-[#1E1F24] rounded-2xl mx-auto sm:mx-0">
        {textConfig.mainTabs.map((tab, index) => (
            <label 
                class="custom-tab-item w-[75px] h-8 cursor-pointer text-sm font-medium flex items-center justify-center transition-all duration-200"
                data-tab={tab.id}
                class={index === 0 ? "bg-[#EDF2FC] text-[#121316] rounded-2xl" : "bg-transparent text-[#A3A6B3] rounded-2xl"}
            >
                <input 
                    type="radio" 
                    name="version-tabs" 
                    class="hidden" 
                    value={tab.id}
                    checked={index === 0}
                />
                <span>{tab.label}</span>
            </label>
        ))}
    </div>

    <!-- Tab 内容区域 -->
    <div class="tab-contents">
        <!-- 公共云 Tab 内容 -->
        <div class="tab-content-n" data-tab="Public" style="display: block;">
            <div class="flex flex-col lg:flex-row gap-4 lg:gap-0 w-full max-w-full">
                <VersionCard 
                    cardData={textConfig.publicCloud.communityCard}
                    cardType="community"
                    cardPosition="first"
                />
                
                <VersionCard 
                    cardData={textConfig.publicCloud.apiGatewayCard}
                    cardType="api-gateway"
                    cardPosition="middle"
                />
                
                <VersionCard 
                    cardData={textConfig.publicCloud.aiGatewayCard}
                    cardType="ai-gateway"
                    cardPosition="last"
                />
            </div>
        </div>
        
        <!-- 专有云 Tab 内容 -->
        <div class="tab-content-n hidden" data-tab="Private">
            <div class="flex flex-col lg:flex-row gap-4 lg:gap-0 w-full justify-center items-start max-w-full">
                <VersionCard 
                    cardData={textConfig.privateCloud.communityCard}
                    cardType="community"
                    cardPosition="first"
                    isPrivateMode={true}
                />
                
                <VersionCard 
                    cardData={textConfig.privateCloud.exclusiveCard}
                    cardType="exclusive"
                    cardPosition="last"
                    isPrivateMode={true}
                />
            </div>
        </div>
    </div>
</div>


<script>
    // Tab 切换功能
    document.addEventListener('DOMContentLoaded', function() {
        const tabButtons = document.querySelectorAll('.custom-tab-item[data-tab]') as NodeListOf<HTMLElement>;
        const tabContents = document.querySelectorAll('.tab-content-n');
        
        // 主tab切换功能
        function switchTab(activeTabId: string) {
        // 隐藏所有 tab 内容
        tabContents.forEach(content => {
            content.classList.add('hidden');
        });
        
        // 显示激活的 tab 内容
        const activeContent = document.querySelector(`.tab-content-n[data-tab="${activeTabId}"]`);
        if (activeContent) {
            activeContent.classList.remove('hidden');
        }
        
        // 更新按钮样式
        tabButtons.forEach(button => {
            const radio = button.querySelector('input[type="radio"]') as HTMLInputElement;
            if (button.dataset.tab === activeTabId) {
                // 选中状态：#EDF2FC 背景，#121316 字体，1rem 圆角
                button.className = 'custom-tab-item w-[75px] h-8 cursor-pointer text-sm font-medium flex items-center justify-center transition-all duration-200 bg-[#EDF2FC] text-[#121316] rounded-2xl';
                if (radio) radio.checked = true;
            } else {
                // 未选中状态：透明背景，#A3A6B3 字体，1rem 圆角
                button.className = 'custom-tab-item w-[75px] h-8 cursor-pointer text-sm font-medium flex items-center justify-center transition-all duration-200 bg-transparent text-[#A3A6B3] rounded-2xl';
                if (radio) radio.checked = false;
            }
        });
        }
        
        // 绑定主tab点击事件
        tabButtons.forEach(button => {
        button.addEventListener('click', function(e) {
                e.preventDefault();
                const tabId = (this as HTMLElement).dataset.tab;
                if (tabId) {
                switchTab(tabId);
                
                // 触发自定义事件
                window.dispatchEvent(new CustomEvent('tabChanged', {
                    detail: { activeTab: tabId }
                }));
            }
        });
        });
        
        // 初始化默认显示第一个 tab
        if (tabButtons.length > 0) {
            const firstTabId = (tabButtons[0] as HTMLElement).dataset.tab;
            if (firstTabId) {
                switchTab(firstTabId);
            }
        }
        
        // 监听 radio 按钮的变化（支持键盘操作）
        const radioButtons = document.querySelectorAll('input[name="version-tabs"]') as NodeListOf<HTMLInputElement>;
        radioButtons.forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.checked) {
                    const tabId = this.value;
                    switchTab(tabId);
                }
            });
        });
    });
</script>

<style is:global>
    /* 卡片 hover 浮动特效 */
    .card-hover-effect {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        cursor: pointer;
    }
    
    .card-hover-effect:hover {
        transform: translateY(-8px);
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
    }
    
    /* 自定义渐变按钮样式 */
    .button-gradient {
        background: linear-gradient(235deg, #2C46C9 -1%, rgba(0, 0, 0, 0) 36%), #121316;
    }
    
    /* 第一个卡片按钮样式 */
    .first-card-button {
        background: #121316;
        transition: all 0.2s ease;
    }
    
    .first-card-button:hover {
        background: linear-gradient(235deg, #2C46C9 -1%, rgba(0, 0, 0, 0) 36%), #121316;
    }
    
    /* 第二、三个卡片按钮样式 */
    .second-third-card-button {
        transition: all 0.2s ease;
    }
    
    .second-third-card-button:hover {
        background: #EBECEF !important;
        color: #131314 !important;
        border-color: #EBECEF !important;
    }
    
    /* 自定义 Tab 组件样式 */
    .custom-tab-group {
        display: flex;
        gap: 0;
        align-items: center;
    }
    
    .custom-tab-item {
        border: none;
        outline: none;
        transition: all 0.2s ease;
        border-radius: 1rem;
    }
    
    .custom-tab-item:hover {
        opacity: 0.8;
    }
    
    .custom-tab-item:focus {
        outline: 2px solid #EDF2FC;
        outline-offset: 2px;
    }
    
    /* Tab 内容区域样式 */
    .tab-contents {
        width: 100%;
        min-height: 100px;
    }
    
    .tab-content-n {
        display: block;
        width: 100%;
    }
    
    .tab-content-n.hidden {
        display: none !important;
    }
    
    /* 响应式调整 */
    @media (max-width: 1023px) {
        /* 移动端容器调整 */
        .tab-contents {
            width: 100%;
            max-width: 100%;
            overflow-x: hidden;
        }
        
        .tab-content-n {
            width: 100%;
            max-width: 100%;
        }
        
        .tab-content-n > div {
            width: 100%;
            max-width: 100%;
        }
        
        /* 移动端卡片调整 */
        .card-hover-effect {
            min-height: 400px; /* 移动端适当减少卡片高度 */
            max-width: 100% !important; /* 强制最大宽度为100% */
            width: 100% !important; /* 强制宽度为100% */
        }
        
        /* 移动端禁用悬停效果 */
        .card-hover-effect:hover {
            transform: none;
            box-shadow: none;
        }
    }
    
    @media (max-width: 768px) {
        /* Tab组件移动端样式 - 保持与大屏一致的宽度 */
        .custom-tab-group {
            width: 150px !important; /* 与大屏保持一致 */
            height: 40px !important; /* 与大屏保持一致 */
            padding: 0.25rem; /* 4px 与大屏的 1px 对应 */
        }
        
        .custom-tab-item {
            width: 75px !important; /* 与大屏保持一致 */
            height: 2rem !important;
            font-size: 0.875rem; /* 14px，比大屏稍小但仍清晰 */
        }
        
        /* 容器样式优化 */
        .w-full.max-w-\[85\.125rem\] {
            max-width: 100% !important;
            padding-left: 1rem !important;
            padding-right: 1rem !important;
        }
        
        /* 移动端卡片样式调整 */
        .card-hover-effect {
            min-height: 350px;
            margin-bottom: 1rem;
            max-width: 100% !important;
            width: 100% !important;
        }
        
        .card-hover-effect:last-child {
            margin-bottom: 0;
        }
        
        /* 移动端字体调整 */
        .text-2xl {
            font-size: 1.25rem !important; /* 20px */
        }
        
        .text-\[44px\] {
            font-size: 2rem !important; /* 32px */
        }
        
        /* 移动端内边距调整 */
        .card-hover-effect {
            padding: 1rem !important;
        }
        
        /* 专有云模式移动端布局 */
        .tab-content-n[data-tab="Private"] .flex {
            justify-content: center !important;
        }
        
        .tab-content-n[data-tab="Private"] .card-hover-effect {
            max-width: 100% !important;
            width: 100% !important;
        }
    }
    
    @media (max-width: 480px) {
        /* 小屏幕Tab组件保持固定尺寸 */
        .custom-tab-group {
            width: 150px !important; /* 与大屏保持一致 */
            height: 40px !important; /* 与大屏保持一致 */
        }
        
        .custom-tab-item {
            width: 75px !important; /* 与大屏保持一致 */
            font-size: 0.75rem; /* 12px，适合小屏 */
        }
        
        /* 超小屏幕容器优化 */
        .w-full.max-w-\[85\.125rem\] {
            padding-left: 0.75rem !important;
            padding-right: 0.75rem !important;
        }
        
        .card-hover-effect {
            min-height: 320px;
            padding: 0.75rem !important;
            max-width: 100% !important;
            width: 100% !important;
        }
        
        .text-2xl {
            font-size: 1.125rem !important; /* 18px */
        }
        
        .text-\[44px\] {
            font-size: 1.75rem !important; /* 28px */
        }
        
        .py-\[38px\] {
            padding-top: 1.5rem !important;
            padding-bottom: 1.5rem !important;
        }
    }
</style>
